{"type":"file-history-snapshot","messageId":"6a5e518d-2b59-4abb-b49a-2bfb9cf55655","snapshot":{"messageId":"6a5e518d-2b59-4abb-b49a-2bfb9cf55655","trackedFileBackups":{},"timestamp":"2026-02-20T23:18:48.331Z"},"isSnapshotUpdate":false}
{"parentUuid":null,"isSidechain":false,"userType":"external","cwd":"/Users/naokisega/src/github.com/nsega/.emacs.d","sessionId":"3662272f-90eb-4f6d-acc3-1b561237eac1","version":"2.1.49","gitBranch":"feature/update-gitignore","type":"progress","data":{"type":"hook_progress","hookEvent":"SessionStart","hookName":"SessionStart:clear","command":"entire hooks claude-code session-start"},"parentToolUseID":"55ef5917-b8ed-4c0d-8459-be6c3e02da76","toolUseID":"55ef5917-b8ed-4c0d-8459-be6c3e02da76","timestamp":"2026-02-20T23:18:48.270Z","uuid":"1082e8aa-a924-414b-b9e9-1b4729b97745"}
{"parentUuid":"1082e8aa-a924-414b-b9e9-1b4729b97745","isSidechain":false,"userType":"external","cwd":"/Users/naokisega/src/github.com/nsega/.emacs.d","sessionId":"3662272f-90eb-4f6d-acc3-1b561237eac1","version":"2.1.49","gitBranch":"feature/update-gitignore","type":"user","message":{"role":"user","content":"<local-command-caveat>Caveat: The messages below were generated by the user while running local commands. DO NOT respond to these messages or otherwise consider them in your response unless the user explicitly asks you to.</local-command-caveat>"},"isMeta":true,"uuid":"97e4bddd-29e4-4fb8-a2cc-35c6719cec8d","timestamp":"2026-02-20T23:18:48.330Z"}
{"parentUuid":"97e4bddd-29e4-4fb8-a2cc-35c6719cec8d","isSidechain":false,"userType":"external","cwd":"/Users/naokisega/src/github.com/nsega/.emacs.d","sessionId":"3662272f-90eb-4f6d-acc3-1b561237eac1","version":"2.1.49","gitBranch":"feature/update-gitignore","type":"user","message":{"role":"user","content":"<command-name>/clear</command-name>\n            <command-message>clear</command-message>\n            <command-args></command-args>"},"uuid":"6a5e518d-2b59-4abb-b49a-2bfb9cf55655","timestamp":"2026-02-20T23:18:48.162Z"}
{"parentUuid":"6a5e518d-2b59-4abb-b49a-2bfb9cf55655","isSidechain":false,"userType":"external","cwd":"/Users/naokisega/src/github.com/nsega/.emacs.d","sessionId":"3662272f-90eb-4f6d-acc3-1b561237eac1","version":"2.1.49","gitBranch":"feature/update-gitignore","type":"user","message":{"role":"user","content":"<local-command-stdout></local-command-stdout>"},"uuid":"ef8491f7-c60a-4e2d-974c-f5c0c7464e1f","timestamp":"2026-02-20T23:18:48.330Z"}
{"parentUuid":"ef8491f7-c60a-4e2d-974c-f5c0c7464e1f","isSidechain":false,"userType":"external","cwd":"/Users/naokisega/src/github.com/nsega/.emacs.d","sessionId":"3662272f-90eb-4f6d-acc3-1b561237eac1","version":"2.1.49","gitBranch":"feature/update-gitignore","type":"system","subtype":"local_command","content":"<command-name>/mcp</command-name>\n            <command-message>mcp</command-message>\n            <command-args></command-args>","level":"info","timestamp":"2026-02-21T17:50:22.707Z","uuid":"84536799-3ea7-4b00-92a5-cb62536fa5a6","isMeta":false}
{"parentUuid":"84536799-3ea7-4b00-92a5-cb62536fa5a6","isSidechain":false,"userType":"external","cwd":"/Users/naokisega/src/github.com/nsega/.emacs.d","sessionId":"3662272f-90eb-4f6d-acc3-1b561237eac1","version":"2.1.49","gitBranch":"feature/update-gitignore","type":"system","subtype":"local_command","content":"<local-command-stdout>MCP dialog dismissed</local-command-stdout>","level":"info","timestamp":"2026-02-21T17:50:22.707Z","uuid":"f1e236c4-11ee-4c0f-950a-8c2045588abc","isMeta":false}
{"type":"file-history-snapshot","messageId":"3249eee2-2651-4cfb-bf4b-cbee098ba5d3","snapshot":{"messageId":"3249eee2-2651-4cfb-bf4b-cbee098ba5d3","trackedFileBackups":{},"timestamp":"2026-02-21T18:16:46.174Z"},"isSnapshotUpdate":false}
{"parentUuid":"f1e236c4-11ee-4c0f-950a-8c2045588abc","isSidechain":false,"userType":"external","cwd":"/Users/naokisega/src/github.com/nsega/.emacs.d","sessionId":"3662272f-90eb-4f6d-acc3-1b561237eac1","version":"2.1.49","gitBranch":"feature/update-gitignore","type":"user","message":{"role":"user","content":[{"type":"text","text":"Recently emacs30.2 is consuming high cpu usage. how can I address that?"},{"type":"image","source":{"type":"base64","media_type":"image/png","data":"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mhxe8/AVGl1Ovg6xPE3TjHRRP7Gy2D2CLkbL+KQsr7xoDmV1pVy3EfYVxoUurx7lUharJ/XD60hhwuKGgCHQWgR4MVMk/iK6WBl5P//883CDJ5+Q16eUD1exjoy8tsry9dhCel2mhxXS6rJWp8G7O/tv9fy6s33Dtjr6hll1zNq1Rm+8l0VrZV5ZXj73ragsvK9CV7aXSJt5dLQTloX3KMyXdrjqfPIIMqaOVP1/89opy9fjEnqdLyOTcknHrmaZiKFieYZAGyBQ9ALnlRXl55U1OlXazWs7Lz/ss4hG2i6iCdvqyng7jqkr59/Kvgzb6ugaZtUxa9caveVeMg/55WGdN9e8fNopKsvrJzW/qO28sqL8vLLU8cToaDOv3bz8sJ08mqJ2w/qxuAkTMVQszxBoIQJ5L3KsyyLavLKiBUHK5BrrsyxP6sp16NChw1WRsuEKVMZ3333nMBen0AuNvqome13ys88+czGMWz1R+rz11ltb3U3btM+zePfdd3fZeOiLPntrCOd37733um+//bbLpsqa8vTTT3dZfyN6R3pNlnQRLkU0lOWFvLK33nrLPfLII52qhbRhXIhY42LvfIxW6kiZXMN8nafLKM+jEdrYVerJtYgmViZ533//vUQL91zpR66//PKLe/fdd92wYcNq9XWkKcLEl19+6Wacccbab6mllnKXXHKJ7qut0myS88wzj3vnnXdq4/r000/dLLPMUktbxBBoFQK8pKmhiDYsC+O0TVrn6T6FpspV2vjpp5/cxhtv7BZaaCG32267+Wzawfz7pz/9yZ133nlCWrtKP998843bdNNN3QILLOCWXnppt+iii7r777+/NmbeQ/nNN998brvttnNfffWVb+eAAw5wSy65ZKc299tvP7fMMsvU6ks/rbwygFa2/+yzz7pVV13VLbvssm6RRRZxW265pWOtpc/bb7/dzTrrrP43++yzu7XWWss9/vjjvuyWW25xm2yySaexsdEuuOCCnfJo57///W+tHWmP6wYbbOBefvlld+SRR/oNpJXzjLXdKmz/+te/Rud7wgknuE8++cT93//933AYxcbXjDye2Y8//rhp/bUKs6K5rr766u6BBx6IziGc30EHHeTee++9KJ1uH8aFd57nT8pWXHFFd+qpp9bS3K/999+/lhY6uTKmc889N7dc6GLXzz//3M0222zA2ak+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M7rbb7+9cAz33HOPpzvyyCNrdJdcconPo778YsqLH374we2yyy5+nWKt2m677RyCBeHVV1+t1ZU27rzzzlofOtKs+eh2R9R0GZ4jKi49bd7cx6WWWsqtuOKKfn158803e9oU2ma8999/v1+TXnzxxYbH9MADD7izzz674Xasgd8REN7WhInfMWkodsUVV3jhgYf1vvvu89aFW265xbfJZgxzQPqaa65xbPqPPfZYp/6+/vprB2Nw6aWXOhgFhJLTTz+9E40lDAFDwHlhfLzxxnO8a7xXvF933HFHJ2iOPfZYN+mkkxZa+G666Sa36aabukGDBhXSdWq4gURZf6+//rp//6eccspaLzD+G264oXvmmWdqeT/99JM77LDD/AYbWjARoHbccUf35JNP1n6jjz66r4fAdfnll/v4jTfe6N5++22/ztx7773utddec3fddZcvow0UGmEbiy++eK3vMFLPfML6Fu+MQBmenakt1a4I8E7CYK2++uru4Ycf9grEQw45pF2H2/bjgmciXHvttW0/1hFtgCFv26OECRbblVZayW92bI6//PKLv3f77LOP23ffff1Li+afh27ttdd2c845p9fAsfkSYNbZKPkRl40YC8D666/v6ddcc033/PPPe3o23yWXXNLT77nnng4XpLywwAILuCOOOMKNPPLIbrTRRnMDBw6saftuu+02t+6667rxxx/fTT755G7VVVcdTvOIa9T+++/vpp9+et/FPPPM495///287izfEBhhEXj88cf9+9S/f3830UQTuRlmmMHdfPPNNTyeeOIJhzZrhx12qOXFIsOGDfPMOxaOrghl/bF+YNFkThL69Onj1w3mKuG8887zAhBrUxg+/fRTv+4gELBWsRZJGGeccfy6RHq22WZzf/3rXx2CBr8JJ5ywZkX97LPP3MQTT+zdn7744gvfRt++8W2invnIeOw6PAJleA5fw3LaEQFcm+ApNt98c8e7s+2223oFY577czvOoV3GhMUU/umkk05y1113XY3ne+mllxy82l577eX5NizVL7zwgh92UVk4L6y2WGjhtdZYYw336KOPhsUWT0Ag5G3ju0RCI11NgpkQaR+NHEIFJq/zzz/fDwO/aRhv8jfYYAO39957u/32288z7GgG8JF76623HBslDyRWBH7y8OGexMaMRWG55Zbz9dmMDz30UHfaaad5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"}}]},"uuid":"3249eee2-2651-4cfb-bf4b-cbee098ba5d3","timestamp":"2026-02-21T18:16:45.997Z","imagePasteIds":[1],"permissionMode":"default"}
{"parentUuid":"3249eee2-2651-4cfb-bf4b-cbee098ba5d3","isSidechain":false,"userType":"external","cwd":"/Users/naokisega/src/github.com/nsega/.emacs.d","sessionId":"3662272f-90eb-4f6d-acc3-1b561237eac1","version":"2.1.49","gitBranch":"feature/update-gitignore","type":"user","message":{"role":"user","content":[{"type":"text","text":"[Image: source: REDACTED 2026-02-21 at 10.16.20 AM.png]"}]},"isMeta":true,"uuid":"25ea56d7-f0c0-49e5-ab23-d1fe5a1f4156","timestamp":"2026-02-21T18:16:45.997Z"}
{"parentUuid":"25ea56d7-f0c0-49e5-ab23-d1fe5a1f4156","isSidechain":false,"userType":"external","cwd":"/Users/naokisega/src/github.com/nsega/.emacs.d","sessionId":"3662272f-90eb-4f6d-acc3-1b561237eac1","version":"2.1.49","gitBranch":"feature/update-gitignore","message":{"model":"claude-sonnet-4-6","id":"msg_01R7RT1ivL5oJPTuuPptwzMk","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"The user is experiencing high CPU usage with Emacs 30.2. Let me look at their configuration to help diagnose the issue.","signature":"EqACCkYICxgCKkCtYb3DpHvREcQrWHih5/CSwvQPI/bM7RU8g7SFcp+3qdE5vdz8L1bhYyz8yrlvyd8fbMdwTPV2KeBGua/IxXCDEgzhgcWXLquoFvNHIZAaDEqvmI2s8F9gk79uvyIwxCqHlPHfU6Ju071EKjinjvskF9BXP3ulD4WRMcq7Ngrr+ewBzQY4yHKsyf+++atKKocBtMRNraT3/tc+MXFXXykc4wx9FUOs+zQgzS1SjGxqFwxT+cnDsr5ixPvrr2DyoxNomdLVmrWiO/Zp9bOwDwR30alxtUCRLA8acq6X6gsGzG6qONCFnbspoO0zl/r8+N5LO+3hi1gmaJPs80DXSYHpJmr1q5YSMQ7doQNzjtKmChBVGMigLJvPGAE="}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":3,"cache_creation_input_tokens":18815,"cache_read_input_tokens":10370,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":18815},"output_tokens":8,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYMfwjKYB9GL1ZMPnYy33","type":"assistant","uuid":"79ea2ec8-080a-45d5-aaa0-64c6c2a00c41","timestamp":"2026-02-21T18:16:48.669Z"}
{"parentUuid":"79ea2ec8-080a-45d5-aaa0-64c6c2a00c41","isSidechain":false,"userType":"external","cwd":"/Users/naokisega/src/github.com/nsega/.emacs.d","sessionId":"3662272f-90eb-4f6d-acc3-1b561237eac1","version":"2.1.49","gitBranch":"feature/update-gitignore","message":{"model":"claude-sonnet-4-6","id":"msg_01R7RT1ivL5oJPTuuPptwzMk","type":"message","role":"assistant","content":[{"type":"text","text":"Let me look at your Emacs configuration to help diagnose the CPU issue."}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":3,"cache_creation_input_tokens":18815,"cache_read_input_tokens":10370,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":18815},"output_tokens":8,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYMfwjKYB9GL1ZMPnYy33","type":"assistant","uuid":"e7dd4958-8a0f-4793-9e08-31dde97e34d3","timestamp":"2026-02-21T18:16:48.953Z"}
{"parentUuid":"e7dd4958-8a0f-4793-9e08-31dde97e34d3","isSidechain":false,"userType":"external","cwd":"/Users/naokisega/src/github.com/nsega/.emacs.d","sessionId":"3662272f-90eb-4f6d-acc3-1b561237eac1","version":"2.1.49","gitBranch":"feature/update-gitignore","slug":"clever-shimmying-tiger","message":{"model":"claude-sonnet-4-6","id":"msg_01R7RT1ivL5oJPTuuPptwzMk","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01K4uHiJDCsDrH31zeUjtdpS","name":"Read","input":{"file_path":"/Users/naokisega/src/github.com/nsega/.emacs.d/init.el"},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":3,"cache_creation_input_tokens":18815,"cache_read_input_tokens":10370,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":18815},"output_tokens":8,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYMfwjKYB9GL1ZMPnYy33","type":"assistant","uuid":"a1846e4b-8bf8-4401-903f-ec4e3b8332a0","timestamp":"2026-02-21T18:16:49.544Z"}
{"parentUuid":"a1846e4b-8bf8-4401-903f-ec4e3b8332a0","isSidechain":false,"userType":"external","cwd":"/Users/naokisega/src/github.com/nsega/.emacs.d","sessionId":"3662272f-90eb-4f6d-acc3-1b561237eac1","version":"2.1.49","gitBranch":"feature/update-gitignore","slug":"clever-shimmying-tiger","type":"progress","data":{"type":"hook_progress","hookEvent":"PostToolUse","hookName":"PostToolUse:Read","command":"callback"},"parentToolUseID":"toolu_01K4uHiJDCsDrH31zeUjtdpS","toolUseID":"toolu_01K4uHiJDCsDrH31zeUjtdpS","timestamp":"2026-02-21T18:16:49.753Z","uuid":"cecb43ec-9bcd-460c-8cca-b62f09167111"}
{"parentUuid":"a1846e4b-8bf8-4401-903f-ec4e3b8332a0","isSidechain":false,"userType":"external","cwd":"/Users/naokisega/src/github.com/nsega/.emacs.d","sessionId":"3662272f-90eb-4f6d-acc3-1b561237eac1","version":"2.1.49","gitBranch":"feature/update-gitignore","slug":"clever-shimmying-tiger","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01K4uHiJDCsDrH31zeUjtdpS","type":"tool_result","content":"     1→;;; init.el --- Modern Emacs Configuration -*- lexical-binding: t; -*-\n     2→\n     3→;; Author: Naoki Sega\n     4→;; Maintainer: Naoki Sega\n     5→;; URL: https://github.com/nsega/.emacs.d\n     6→;; Keywords: convenience\n     7→\n     8→;;; Commentary:\n     9→\n    10→;; Modern Emacs configuration using use-package for declarative package management.\n    11→;; Migrated from traditional setup to use modern best practices for Emacs 30+.\n    12→;;\n    13→;; Key Features:\n    14→;; - Vertico ecosystem for lightweight, fast completion (replaces Helm)\n    15→;; - Eglot LSP for intelligent code navigation (Python, Go, TypeScript)\n    16→;; - Tree-sitter modes for Python, Go, YAML (accurate syntax highlighting)\n    17→;; - Company-mode for auto-completion\n    18→;; - Modern advice-add instead of deprecated defadvice\n    19→;; - Single, well-organized init.el (no separate custom/*.el files)\n    20→;; - early-init.el for faster startup and no UI flickering\n    21→;; - no-littering for clean .emacs.d directory\n    22→;;\n    23→;; Package Management:\n    24→;; - Uses use-package for all package configuration\n    25→;; - Lazy loading where appropriate for fast startup\n    26→;; - Self-documenting package declarations\n    27→;;\n    28→;; Completion Framework:\n    29→;; - vertico: Vertical completion UI\n    30→;; - consult: Enhanced completing-read commands\n    31→;; - marginalia: Rich annotations in minibuffer\n    32→;; - embark: Contextual actions on completion candidates\n    33→;; - orderless: Flexible matching style\n    34→;;\n    35→;; Code Intelligence:\n    36→;; - Eglot: Built-in LSP client (Emacs 29+)\n    37→;; - Company: Auto-completion framework\n    38→;; - dumb-jump: Fallback navigation for non-LSP files\n    39→;;\n    40→;; For more information, see: https://github.com/nsega/.emacs.d\n    41→\n    42→;;; Code:\n    43→\n    44→;; ============================================================\n    45→;; Package Management\n    46→;; ============================================================\n    47→(require 'package)\n    48→(add-to-list 'package-archives\n    49→             '(\"melpa\" . \"https://melpa.org/packages/\") t)\n    50→(package-initialize)\n    51→\n    52→;; ============================================================\n    53→;; Bootstrap use-package\n    54→;; ============================================================\n    55→(unless (package-installed-p 'use-package)\n    56→  (package-refresh-contents)\n    57→  (package-install 'use-package))\n    58→\n    59→(eval-when-compile (require 'use-package))\n    60→(setq use-package-always-ensure t)\n    61→(setq use-package-compute-statistics t)  ; For performance monitoring via M-x use-package-report\n    62→\n    63→;; ============================================================\n    64→;; Directory Organization - no-littering\n    65→;; ============================================================\n    66→;; Keep .emacs.d clean by redirecting package files to var/ and etc/\n    67→(use-package no-littering\n    68→  :demand t  ; Load early to affect all subsequent packages\n    69→  :config\n    70→  ;; Put auto-save files in var directory\n    71→  (setq auto-save-file-name-transforms\n    72→        `((\".*\" ,(no-littering-expand-var-file-name \"auto-save/\") t)))\n    73→  ;; Put native-comp cache in var directory (only if native-comp is available)\n    74→  (when (and (fboundp 'startup-redirect-eln-cache)\n    75→             (boundp 'native-comp-eln-load-path))\n    76→    (startup-redirect-eln-cache\n    77→     (convert-standard-filename\n    78→      (expand-file-name \"var/eln-cache/\" user-emacs-directory)))))\n    79→\n    80→;; Pre-configure claude-code to use vterm (must be set before package loads)\n    81→(setq claude-code-terminal-backend 'vterm)\n    82→\n    83→;; ============================================================\n    84→;; Basic Settings\n    85→;; ============================================================\n    86→;; NOTE: gc-cons-threshold is set in early-init.el for faster startup\n    87→;; and automatically reset after Emacs finishes loading\n    88→(setq inhibit-startup-message t)\n    89→\n    90→;; Suppress byte-compile warnings from packages\n    91→(setq byte-compile-warnings '(not obsolete))\n    92→(setq warning-suppress-log-types '((comp) (bytecomp)))\n    93→(setq native-comp-async-report-warnings-errors 'silent)\n    94→\n    95→;; PATH setup is handled by exec-path-from-shell (see below)\n    96→;; This ensures Emacs inherits PATH from your shell\n    97→(setq exec-path (cons \"/opt/homebrew/bin\" exec-path))\n    98→(setq exec-path (cons \"/usr/local/bin\" exec-path))\n    99→\n   100→(defalias 'yes-or-no-p 'y-or-n-p)\n   101→\n   102→;; ============================================================\n   103→;; macOS Clipboard Integration\n   104→;; ============================================================\n   105→;; Sync kill ring with macOS system clipboard via pbcopy/pbpaste\n   106→(when (eq system-type 'darwin)\n   107→  (setq interprogram-cut-function\n   108→        (lambda (text &optional _)\n   109→          (let ((process-connection-type nil))\n   110→            (let ((proc (start-process \"pbcopy\" nil \"pbcopy\")))\n   111→              (process-send-string proc text)\n   112→              (process-send-eof proc)))))\n   113→  (setq interprogram-paste-function\n   114→        (lambda ()\n   115→          (let ((clipboard (shell-command-to-string \"pbpaste\")))\n   116→            (unless (string= clipboard (car kill-ring))\n   117→              clipboard)))))\n   118→\n   119→;; ============================================================\n   120→;; macOS Native Scrolling\n   121→;; ============================================================\n   122→;; Enable pixel-precise scrolling for smooth trackpad experience\n   123→;; Makes Emacs feel like a native macOS application (Emacs 29+)\n   124→(when (fboundp 'pixel-scroll-precision-mode)\n   125→  (pixel-scroll-precision-mode 1))\n   126→\n   127→;; ============================================================\n   128→;; Mouse Support (Terminal and GUI)\n   129→;; ============================================================\n   130→;; Enable mouse in terminal emulators (Ghostty, iTerm2, etc.)\n   131→;; Safe to enable always - only activates in terminal frames\n   132→(xterm-mouse-mode 1)\n   133→\n   134→;; Auto-copy mouse selection to clipboard (like typical terminal behavior)\n   135→(setq mouse-drag-copy-region t)\n   136→\n   137→;; Mouse wheel scrolling (works in both terminal and GUI)\n   138→(global-set-key [mouse-4] 'scroll-down-command)\n   139→(global-set-key [mouse-5] 'scroll-up-command)\n   140→\n   141→;; Drag mode-line to resize windows vertically (click and drag the status bar)\n   142→;; Drag vertical border to resize windows horizontally\n   143→(global-set-key [mode-line mouse-1] 'mouse-drag-mode-line)\n   144→(global-set-key [vertical-line mouse-1] 'mouse-drag-vertical-line)\n   145→\n   146→;; Scroll through buffer history with mouse wheel on mode-line\n   147→(global-set-key [mode-line mouse-4] 'previous-buffer)\n   148→(global-set-key [mode-line mouse-5] 'next-buffer)\n   149→(global-set-key [mode-line wheel-up] 'previous-buffer)\n   150→(global-set-key [mode-line wheel-down] 'next-buffer)\n   151→\n   152→;; Or use Ctrl+wheel anywhere to switch buffers\n   153→(global-set-key [C-mouse-4] 'previous-buffer)\n   154→(global-set-key [C-mouse-5] 'next-buffer)\n   155→(global-set-key [C-wheel-up] 'previous-buffer)\n   156→(global-set-key [C-wheel-down] 'next-buffer)\n   157→\n   158→;; Window layout undo/redo\n   159→;; C-c <left> to undo, C-c <right> to redo window configuration\n   160→;; Note: May conflict with org-mode/markdown-mode C-c bindings in those buffers\n   161→(winner-mode 1)\n   162→\n   163→;; Allow resizing side windows (help, compilation, etc.) via mouse drag\n   164→(setq window-resize-pixelwise t)  ; Precise pixel resizing for smoother drag\n   165→(setq window-sides-slots '(1 1 1 1))  ; Allow side windows on all sides\n   166→;; Don't preserve side window sizes - allow free resizing\n   167→(setq window-sides-vertical nil)  ; Side windows on left/right don't span full height\n   168→(add-to-list 'window-persistent-parameters '(window-side . writable))\n   169→\n   170→;; GUI-only: window dividers for easier grabbing\n   171→(when (display-graphic-p)\n   172→  (setq window-divider-default-places t)\n   173→  (setq window-divider-default-right-width 6)  ; Wider for easier grabbing\n   174→  (setq window-divider-default-bottom-width 6)\n   175→  (window-divider-mode 1)\n   176→  (global-set-key [right-divider mouse-1] 'mouse-drag-vertical-line)\n   177→  (global-set-key [bottom-divider mouse-1] 'mouse-drag-mode-line))\n   178→\n   179→;; ============================================================\n   180→;; Terminal Vertical Split Display Fix\n   181→;; ============================================================\n   182→;; Prevent text overflow between vertically split windows in terminal\n   183→(unless (display-graphic-p)\n   184→  ;; Force line truncation in split windows to prevent overflow\n   185→  (setq truncate-partial-width-windows t)\n   186→  (setq-default truncate-lines t)  ; Truncate all lines in terminal\n   187→  ;; Use ASCII vertical bar for window border (Unicode can cause width issues)\n   188→  (set-display-table-slot standard-display-table 'vertical-border ?|)\n   189→  ;; Ensure no margins\n   190→  (setq-default left-margin-width 0)\n   191→  (setq-default right-margin-width 0)\n   192→  ;; Disable word wrap that can cause overflow\n   193→  (setq-default word-wrap nil)\n   194→  (global-visual-line-mode -1))\n   195→\n   196→;; ============================================================\n   197→;; Frame/Terminal Title - Show project name in window list\n   198→;; ============================================================\n   199→;; This makes it easy to identify Emacs instances in Ghostty/terminal window lists\n   200→\n   201→(defun my/get-frame-title ()\n   202→  \"Return a title string showing project and current buffer.\"\n   203→  (let ((project (project-current)))\n   204→    (format \"emacs [%s] - %s\"\n   205→            (if project\n   206→                (project-name project)\n   207→              (abbreviate-file-name default-directory))\n   208→            (buffer-name))))\n   209→\n   210→;; GUI Emacs: Set frame title\n   211→(setq frame-title-format '(:eval (my/get-frame-title)))\n   212→\n   213→;; Terminal Emacs: Send escape sequence to set terminal window title\n   214→(defun my/set-terminal-title ()\n   215→  \"Set terminal window title to project name or directory.\"\n   216→  (when (and (not (display-graphic-p))\n   217→             (getenv \"TERM\"))\n   218→    (send-string-to-terminal\n   219→     (format \"\\033]0;%s\\007\" (my/get-frame-title)))))\n   220→\n   221→;; Update terminal title on relevant events\n   222→(unless (display-graphic-p)\n   223→  (add-hook 'buffer-list-update-hook #'my/set-terminal-title)\n   224→  (add-hook 'window-configuration-change-hook #'my/set-terminal-title)\n   225→  ;; Set initial title\n   226→  (add-hook 'emacs-startup-hook #'my/set-terminal-title))\n   227→\n   228→(defconst demo-packages\n   229→  '(anzu\n   230→    company\n   231→    ;; duplicate-thing  ; removed - no longer available on MELPA\n   232→    ;; Completion framework - Vertico ecosystem (replaces Helm)\n   233→    vertico\n   234→    orderless\n   235→    marginalia\n   236→    consult\n   237→    embark\n   238→    embark-consult\n   239→    migemo\n   240→    ;; function-args\n   241→    clean-aindent-mode\n   242→    comment-dwim-2\n   243→    dtrt-indent\n   244→    ws-butler\n   245→    iedit\n   246→    yasnippet\n   247→    smartparens\n   248→    volatile-highlights\n   249→    undo-tree\n   250→    zygospore\n   251→    ;; Modern language modes\n   252→    exec-path-from-shell  ; Better PATH handling on macOS\n   253→    go-mode               ; Go support (fallback if tree-sitter grammar unavailable)\n   254→    yaml-mode             ; YAML support (fallback if tree-sitter grammar unavailable)\n   255→    typescript-mode       ; TypeScript support (fallback if tree-sitter grammar unavailable)\n   256→    web-mode              ; TSX/JSX support (fallback if tree-sitter grammar unavailable)\n   257→    markdown-mode         ; Markdown support\n   258→    ;; JVM languages\n   259→    kotlin-mode           ; Kotlin support (fallback if tree-sitter grammar unavailable)\n   260→    groovy-mode           ; Groovy/Gradle support\n   261→    ;; Navigation fallback\n   262→    dumb-jump             ; Jump to definition without tags/LSP\n   263→    ;; Terminal\n   264→    vterm                 ; Terminal emulator for Claude Code\n   265→    eat                   ; Emulate A Terminal (another terminal emulator)\n   266→    ))\n   267→\n   268→(defun install-packages ()\n   269→  \"Install all required packages.\"\n   270→  (interactive)\n   271→  (unless package-archive-contents\n   272→    (package-refresh-contents))\n   273→  (dolist (package demo-packages)\n   274→    (unless (package-installed-p package)\n   275→      (package-install package))))\n   276→\n   277→(install-packages)\n   278→\n   279→;; ============================================================\n   280→;; Navigation Enhancements\n   281→;; ============================================================\n   282→;; M-. (xref-find-definitions) and M-? (xref-find-references) are\n   283→;; built-in bindings. Eglot automatically registers as xref backend.\n   284→\n   285→;; ============================================================\n   286→;; dumb-jump - Fallback navigation when no tags/LSP available\n   287→;; ============================================================\n   288→(use-package dumb-jump\n   289→  :config\n   290→  (add-hook 'xref-backend-functions #'dumb-jump-xref-activate)\n   291→  :custom\n   292→  (dumb-jump-prefer-searcher 'rg)  ; Use ripgrep if available\n   293→  (dumb-jump-force-searcher nil))\n   294→\n   295→;; ============================================================\n   296→;; Completion - Company Mode\n   297→;; ============================================================\n   298→(use-package company\n   299→  :hook (after-init . global-company-mode)\n   300→  :config\n   301→  (delete 'company-semantic company-backends)\n   302→  ;; Add tab completion for C/C++ modes\n   303→  (add-hook 'c-mode-hook\n   304→            (lambda ()\n   305→              (local-set-key (kbd \"<tab>\") 'company-complete)))\n   306→  (add-hook 'c++-mode-hook\n   307→            (lambda ()\n   308→              (local-set-key (kbd \"<tab>\") 'company-complete)))\n   309→  :custom\n   310→  (company-idle-delay 0.1)\n   311→  (company-minimum-prefix-length 2)\n   312→  (company-show-numbers t))\n   313→\n   314→(use-package company-c-headers\n   315→  :after company\n   316→  :config\n   317→  (add-to-list 'company-backends 'company-c-headers))\n   318→\n   319→;; hs-minor-mode for folding source code\n   320→(add-hook 'c-mode-common-hook 'hs-minor-mode)\n   321→\n   322→;; Available C style:\n   323→;; “gnu”: The default style for GNU projects\n   324→;; “k&r”: What Kernighan and Ritchie, the authors of C used in their book\n   325→;; “bsd”: What BSD developers use, aka “Allman style” after Eric Allman.\n   326→;; “whitesmith”: Popularized by the examples that came with Whitesmiths C, an early commercial C compiler.\n   327→;; “stroustrup”: What Stroustrup, the author of C++ used in his book\n   328→;; “ellemtel”: Popular C++ coding standards as defined by “Programming in C++, Rules and Recommendations,” Erik Nyquist and Mats Henricson, Ellemtel\n   329→;; “linux”: What the Linux developers use for kernel development\n   330→;; “python”: What Python developers use for extension modules\n   331→;; “java”: The default style for java-mode (see below)\n   332→;; “user”: When you want to define your own style\n   333→(setq\n   334→ c-default-style \"linux\" ;; set style to \"linux\"\n   335→ )\n   336→\n   337→(global-set-key (kbd \"RET\") 'newline-and-indent)  ; automatically indent when press RET\n   338→\n   339→;; activate whitespace-mode to view all whitespace characters\n   340→(global-set-key (kbd \"C-c w\") 'whitespace-mode)\n   341→\n   342→;; show unncessary whitespace that can mess up your diff\n   343→(add-hook 'prog-mode-hook (lambda () (interactive) (setq show-trailing-whitespace 1)))\n   344→\n   345→;; use space to indent by default\n   346→(setq-default indent-tabs-mode nil)\n   347→\n   348→;; set appearance of a tab that is represented by 4 spaces\n   349→(setq-default tab-width 4)\n   350→\n   351→;; Compilation\n   352→(global-set-key (kbd \"<f5>\") (lambda ()\n   353→                               (interactive)\n   354→                               (setq-local compilation-read-command nil)\n   355→                               (call-interactively 'compile)))\n   356→\n   357→;; setup GDB\n   358→(setq\n   359→ ;; use gdb-many-windows by default\n   360→ gdb-many-windows t\n   361→\n   362→ ;; Non-nil means display source file containing the main routine at startup\n   363→ gdb-show-main t\n   364→ )\n   365→\n   366→;; ============================================================\n   367→;; Completion Framework - Vertico Ecosystem\n   368→;; ============================================================\n   369→\n   370→;; vertico - Vertical completion UI\n   371→(use-package vertico\n   372→  :init\n   373→  (vertico-mode)\n   374→  :custom\n   375→  (vertico-cycle t)\n   376→  :bind (:map vertico-map\n   377→              (\"C-j\" . vertico-next)\n   378→              (\"C-k\" . vertico-previous)))\n   379→\n   380→;; orderless - Flexible completion matching\n   381→(use-package orderless\n   382→  :custom\n   383→  (completion-styles '(orderless basic))\n   384→  (completion-category-defaults nil)\n   385→  (completion-category-overrides '((file (styles partial-completion)))))\n   386→\n   387→;; marginalia - Rich annotations in minibuffer\n   388→(use-package marginalia\n   389→  :init\n   390→  (marginalia-mode))\n   391→\n   392→;; consult - Consulting completing-read\n   393→(use-package consult\n   394→  :bind ((\"C-x b\" . consult-buffer)\n   395→         (\"M-g i\" . consult-imenu)\n   396→         (\"M-s l\" . consult-line)\n   397→         (\"M-s g\" . consult-grep)\n   398→         (\"M-s r\" . consult-ripgrep)\n   399→         (\"M-y\" . consult-yank-pop)\n   400→         ;; Alternative bindings for terminal (M-s often conflicts)\n   401→         (\"C-c s l\" . consult-line)       ; Alternative to M-s l\n   402→         (\"C-c s g\" . consult-grep)       ; Alternative to M-s g\n   403→         (\"C-c s r\" . consult-ripgrep)    ; Alternative to M-s r\n   404→         (\"C-c s i\" . consult-imenu)      ; Alternative to M-g i\n   405→         :map minibuffer-local-map\n   406→         (\"M-p\" . consult-history)))\n   407→\n   408→;; embark - Contextual actions\n   409→(use-package embark\n   410→  :bind ((\"C-.\" . embark-act)\n   411→         (\"C-c e b\" . embark-bindings)))  ; C-h B conflicts with C-h as backspace\n   412→\n   413→;; embark-consult - Integration between embark and consult\n   414→(use-package embark-consult\n   415→  :after (embark consult))\n   416→\n   417→;; ============================================================\n   418→;; Editing Enhancements (use-package)\n   419→;; ============================================================\n   420→\n   421→;; Package: clean-aindent-mode - Clean auto-indent and backspace behavior\n   422→(use-package clean-aindent-mode\n   423→  :hook (prog-mode . clean-aindent-mode))\n   424→\n   425→;; Package: dtrt-indent - Detect indent style automatically\n   426→(use-package dtrt-indent\n   427→  :config\n   428→  (dtrt-indent-mode 1)\n   429→  (setq dtrt-indent-verbosity 0))\n   430→\n   431→;; Package: ws-butler - Trim whitespace only on edited lines\n   432→(use-package ws-butler\n   433→  :hook ((prog-mode . ws-butler-mode)\n   434→         (text-mode . ws-butler-mode)\n   435→         (fundamental-mode . ws-butler-mode)))\n   436→\n   437→;; Package: yasnippet - Template system\n   438→(use-package yasnippet\n   439→  :config\n   440→  (yas-global-mode 1)\n   441→  ;; Don't activate in terminal mode\n   442→  (add-hook 'term-mode-hook (lambda() (setq yas-dont-activate t)))\n   443→  :custom\n   444→  (yas-verbosity 1)\n   445→  (yas-wrap-around-region t)\n   446→  (yas-prompt-functions '(yas/ido-prompt yas/completing-prompt)))\n   447→\n   448→;; Package: smartparens - Parenthesis management\n   449→(use-package smartparens\n   450→  :config\n   451→  (require 'smartparens-config)\n   452→  (setq sp-base-key-bindings 'paredit)\n   453→  (setq sp-autoskip-closing-pair 'always)\n   454→  (setq sp-hybrid-kill-entire-symbol nil)\n   455→  (sp-use-paredit-bindings)\n   456→  (show-smartparens-global-mode +1)\n   457→  (smartparens-global-mode 1))\n   458→\n   459→;; ============================================================\n   460→;; Project Management - Built-in project.el (Emacs 28+)\n   461→;; ============================================================\n   462→;; project.el is built-in and integrates natively with Eglot, xref, and Consult.\n   463→;; Default prefix: C-x p\n   464→\n   465→(setq project-switch-commands\n   466→      '((project-find-file \"Find file\" ?f)\n   467→        (project-find-regexp \"Find regexp\" ?g)\n   468→        (project-find-dir \"Find directory\" ?d)\n   469→        (project-eshell \"Eshell\" ?e)))\n   470→\n   471→;; ============================================================\n   472→;; Dired Configuration\n   473→;; ============================================================\n   474→;; Auto-revert Dired buffer when switching to it (picks up filesystem changes)\n   475→(setq dired-auto-revert-buffer t)\n   476→\n   477→;; Package: zygospore - Reversible C-x 1 (delete-other-windows)\n   478→(use-package zygospore\n   479→  :bind ((\"C-x 1\" . zygospore-toggle-delete-other-windows)))\n   480→\n   481→;; Package: anzu - Show match count in mode-line while searching\n   482→(use-package anzu\n   483→  :config\n   484→  (global-anzu-mode)\n   485→  :bind ((\"M-%\" . anzu-query-replace)\n   486→         (\"C-M-%\" . anzu-query-replace-regexp)))\n   487→\n   488→;; Package: volatile-highlights - Highlight changes from yanking, undo, etc.\n   489→(use-package volatile-highlights\n   490→  :config\n   491→  (volatile-highlights-mode t))\n   492→\n   493→;; Package: undo-tree - Visualize undo history as a tree\n   494→(use-package undo-tree\n   495→  :config\n   496→  (global-undo-tree-mode))\n   497→\n   498→;; Package: comment-dwim-2 - Smarter comment/uncomment\n   499→(use-package comment-dwim-2\n   500→  :bind ((\"M-;\" . comment-dwim-2)))\n   501→\n   502→;; Package: iedit - Edit multiple occurrences simultaneously\n   503→(use-package iedit\n   504→  :custom\n   505→  (iedit-toggle-key-default nil)\n   506→  :bind ((\"C-;\" . iedit-mode)))\n   507→\n   508→;; ============================================================\n   509→;; Custom Editing Behaviors (modernized from setup-editing.el)\n   510→;; ============================================================\n   511→\n   512→;; Enhanced kill/copy/yank behaviors using modern advice-add\n   513→\n   514→;; 1. Copy line when no region is active (M-w)\n   515→(defun my/slick-copy-advice (orig-fun &rest args)\n   516→  \"Copy line when no region is active.\"\n   517→  (interactive\n   518→   (if mark-active\n   519→       (list (region-beginning) (region-end))\n   520→     (message \"Copied line\")\n   521→     (list (line-beginning-position)\n   522→           (line-beginning-position 2))))\n   523→  (apply orig-fun args))\n   524→\n   525→(advice-add 'kill-ring-save :around #'my/slick-copy-advice)\n   526→\n   527→;; 2. Cut line when no region is active (C-w)\n   528→(defun my/slick-cut-advice (orig-fun &rest args)\n   529→  \"Cut line when no region is active.\"\n   530→  (interactive\n   531→   (if mark-active\n   532→       (list (region-beginning) (region-end))\n   533→     (list (line-beginning-position)\n   534→           (line-beginning-position 2))))\n   535→  (apply orig-fun args))\n   536→\n   537→(advice-add 'kill-region :around #'my/slick-cut-advice)\n   538→\n   539→;; 3. Clean whitespace before killing line (C-k)\n   540→(defun my/kill-line-whitespace-advice (&rest _args)\n   541→  \"Clean whitespace before killing line in programming modes.\"\n   542→  (when (member major-mode\n   543→                '(emacs-lisp-mode scheme-mode lisp-mode\n   544→                  c-mode c++-mode objc-mode\n   545→                  latex-mode plain-tex-mode))\n   546→    (when (and (eolp) (not (bolp)))\n   547→      (forward-char 1)\n   548→      (just-one-space 0)\n   549→      (backward-char 1))))\n   550→\n   551→(advice-add 'kill-line :before #'my/kill-line-whitespace-advice)\n   552→\n   553→;; 4. Auto-indent yanked text in programming modes (C-y, M-y)\n   554→(defvar yank-indent-modes\n   555→  '(LaTeX-mode TeX-mode)\n   556→  \"Modes in which to indent regions that are yanked (or yank-popped).\n   557→Only modes that don't derive from `prog-mode' should be listed here.\")\n   558→\n   559→(defvar yank-indent-blacklisted-modes\n   560→  '(python-mode slim-mode haml-mode)\n   561→  \"Modes for which auto-indenting is suppressed.\")\n   562→\n   563→(defvar yank-advised-indent-threshold 1000\n   564→  \"Threshold (# chars) over which indentation does not automatically occur.\")\n   565→\n   566→(defun yank-advised-indent-function (beg end)\n   567→  \"Do indentation, as long as the region isn't too large.\"\n   568→  (if (<= (- end beg) yank-advised-indent-threshold)\n   569→      (indent-region beg end nil)))\n   570→\n   571→(defun my/yank-indent-advice (orig-fun &rest args)\n   572→  \"Auto-indent yanked text in programming modes.\"\n   573→  (let ((result (apply orig-fun args)))\n   574→    (when (and (not (car args))\n   575→               (not (member major-mode yank-indent-blacklisted-modes))\n   576→               (or (derived-mode-p 'prog-mode)\n   577→                   (member major-mode yank-indent-modes)))\n   578→      (let ((transient-mark-mode nil))\n   579→        (yank-advised-indent-function (region-beginning) (region-end))))\n   580→    result))\n   581→\n   582→(advice-add 'yank :around #'my/yank-indent-advice)\n   583→(advice-add 'yank-pop :around #'my/yank-indent-advice)\n   584→\n   585→;; Other useful editing functions from setup-editing.el\n   586→\n   587→;; Smart move to beginning of line (C-a)\n   588→(defun prelude-move-beginning-of-line (arg)\n   589→  \"Move point back to indentation of beginning of line.\n   590→\n   591→Move point to the first non-whitespace character on this line.\n   592→If point is already there, move to the beginning of the line.\n   593→Effectively toggle between the first non-whitespace character and\n   594→the beginning of the line.\n   595→\n   596→If ARG is not nil or 1, move forward ARG - 1 lines first. If\n   597→point reaches the beginning or end of the buffer, stop there.\"\n   598→  (interactive \"^p\")\n   599→  (setq arg (or arg 1))\n   600→\n   601→  ;; Move lines first\n   602→  (when (/= arg 1)\n   603→    (let ((line-move-visual nil))\n   604→      (forward-line (1- arg))))\n   605→\n   606→  (let ((orig-point (point)))\n   607→    (back-to-indentation)\n   608→    (when (= orig-point (point))\n   609→      (move-beginning-of-line 1))))\n   610→\n   611→(global-set-key (kbd \"C-a\") 'prelude-move-beginning-of-line)\n   612→\n   613→;; Smart open line (M-o)\n   614→(defun prelude-smart-open-line (arg)\n   615→  \"Insert an empty line after the current line.\n   616→Position the cursor at its beginning, according to the current mode.\n   617→With a prefix ARG open line above the current line.\"\n   618→  (interactive \"P\")\n   619→  (if arg\n   620→      (prelude-smart-open-line-above)\n   621→    (progn\n   622→      (move-end-of-line nil)\n   623→      (newline-and-indent))))\n   624→\n   625→(defun prelude-smart-open-line-above ()\n   626→  \"Insert an empty line above the current line.\n   627→Position the cursor at it's beginning, according to the current mode.\"\n   628→  (interactive)\n   629→  (move-beginning-of-line nil)\n   630→  (newline-and-indent)\n   631→  (forward-line -1)\n   632→  (indent-according-to-mode))\n   633→\n   634→(global-set-key (kbd \"M-o\") 'prelude-smart-open-line)\n   635→\n   636→;; Indent buffer or region (C-c i)\n   637→(defun indent-buffer ()\n   638→  \"Indent the currently visited buffer.\"\n   639→  (interactive)\n   640→  (indent-region (point-min) (point-max)))\n   641→\n   642→(defcustom prelude-indent-sensitive-modes\n   643→  '(coffee-mode python-mode slim-mode haml-mode yaml-mode)\n   644→  \"Modes for which auto-indenting is suppressed.\"\n   645→  :type 'list)\n   646→\n   647→(defun indent-region-or-buffer ()\n   648→  \"Indent a region if selected, otherwise the whole buffer.\"\n   649→  (interactive)\n   650→  (unless (member major-mode prelude-indent-sensitive-modes)\n   651→    (save-excursion\n   652→      (if (region-active-p)\n   653→          (progn\n   654→            (indent-region (region-beginning) (region-end))\n   655→            (message \"Indented selected region.\"))\n   656→        (progn\n   657→          (indent-buffer)\n   658→          (message \"Indented buffer.\")))\n   659→      (whitespace-cleanup))))\n   660→\n   661→(global-set-key (kbd \"C-c i\") 'indent-region-or-buffer)\n   662→\n   663→;; ============================================================\n   664→;; Speedbar\n   665→(setq speedbar-show-unknown-files t)\n   666→\n   667→;; NOTE: Removed old macOS Mavericks workaround that forced home directory\n   668→;; This was causing issues with `emacs .` not respecting current directory\n   669→;; If you need to start in home directory, use: emacs ~\n   670→;;\n   671→;; Old code (commented out):\n   672→;; ;;　Changing the home directory as the initial dir(for Mervelicks)\n   673→;; (setq default-directory \"~/\")\n   674→;; (setq command-line-default-directory \"~/\")\n   675→;;\n   676→;; ;; Changing the default directory as of '〜/' for Mavericks\n   677→;; (defun cd-to-homedir-all-buffers ()\n   678→;;   \"Change every current directory of all buffers to the home directory.\"\n   679→;;   (mapc\n   680→;;    (lambda (buf) (set-buffer buf) (cd (expand-file-name \"~\"))) (buffer-list)))\n   681→;; (add-hook 'after-init-hook 'cd-to-homedir-all-buffers)\n   682→\n   683→;; Japanese Configuration (UTF-8)\n   684→(set-language-environment \"Japanese\")\n   685→(set-terminal-coding-system 'utf-8)\n   686→(set-keyboard-coding-system 'utf-8)\n   687→(set-buffer-file-coding-system 'utf-8)\n   688→(setq buffer-file-coding-system 'utf-8)\n   689→(setq slime-net-coding-system 'utf-8-unix)\n   690→\n   691→;; key bindings\n   692→(windmove-default-keybindings 'meta)\n   693→(setq mac-option-modifier 'meta)\n   694→(setq mac-command-modifier 'meta)\n   695→(global-set-key [kp-delete] 'delete-char) ;; sets fn-delete to be right-delete\n   696→\n   697→;; Enabling Font Lock mode (e.g. bold display)\n   698→(global-font-lock-mode t)\n   699→\n   700→;; Enabling automcatically the temporarily mode\n   701→(setq-default transient-mark-mode t)\n   702→\n   703→;; Changing C-x C-u to be worked nothing (undo / typo countermeasure)\n   704→(global-unset-key \"\\C-x\\C-u\")\n   705→\n   706→;; High lighting the pared parenethesis\n   707→(show-paren-mode 1)\n   708→\n   709→(setq next-line-add-newlines nil)\n   710→\n   711→;; C-x l/ run goto-line\n   712→(define-key ctl-x-map \"l\" 'goto-line)\n   713→;; alternate of '¥', entering '/'\n   714→(define-key global-map [?¥] [?\\\\])\n   715→\n   716→(display-time)\n   717→\n   718→;; display the column number\n   719→(column-number-mode 1)\n   720→\n   721→;; NOTE: menu-bar, tool-bar, and scroll-bars are disabled in early-init.el\n   722→;; to prevent UI flickering during startup\n   723→\n   724→;; Make C-h act as backspace\n   725→(define-key global-map \"\\C-h\" 'delete-backward-char)\n   726→(define-key global-map \"\\C-x\\C-h\" 'help-command)\n   727→;; Also bind in key-translation-map to override help-map\n   728→(define-key key-translation-map (kbd \"C-h\") (kbd \"<DEL>\"))\n   729→;; Override in isearch-mode\n   730→(define-key isearch-mode-map \"\\C-h\" 'isearch-delete-char)\n   731→(define-key global-map \"\\C-o\" 'dabbrev-expand)\n   732→(setq dabbrev-case-fold-search nil)\n   733→\n   734→;;; Don't create the backup file\n   735→(setq backup-inhibited t)\n   736→\n   737→;;; Deleting the save files when it was exited.\n   738→(setq delete-auto-save-files t)\n   739→\n   740→;; Configuration for Japanese and English\n   741→;; http://www.alles.or.jp/~torutk/oojava/meadow/Meadow210Install.html\n   742→(defun my/dabbrev-expand-japanese-advice (orig-fun &rest args)\n   743→  \"Modify `dabbrev-abbrev-char-regexp' dynamically for Japanese words.\"\n   744→  (if (bobp)\n   745→      (apply orig-fun args)\n   746→    (let ((dabbrev-abbrev-char-regexp\n   747→           (let ((c (char-category-set (char-before))))\n   748→             (cond\n   749→              ((aref c ?a) \"[-_A-Za-z0-9]\") ; ASCII\n   750→              ((aref c ?j) ; Japanese\n   751→               (cond\n   752→                ((aref c ?K) \"\\\\cK\") ; katakana\n   753→                ((aref c ?A) \"\\\\cA\") ; 2byte alphanumeric\n   754→                ((aref c ?H) \"\\\\cH\") ; hiragana\n   755→                ((aref c ?C) \"\\\\cC\") ; kanji\n   756→                (t \"\\\\cj\")))\n   757→              ((aref c ?k) \"\\\\ck\") ; hankaku-kana\n   758→              ((aref c ?r) \"\\\\cr\") ; Japanese roman ?\n   759→              (t dabbrev-abbrev-char-regexp)))))\n   760→      (apply orig-fun args))))\n   761→\n   762→(advice-add 'dabbrev-expand :around #'my/dabbrev-expand-japanese-advice)\n   763→\n   764→;; Configuration Backspace\n   765→(delete-selection-mode 1)\n   766→\n   767→;; The local variables list in .emacs と言われるのを抑止\n   768→(add-to-list 'ignored-local-variables 'syntax)\n   769→\n   770→;; http://0xcc.net/blog/archives/000041.html\n   771→(set-default-coding-systems 'utf-8)\n   772→\n   773→;; ============================================================\n   774→;; Theme and Colors\n   775→;; ============================================================\n   776→;; modus-vivendi - High contrast dark theme (built-in since Emacs 28)\n   777→;; Part of the modus-themes package by Protesilaos Stavrou\n   778→(load-theme 'modus-vivendi t)\n   779→\n   780→;; Font configuration\n   781→(when window-system\n   782→  (set-frame-font \"Monaco-12\" nil t)\n   783→  (set-frame-parameter nil 'alpha 100))\n   784→\n   785→(setq default-frame-alist\n   786→  (append\n   787→   '((font . \"Monaco-12\") ;; Default Fontset\n   788→  (width . 140) (height . 50) ;; Window Size\n   789→  )\n   790→  default-frame-alist))\n   791→\n   792→;; ============================================================\n   793→;; migemo - Japanese incremental search with Romanization\n   794→;; ============================================================\n   795→;; Requires: brew install cmigemo\n   796→(use-package migemo\n   797→  :if (executable-find \"cmigemo\")\n   798→  :custom\n   799→  (migemo-command \"cmigemo\")\n   800→  (migemo-options '(\"-q\" \"--emacs\"))\n   801→  (migemo-dictionary \"/opt/homebrew/share/migemo/utf-8/migemo-dict\")\n   802→  (migemo-user-dictionary nil)\n   803→  (migemo-regex-dictionary nil)\n   804→  (migemo-coding-system 'utf-8-unix)\n   805→  :config\n   806→  (migemo-init))\n   807→\n   808→;; ============================================================\n   809→;; exec-path-from-shell - Better PATH handling on macOS\n   810→;; ============================================================\n   811→(use-package exec-path-from-shell\n   812→  :if (memq window-system '(mac ns x))\n   813→  :config\n   814→  (exec-path-from-shell-initialize)\n   815→  ;; Copy additional environment variables for development tools\n   816→  (exec-path-from-shell-copy-envs '(\"GOPATH\" \"GOROOT\" \"PYENV_ROOT\" \"VOLTA_HOME\"))\n   817→  ;; Add Volta bin directory to exec-path for npm global packages\n   818→  (when-let ((volta-home (getenv \"VOLTA_HOME\")))\n   819→    (add-to-list 'exec-path (expand-file-name \"bin\" volta-home)))\n   820→  ;; Add pyenv shims to exec-path for pip global packages\n   821→  (let ((pyenv-root (or (getenv \"PYENV_ROOT\")\n   822→                        (expand-file-name \"~/.pyenv\"))))\n   823→    (when (file-directory-p pyenv-root)\n   824→      (add-to-list 'exec-path (expand-file-name \"shims\" pyenv-root)))))\n   825→\n   826→;; ============================================================\n   827→;; Eglot - Built-in LSP client (Emacs 29+)\n   828→;; ============================================================\n   829→(require 'eglot)\n   830→\n   831→;; Don't log every event (improves performance)\n   832→(setq eglot-events-buffer-size 0)\n   833→\n   834→;; Shutdown server when last managed buffer is killed\n   835→(setq eglot-autoshutdown t)\n   836→\n   837→;; ============================================================\n   838→;; Tree-sitter Configuration\n   839→;; ============================================================\n   840→;; Tree-sitter provides accurate syntax highlighting via grammar libraries.\n   841→;; Install grammars with: M-x treesit-install-language-grammar\n   842→;;\n   843→;; Grammar sources for common languages:\n   844→(setq treesit-language-source-alist\n   845→      '((python \"https://github.com/tree-sitter/tree-sitter-python\")\n   846→        (go \"https://github.com/tree-sitter/tree-sitter-go\")\n   847→        (gomod \"https://github.com/camdencheek/tree-sitter-go-mod\")\n   848→        (yaml \"https://github.com/ikatyang/tree-sitter-yaml\")\n   849→        ;; C/C++\n   850→        (c \"https://github.com/tree-sitter/tree-sitter-c\")\n   851→        (cpp \"https://github.com/tree-sitter/tree-sitter-cpp\")\n   852→        ;; JavaScript/TypeScript\n   853→        (javascript \"https://github.com/tree-sitter/tree-sitter-javascript\")\n   854→        (typescript \"https://github.com/tree-sitter/tree-sitter-typescript\" \"master\" \"typescript/src\")\n   855→        (tsx \"https://github.com/tree-sitter/tree-sitter-typescript\" \"master\" \"tsx/src\")\n   856→        ;; JVM languages\n   857→        (java \"https://github.com/tree-sitter/tree-sitter-java\")\n   858→        (kotlin \"https://github.com/fwcd/tree-sitter-kotlin\")\n   859→        (groovy \"https://github.com/murtaza64/tree-sitter-groovy\")))\n   860→\n   861→;; Helper function to check if tree-sitter grammar is actually usable\n   862→(defun my/treesit-available-p (lang)\n   863→  \"Check if tree-sitter grammar for LANG is actually usable.\n   864→Uses treesit-ready-p which verifies the grammar can be loaded.\"\n   865→  (and (fboundp 'treesit-ready-p)\n   866→       (treesit-ready-p lang t)))  ; t = quiet, don't signal error\n   867→\n   868→;; ============================================================\n   869→;; Python Configuration\n   870→;; ============================================================\n   871→;; Uses python-ts-mode if grammar available, otherwise python-mode\n   872→;; LSP servers (install one): pip install python-lsp-server\n   873→;;                        or: pip install basedpyright\n   874→;;                        or: pip install ruff\n   875→\n   876→;; Use tree-sitter mode if grammar is available\n   877→(when (my/treesit-available-p 'python)\n   878→  (add-to-list 'major-mode-remap-alist '(python-mode . python-ts-mode)))\n   879→\n   880→(add-hook 'python-mode-hook 'eglot-ensure)\n   881→(add-hook 'python-ts-mode-hook 'eglot-ensure)\n   882→\n   883→;; Python indentation\n   884→(setq python-indent-offset 4)\n   885→\n   886→;; ============================================================\n   887→;; Go Configuration\n   888→;; ============================================================\n   889→;; Requires: go install golang.org/x/tools/gopls@latest\n   890→\n   891→;; Help project.el find Go project roots (look for go.mod)\n   892→(defun project-find-go-module (dir)\n   893→  \"Find Go module root for DIR by locating go.mod.\"\n   894→  (when-let ((root (locate-dominating-file dir \"go.mod\")))\n   895→    (cons 'go-module root)))\n   896→\n   897→(cl-defmethod project-root ((project (head go-module)))\n   898→  \"Return root directory of Go PROJECT.\"\n   899→  (cdr project))\n   900→\n   901→;; Add Go module detection to project-find-functions\n   902→(add-hook 'project-find-functions #'project-find-go-module)\n   903→\n   904→;; Use tree-sitter mode if grammar is available, otherwise use go-mode\n   905→(if (my/treesit-available-p 'go)\n   906→    (progn\n   907→      (add-to-list 'auto-mode-alist '(\"\\\\.go\\\\'\" . go-ts-mode))\n   908→      (when (my/treesit-available-p 'gomod)\n   909→        (add-to-list 'auto-mode-alist '(\"go\\\\.mod\\\\'\" . go-mod-ts-mode)))\n   910→      (add-hook 'go-ts-mode-hook\n   911→                (lambda ()\n   912→                  (eglot-ensure)\n   913→                  (setq-local indent-tabs-mode t)\n   914→                  (setq-local tab-width 4)\n   915→                  (add-hook 'before-save-hook\n   916→                            (lambda ()\n   917→                              (when (derived-mode-p 'go-ts-mode)\n   918→                                (eglot-format-buffer)))\n   919→                            nil t))))\n   920→  ;; Fallback to go-mode package\n   921→  (use-package go-mode\n   922→    :hook ((go-mode . eglot-ensure)\n   923→           (go-mode . (lambda ()\n   924→                        (setq-local indent-tabs-mode t)\n   925→                        (setq-local tab-width 4)))\n   926→           (go-mode . (lambda ()\n   927→                        (add-hook 'before-save-hook\n   928→                                  (lambda ()\n   929→                                    (when (derived-mode-p 'go-mode)\n   930→                                      (eglot-format-buffer)))\n   931→                                  nil t))))))\n   932→\n   933→;; Gopls configuration\n   934→(setq-default eglot-workspace-configuration\n   935→              '(:gopls (:staticcheck t :usePlaceholders t)))\n   936→\n   937→;; ============================================================\n   938→;; C/C++ Configuration\n   939→;; ============================================================\n   940→;; Uses c-ts-mode and c++-ts-mode if grammars available (built-in Emacs 29+)\n   941→;; LSP: clangd (usually comes with Xcode or LLVM)\n   942→;;   Install: xcode-select --install (macOS)\n   943→;;        or: brew install llvm\n   944→\n   945→;; Use tree-sitter modes if grammars are available\n   946→(when (my/treesit-available-p 'c)\n   947→  (add-to-list 'major-mode-remap-alist '(c-mode . c-ts-mode)))\n   948→\n   949→(when (my/treesit-available-p 'cpp)\n   950→  (add-to-list 'major-mode-remap-alist '(c++-mode . c++-ts-mode))\n   951→  (add-to-list 'auto-mode-alist '(\"\\\\.cpp\\\\'\" . c++-ts-mode))\n   952→  (add-to-list 'auto-mode-alist '(\"\\\\.hpp\\\\'\" . c++-ts-mode))\n   953→  (add-to-list 'auto-mode-alist '(\"\\\\.cc\\\\'\" . c++-ts-mode))\n   954→  (add-to-list 'auto-mode-alist '(\"\\\\.hh\\\\'\" . c++-ts-mode)))\n   955→\n   956→;; Enable Eglot for C/C++ (clangd)\n   957→(add-hook 'c-mode-hook 'eglot-ensure)\n   958→(add-hook 'c-ts-mode-hook 'eglot-ensure)\n   959→(add-hook 'c++-mode-hook 'eglot-ensure)\n   960→(add-hook 'c++-ts-mode-hook 'eglot-ensure)\n   961→\n   962→;; ============================================================\n   963→;; JavaScript / Node.js Configuration\n   964→;; ============================================================\n   965→;; Uses js-ts-mode if grammar available (built-in Emacs 29+)\n   966→;; Requires: npm install -g typescript-language-server typescript\n   967→;; (typescript-language-server also handles JavaScript)\n   968→\n   969→;; Use tree-sitter mode if grammar is available\n   970→(when (my/treesit-available-p 'javascript)\n   971→  (add-to-list 'major-mode-remap-alist '(javascript-mode . js-ts-mode))\n   972→  (add-to-list 'auto-mode-alist '(\"\\\\.js\\\\'\" . js-ts-mode))\n   973→  (add-to-list 'auto-mode-alist '(\"\\\\.mjs\\\\'\" . js-ts-mode))\n   974→  (add-to-list 'auto-mode-alist '(\"\\\\.cjs\\\\'\" . js-ts-mode)))\n   975→\n   976→(add-hook 'js-mode-hook 'eglot-ensure)\n   977→(add-hook 'js-ts-mode-hook 'eglot-ensure)\n   978→\n   979→;; JavaScript indentation\n   980→(setq js-indent-level 2)\n   981→\n   982→;; ============================================================\n   983→;; TypeScript Configuration\n   984→;; ============================================================\n   985→;; Uses typescript-ts-mode if grammar available, otherwise typescript-mode\n   986→;; Requires: npm install -g typescript-language-server typescript\n   987→\n   988→;; TypeScript indentation\n   989→(setq typescript-ts-mode-indent-offset 2)\n   990→\n   991→;; Use tree-sitter mode if grammar available, otherwise typescript-mode package\n   992→(if (my/treesit-available-p 'typescript)\n   993→    (progn\n   994→      (add-to-list 'auto-mode-alist '(\"\\\\.ts\\\\'\" . typescript-ts-mode))\n   995→      (add-hook 'typescript-ts-mode-hook 'eglot-ensure))\n   996→  ;; Fallback to typescript-mode package\n   997→  (use-package typescript-mode\n   998→    :mode \"\\\\.ts\\\\'\"\n   999→    :hook (typescript-mode . eglot-ensure)\n  1000→    :custom\n  1001→    (typescript-indent-level 2)))\n  1002→\n  1003→;; TSX - tree-sitter mode if available, otherwise web-mode as fallback\n  1004→(if (my/treesit-available-p 'tsx)\n  1005→    (progn\n  1006→      (add-to-list 'auto-mode-alist '(\"\\\\.tsx\\\\'\" . tsx-ts-mode))\n  1007→      (add-hook 'tsx-ts-mode-hook 'eglot-ensure))\n  1008→  ;; Fallback to web-mode for TSX\n  1009→  (use-package web-mode\n  1010→    :mode \"\\\\.tsx\\\\'\"\n  1011→    :hook (web-mode . eglot-ensure)\n  1012→    :custom\n  1013→    (web-mode-markup-indent-offset 2)\n  1014→    (web-mode-code-indent-offset 2)))\n  1015→\n  1016→;; ============================================================\n  1017→;; YAML Configuration\n  1018→;; ============================================================\n  1019→;; Optional LSP: npm install -g yaml-language-server\n  1020→\n  1021→;; Use tree-sitter mode if grammar available, otherwise yaml-mode\n  1022→(if (my/treesit-available-p 'yaml)\n  1023→    (progn\n  1024→      (add-to-list 'auto-mode-alist '(\"\\\\.ya?ml\\\\'\" . yaml-ts-mode))\n  1025→      (add-to-list 'auto-mode-alist '(\"\\\\.eyaml\\\\'\" . yaml-ts-mode))\n  1026→      (add-hook 'yaml-ts-mode-hook\n  1027→                (lambda ()\n  1028→                  (setq-local indent-tabs-mode nil)\n  1029→                  (setq-local tab-width 2)\n  1030→                  (when (executable-find \"yaml-language-server\")\n  1031→                    (eglot-ensure)))))\n  1032→  ;; Fallback to yaml-mode package\n  1033→  (use-package yaml-mode\n  1034→    :mode ((\"\\\\.ya?ml\\\\'\" . yaml-mode)\n  1035→           (\"\\\\.eyaml\\\\'\" . yaml-mode))\n  1036→    :hook ((yaml-mode . (lambda ()\n  1037→                          (setq-local indent-tabs-mode nil)\n  1038→                          (setq-local tab-width 2)\n  1039→                          (when (executable-find \"yaml-language-server\")\n  1040→                            (eglot-ensure)))))))\n  1041→\n  1042→;; ============================================================\n  1043→;; Java Configuration\n  1044→;; ============================================================\n  1045→;; Uses java-ts-mode if grammar available (built-in Emacs 29+)\n  1046→;; Requires: Eclipse JDTLS for LSP\n  1047→;;   macOS: brew install jdtls\n  1048→;;   or download from: https://download.eclipse.org/jdtls/\n  1049→;;\n  1050→;; Note: JDTLS needs a workspace directory for each project\n  1051→\n  1052→;; Use tree-sitter mode if grammar is available\n  1053→(when (my/treesit-available-p 'java)\n  1054→  (add-to-list 'major-mode-remap-alist '(java-mode . java-ts-mode)))\n  1055→\n  1056→;; Configure Eglot for Java (JDTLS)\n  1057→(with-eval-after-load 'eglot\n  1058→  (add-to-list 'eglot-server-programs\n  1059→               '((java-mode java-ts-mode) . (\"jdtls\"))))\n  1060→\n  1061→(add-hook 'java-mode-hook 'eglot-ensure)\n  1062→(add-hook 'java-ts-mode-hook 'eglot-ensure)\n  1063→\n  1064→;; Java indentation\n  1065→(add-hook 'java-mode-hook\n  1066→          (lambda ()\n  1067→            (setq-local c-basic-offset 4)\n  1068→            (setq-local tab-width 4)\n  1069→            (setq-local indent-tabs-mode nil)))\n  1070→(add-hook 'java-ts-mode-hook\n  1071→          (lambda ()\n  1072→            (setq-local c-basic-offset 4)\n  1073→            (setq-local tab-width 4)\n  1074→            (setq-local indent-tabs-mode nil)))\n  1075→\n  1076→;; ============================================================\n  1077→;; Kotlin Configuration\n  1078→;; ============================================================\n  1079→;; Uses kotlin-mode package (no built-in kotlin-ts-mode in Emacs yet)\n  1080→;; Tree-sitter grammar available at: https://github.com/fwcd/tree-sitter-kotlin\n  1081→;; Requires: kotlin-language-server for LSP\n  1082→;;   Install: brew install kotlin-language-server\n  1083→;;        or: https://github.com/fwcd/kotlin-language-server\n  1084→\n  1085→;; Configure Eglot for Kotlin\n  1086→(with-eval-after-load 'eglot\n  1087→  (add-to-list 'eglot-server-programs\n  1088→               '(kotlin-mode . (\"kotlin-language-server\"))))\n  1089→\n  1090→;; Use kotlin-mode package\n  1091→(use-package kotlin-mode\n  1092→  :ensure t\n  1093→  :mode ((\"\\\\.kt\\\\'\" . kotlin-mode)\n  1094→         (\"\\\\.kts\\\\'\" . kotlin-mode))\n  1095→  :hook ((kotlin-mode . eglot-ensure)\n  1096→         (kotlin-mode . (lambda ()\n  1097→                          (setq-local tab-width 4)\n  1098→                          (setq-local indent-tabs-mode nil)))))\n  1099→\n  1100→;; ============================================================\n  1101→;; Gradle / Groovy Configuration\n  1102→;; ============================================================\n  1103→;; Uses groovy-mode package (no built-in groovy-ts-mode in Emacs yet)\n  1104→;; Tree-sitter grammar available at: https://github.com/murtaza64/tree-sitter-groovy\n  1105→;;\n  1106→;; Gradle build files come in two flavors:\n  1107→;; - .gradle files: Groovy DSL (use groovy-mode)\n  1108→;; - .gradle.kts files: Kotlin DSL (use kotlin-mode)\n  1109→;;\n  1110→;; Optional LSP: gradle-language-server (experimental)\n  1111→;;   Install: npm install -g gradle-language-server\n  1112→\n  1113→;; Groovy mode for .gradle and .groovy files\n  1114→(use-package groovy-mode\n  1115→  :ensure t\n  1116→  :mode ((\"\\\\.gradle\\\\'\" . groovy-mode)\n  1117→         (\"\\\\.groovy\\\\'\" . groovy-mode))\n  1118→  :config\n  1119→  (setq groovy-indent-offset 4))\n  1120→\n  1121→;; For .gradle.kts files, use Kotlin mode (already configured above)\n  1122→;; The \"\\\\.kts\\\\'\" pattern in kotlin configuration handles build.gradle.kts\n  1123→\n  1124→;; ============================================================\n  1125→;; Markdown Configuration\n  1126→;; ============================================================\n  1127→;; Optional: brew install pandoc (for preview/export)\n  1128→\n  1129→(use-package markdown-mode\n  1130→  :mode ((\"README\\\\.md\\\\'\" . gfm-mode)\n  1131→         (\"\\\\.md\\\\'\" . markdown-mode)\n  1132→         (\"\\\\.markdown\\\\'\" . markdown-mode))\n  1133→  :config\n  1134→  ;; Use pandoc for markdown processing if available\n  1135→  (when (executable-find \"pandoc\")\n  1136→    (setq markdown-command\n  1137→          (if (executable-find \"mermaid-filter\")\n  1138→              \"pandoc --filter mermaid-filter\"\n  1139→            \"pandoc\")))\n  1140→  ;; Open live preview window on the right side\n  1141→  (defun my/markdown-live-preview-window-right (file)\n  1142→    \"Open markdown live preview in a window on the right side.\"\n  1143→    (eww-open-file file)\n  1144→    (let ((buf (if (bound-and-true-p eww-auto-rename-buffer)\n  1145→                   (cl-loop for b in (buffer-list)\n  1146→                            when (string-match-p \"eww\\\\*\\\\'\" (buffer-name b))\n  1147→                            return b)\n  1148→                 (get-buffer \"*eww*\"))))\n  1149→      (pop-to-buffer buf '((display-buffer-in-direction)\n  1150→                           (direction . right)\n  1151→                           (window-width . 0.5)))\n  1152→      buf))\n  1153→  (setq markdown-live-preview-window-function #'my/markdown-live-preview-window-right)\n  1154→  :custom\n  1155→  (markdown-enable-math t)\n  1156→  (markdown-fontify-code-blocks-natively t)\n  1157→  ;; Delete exported HTML files after live preview\n  1158→  (markdown-live-preview-delete-export 'delete-on-export))\n  1159→\n  1160→;; grip-mode - GitHub-flavored Markdown preview\n  1161→;; Uses go-grip for local rendering (no GitHub API needed)\n  1162→;; Requires: go install github.com/chrishrb/go-grip@latest\n  1163→(use-package grip-mode\n  1164→  :ensure t\n  1165→  :after markdown-mode\n  1166→  :bind (:map markdown-mode-command-map\n  1167→         (\"g\" . grip-mode))\n  1168→  :custom\n  1169→  (grip-command 'go-grip)           ; Use go-grip (no GitHub API)\n  1170→  (grip-preview-use-webkit nil))    ; Use external browser\n  1171→\n  1172→;; ============================================================\n  1173→;; Terminal Emulators\n  1174→;; ============================================================\n  1175→;; vterm - Full-featured terminal emulator (requires libvterm)\n  1176→;; Requires: brew install libvterm\n  1177→(use-package vterm\n  1178→  :ensure t\n  1179→  :demand t  ; Load eagerly so it's available for claude-code\n  1180→  :custom\n  1181→  ;; Large scrollback buffer for Claude Code history (default is 1000)\n  1182→  (vterm-max-scrollback 100000)\n  1183→  :config\n  1184→  ;; Disable modes that interfere with terminal input\n  1185→  (defun my/vterm-mode-setup ()\n  1186→    \"Setup vterm buffer for proper terminal input.\"\n  1187→    (setq-local global-hl-line-mode nil)\n  1188→    (setq-local line-spacing nil)\n  1189→    ;; Disable modes that intercept keyboard input\n  1190→    (smartparens-mode -1)\n  1191→    (company-mode -1)\n  1192→    (yas-minor-mode -1)\n  1193→    ;; Ensure vterm handles all input\n  1194→    (setq-local scroll-margin 0)\n  1195→    ;; Fix border overflow and alignment (UI rendering issues)\n  1196→    (when (fboundp 'set-window-fringes)\n  1197→      (set-window-fringes (selected-window) 0 0))  ; Remove fringes (GUI only)\n  1198→    (setq-local truncate-lines t)  ; Let vterm/Claude Code handle wrapping\n  1199→    (when (bound-and-true-p display-line-numbers-mode)\n  1200→      (display-line-numbers-mode -1)))  ; Disable line numbers\n  1201→  (add-hook 'vterm-mode-hook #'my/vterm-mode-setup)\n  1202→\n  1203→  ;; Prevent vterm windows from getting too narrow (for Claude Code display)\n  1204→  (defvar my/vterm-min-width 80\n  1205→    \"Minimum width for vterm windows.\")\n  1206→\n  1207→  (defun my/vterm-enforce-min-width ()\n  1208→    \"Enlarge vterm window if it's too narrow.\"\n  1209→    (when (and (eq major-mode 'vterm-mode)\n  1210→               (< (window-width) my/vterm-min-width)\n  1211→               (window-resizable nil (- my/vterm-min-width (window-width)) t))\n  1212→      (enlarge-window-horizontally (- my/vterm-min-width (window-width)))))\n  1213→\n  1214→  (add-hook 'window-configuration-change-hook #'my/vterm-enforce-min-width)\n  1215→\n  1216→  ;; Mouse wheel scrolling - enters copy mode to scroll through full history\n  1217→  (defun my/vterm-scroll-up ()\n  1218→    \"Scroll up in vterm, entering copy mode to access full scrollback.\"\n  1219→    (interactive)\n  1220→    (unless vterm-copy-mode\n  1221→      (vterm-copy-mode 1))\n  1222→    (scroll-down-command 3))\n  1223→  (defun my/vterm-scroll-down ()\n  1224→    \"Scroll down in vterm. Exit copy mode when reaching the bottom.\"\n  1225→    (interactive)\n  1226→    (if vterm-copy-mode\n  1227→        (progn\n  1228→          (scroll-up-command 3)\n  1229→          ;; Exit copy mode if we're at the bottom (end of buffer visible)\n  1230→          (when (pos-visible-in-window-p (point-max))\n  1231→            (vterm-copy-mode -1)))\n  1232→      (scroll-up-command 3)))\n  1233→  (define-key vterm-mode-map (kbd \"<mouse-4>\") #'my/vterm-scroll-up)\n  1234→  (define-key vterm-mode-map (kbd \"<mouse-5>\") #'my/vterm-scroll-down)\n  1235→  (define-key vterm-mode-map (kbd \"<wheel-up>\") #'my/vterm-scroll-up)\n  1236→  (define-key vterm-mode-map (kbd \"<wheel-down>\") #'my/vterm-scroll-down)\n  1237→  ;; Keybindings to send Escape to terminal (for Claude Code cancel)\n  1238→  (define-key vterm-mode-map (kbd \"C-c C-e\") #'vterm-send-escape)\n  1239→  (define-key vterm-mode-map (kbd \"C-c <escape>\") #'vterm-send-escape)\n  1240→\n  1241→  ;; Copy mode with mouse support\n  1242→  ;; Click to enter copy mode and set mark, drag to select, release to copy\n  1243→  (defun my/vterm-mouse-select-start (event)\n  1244→    \"Start mouse selection in vterm - enters copy mode and sets mark.\"\n  1245→    (interactive \"e\")\n  1246→    (unless vterm-copy-mode\n  1247→      (vterm-copy-mode 1))\n  1248→    (mouse-set-point event)\n  1249→    (push-mark (point) t t))\n  1250→\n  1251→  (defun my/vterm-mouse-select-end (event)\n  1252→    \"End mouse selection in vterm - copies region to clipboard.\"\n  1253→    (interactive \"e\")\n  1254→    (when vterm-copy-mode\n  1255→      (mouse-set-point event)\n  1256→      (when (use-region-p)\n  1257→        (kill-ring-save (region-beginning) (region-end))\n  1258→        (message \"Copied to clipboard\"))))\n  1259→\n  1260→  ;; Mouse drag selection that copies to kill-ring\n  1261→  (defun my/vterm-mouse-drag-copy (start-event)\n  1262→    \"Select region with mouse drag and copy to kill-ring.\"\n  1263→    (interactive \"e\")\n  1264→    (unless vterm-copy-mode\n  1265→      (vterm-copy-mode 1))\n  1266→    (mouse-drag-region start-event)\n  1267→    (when (use-region-p)\n  1268→      (kill-ring-save (region-beginning) (region-end))\n  1269→      (message \"Copied to clipboard\")))\n  1270→\n  1271→  ;; Mouse bindings for copy mode - DISABLED for testing\n  1272→  ;; (define-key vterm-mode-map (kbd \"<down-mouse-1>\") #'my/vterm-mouse-drag-copy)\n  1273→\n  1274→  ;; Paste from kill-ring into vterm\n  1275→  (define-key vterm-mode-map (kbd \"C-y\") #'vterm-yank)\n  1276→  (define-key vterm-mode-map (kbd \"M-y\") #'vterm-yank-pop)\n  1277→\n  1278→  ;; Copy mode keybindings\n  1279→  ;; C-c C-t: enter copy mode (default vterm binding)\n  1280→  ;; Select with mouse or keyboard, then:\n  1281→  (define-key vterm-copy-mode-map (kbd \"M-w\") #'vterm-copy-mode-done)  ; Copy and exit\n  1282→  (define-key vterm-copy-mode-map (kbd \"M-c\") #'vterm-copy-mode-done)  ; Cmd+c (mac-command = meta)\n  1283→  (define-key vterm-copy-mode-map (kbd \"C-c C-c\") #'vterm-copy-mode-done)\n  1284→  (define-key vterm-copy-mode-map (kbd \"q\") #'vterm-copy-mode)  ; Exit without copying\n  1285→  (define-key vterm-copy-mode-map (kbd \"<return>\") #'vterm-copy-mode-done))\n  1286→\n  1287→;; eat - Emulate A Terminal (pure elisp, no external dependencies)\n  1288→(use-package eat\n  1289→  :commands eat)\n  1290→\n  1291→;; ============================================================\n  1292→;; Claude Code Integration\n  1293→;; ============================================================\n  1294→;; Requires: brew install --cask claude-code (already installed)\n  1295→;;           brew install libvterm (already installed)\n  1296→\n  1297→;; transient - Required dependency for claude-code.el (menu system)\n  1298→(use-package transient\n  1299→  :ensure t)\n  1300→\n  1301→;; inheritenv - Required dependency for claude-code.el (environment handling)\n  1302→(use-package inheritenv\n  1303→  :vc (:url \"https://github.com/purcell/inheritenv\" :rev :newest))\n  1304→\n  1305→(use-package claude-code\n  1306→  :vc (:url \"https://github.com/stevemolitor/claude-code.el\" :rev :newest)\n  1307→  :demand t  ; Load immediately, don't defer\n  1308→  :after vterm  ; Ensure vterm is loaded first\n  1309→  :init\n  1310→  ;; Set these BEFORE package loads (defcustom defaults are read at load time)\n  1311→  (setq claude-code-terminal-backend 'vterm)   ; Use vterm for best TUI experience\n  1312→  (setq claude-code-program \"claude\")       ; CLI program name\n  1313→  (require 'vterm)  ; Ensure vterm is available\n  1314→  :config\n  1315→  (claude-code-mode)  ; Enable global minor mode for IDE integration\n  1316→  ;; Set up keybindings explicitly (more reliable than :bind-keymap with :vc)\n  1317→  (global-set-key (kbd \"C-c c\") claude-code-command-map))\n  1318→\n  1319→(custom-set-variables\n  1320→ ;; custom-set-variables was added by Custom.\n  1321→ ;; If you edit it by hand, you could mess it up, so be careful.\n  1322→ ;; Your init file should contain only one such instance.\n  1323→ ;; If there is more than one, they won't work right.\n  1324→ '(company-show-quick-access t nil nil \"Customized with use-package company\")\n  1325→ '(package-selected-packages nil))\n  1326→(custom-set-faces\n  1327→ ;; custom-set-faces was added by Custom.\n  1328→ ;; If you edit it by hand, you could mess it up, so be careful.\n  1329→ ;; Your init file should contain only one such instance.\n  1330→ ;; If there is more than one, they won't work right.\n  1331→ )\n  1332→\n  1333→;;; init.el ends here\n  1334→"}]},"uuid":"946fb232-b513-43c4-bfca-51ced40f0a20","timestamp":"2026-02-21T18:16:49.752Z","toolUseResult":{"type":"text","file":{"filePath":"/Users/naokisega/src/github.com/nsega/.emacs.d/init.el","content":";;; init.el --- Modern Emacs Configuration -*- lexical-binding: t; -*-\n\n;; Author: Naoki Sega\n;; Maintainer: Naoki Sega\n;; URL: https://github.com/nsega/.emacs.d\n;; Keywords: convenience\n\n;;; Commentary:\n\n;; Modern Emacs configuration using use-package for declarative package management.\n;; Migrated from traditional setup to use modern best practices for Emacs 30+.\n;;\n;; Key Features:\n;; - Vertico ecosystem for lightweight, fast completion (replaces Helm)\n;; - Eglot LSP for intelligent code navigation (Python, Go, TypeScript)\n;; - Tree-sitter modes for Python, Go, YAML (accurate syntax highlighting)\n;; - Company-mode for auto-completion\n;; - Modern advice-add instead of deprecated defadvice\n;; - Single, well-organized init.el (no separate custom/*.el files)\n;; - early-init.el for faster startup and no UI flickering\n;; - no-littering for clean .emacs.d directory\n;;\n;; Package Management:\n;; - Uses use-package for all package configuration\n;; - Lazy loading where appropriate for fast startup\n;; - Self-documenting package declarations\n;;\n;; Completion Framework:\n;; - vertico: Vertical completion UI\n;; - consult: Enhanced completing-read commands\n;; - marginalia: Rich annotations in minibuffer\n;; - embark: Contextual actions on completion candidates\n;; - orderless: Flexible matching style\n;;\n;; Code Intelligence:\n;; - Eglot: Built-in LSP client (Emacs 29+)\n;; - Company: Auto-completion framework\n;; - dumb-jump: Fallback navigation for non-LSP files\n;;\n;; For more information, see: https://github.com/nsega/.emacs.d\n\n;;; Code:\n\n;; ============================================================\n;; Package Management\n;; ============================================================\n(require 'package)\n(add-to-list 'package-archives\n             '(\"melpa\" . \"https://melpa.org/packages/\") t)\n(package-initialize)\n\n;; ============================================================\n;; Bootstrap use-package\n;; ============================================================\n(unless (package-installed-p 'use-package)\n  (package-refresh-contents)\n  (package-install 'use-package))\n\n(eval-when-compile (require 'use-package))\n(setq use-package-always-ensure t)\n(setq use-package-compute-statistics t)  ; For performance monitoring via M-x use-package-report\n\n;; ============================================================\n;; Directory Organization - no-littering\n;; ============================================================\n;; Keep .emacs.d clean by redirecting package files to var/ and etc/\n(use-package no-littering\n  :demand t  ; Load early to affect all subsequent packages\n  :config\n  ;; Put auto-save files in var directory\n  (setq auto-save-file-name-transforms\n        `((\".*\" ,(no-littering-expand-var-file-name \"auto-save/\") t)))\n  ;; Put native-comp cache in var directory (only if native-comp is available)\n  (when (and (fboundp 'startup-redirect-eln-cache)\n             (boundp 'native-comp-eln-load-path))\n    (startup-redirect-eln-cache\n     (convert-standard-filename\n      (expand-file-name \"var/eln-cache/\" user-emacs-directory)))))\n\n;; Pre-configure claude-code to use vterm (must be set before package loads)\n(setq claude-code-terminal-backend 'vterm)\n\n;; ============================================================\n;; Basic Settings\n;; ============================================================\n;; NOTE: gc-cons-threshold is set in early-init.el for faster startup\n;; and automatically reset after Emacs finishes loading\n(setq inhibit-startup-message t)\n\n;; Suppress byte-compile warnings from packages\n(setq byte-compile-warnings '(not obsolete))\n(setq warning-suppress-log-types '((comp) (bytecomp)))\n(setq native-comp-async-report-warnings-errors 'silent)\n\n;; PATH setup is handled by exec-path-from-shell (see below)\n;; This ensures Emacs inherits PATH from your shell\n(setq exec-path (cons \"/opt/homebrew/bin\" exec-path))\n(setq exec-path (cons \"/usr/local/bin\" exec-path))\n\n(defalias 'yes-or-no-p 'y-or-n-p)\n\n;; ============================================================\n;; macOS Clipboard Integration\n;; ============================================================\n;; Sync kill ring with macOS system clipboard via pbcopy/pbpaste\n(when (eq system-type 'darwin)\n  (setq interprogram-cut-function\n        (lambda (text &optional _)\n          (let ((process-connection-type nil))\n            (let ((proc (start-process \"pbcopy\" nil \"pbcopy\")))\n              (process-send-string proc text)\n              (process-send-eof proc)))))\n  (setq interprogram-paste-function\n        (lambda ()\n          (let ((clipboard (shell-command-to-string \"pbpaste\")))\n            (unless (string= clipboard (car kill-ring))\n              clipboard)))))\n\n;; ============================================================\n;; macOS Native Scrolling\n;; ============================================================\n;; Enable pixel-precise scrolling for smooth trackpad experience\n;; Makes Emacs feel like a native macOS application (Emacs 29+)\n(when (fboundp 'pixel-scroll-precision-mode)\n  (pixel-scroll-precision-mode 1))\n\n;; ============================================================\n;; Mouse Support (Terminal and GUI)\n;; ============================================================\n;; Enable mouse in terminal emulators (Ghostty, iTerm2, etc.)\n;; Safe to enable always - only activates in terminal frames\n(xterm-mouse-mode 1)\n\n;; Auto-copy mouse selection to clipboard (like typical terminal behavior)\n(setq mouse-drag-copy-region t)\n\n;; Mouse wheel scrolling (works in both terminal and GUI)\n(global-set-key [mouse-4] 'scroll-down-command)\n(global-set-key [mouse-5] 'scroll-up-command)\n\n;; Drag mode-line to resize windows vertically (click and drag the status bar)\n;; Drag vertical border to resize windows horizontally\n(global-set-key [mode-line mouse-1] 'mouse-drag-mode-line)\n(global-set-key [vertical-line mouse-1] 'mouse-drag-vertical-line)\n\n;; Scroll through buffer history with mouse wheel on mode-line\n(global-set-key [mode-line mouse-4] 'previous-buffer)\n(global-set-key [mode-line mouse-5] 'next-buffer)\n(global-set-key [mode-line wheel-up] 'previous-buffer)\n(global-set-key [mode-line wheel-down] 'next-buffer)\n\n;; Or use Ctrl+wheel anywhere to switch buffers\n(global-set-key [C-mouse-4] 'previous-buffer)\n(global-set-key [C-mouse-5] 'next-buffer)\n(global-set-key [C-wheel-up] 'previous-buffer)\n(global-set-key [C-wheel-down] 'next-buffer)\n\n;; Window layout undo/redo\n;; C-c <left> to undo, C-c <right> to redo window configuration\n;; Note: May conflict with org-mode/markdown-mode C-c bindings in those buffers\n(winner-mode 1)\n\n;; Allow resizing side windows (help, compilation, etc.) via mouse drag\n(setq window-resize-pixelwise t)  ; Precise pixel resizing for smoother drag\n(setq window-sides-slots '(1 1 1 1))  ; Allow side windows on all sides\n;; Don't preserve side window sizes - allow free resizing\n(setq window-sides-vertical nil)  ; Side windows on left/right don't span full height\n(add-to-list 'window-persistent-parameters '(window-side . writable))\n\n;; GUI-only: window dividers for easier grabbing\n(when (display-graphic-p)\n  (setq window-divider-default-places t)\n  (setq window-divider-default-right-width 6)  ; Wider for easier grabbing\n  (setq window-divider-default-bottom-width 6)\n  (window-divider-mode 1)\n  (global-set-key [right-divider mouse-1] 'mouse-drag-vertical-line)\n  (global-set-key [bottom-divider mouse-1] 'mouse-drag-mode-line))\n\n;; ============================================================\n;; Terminal Vertical Split Display Fix\n;; ============================================================\n;; Prevent text overflow between vertically split windows in terminal\n(unless (display-graphic-p)\n  ;; Force line truncation in split windows to prevent overflow\n  (setq truncate-partial-width-windows t)\n  (setq-default truncate-lines t)  ; Truncate all lines in terminal\n  ;; Use ASCII vertical bar for window border (Unicode can cause width issues)\n  (set-display-table-slot standard-display-table 'vertical-border ?|)\n  ;; Ensure no margins\n  (setq-default left-margin-width 0)\n  (setq-default right-margin-width 0)\n  ;; Disable word wrap that can cause overflow\n  (setq-default word-wrap nil)\n  (global-visual-line-mode -1))\n\n;; ============================================================\n;; Frame/Terminal Title - Show project name in window list\n;; ============================================================\n;; This makes it easy to identify Emacs instances in Ghostty/terminal window lists\n\n(defun my/get-frame-title ()\n  \"Return a title string showing project and current buffer.\"\n  (let ((project (project-current)))\n    (format \"emacs [%s] - %s\"\n            (if project\n                (project-name project)\n              (abbreviate-file-name default-directory))\n            (buffer-name))))\n\n;; GUI Emacs: Set frame title\n(setq frame-title-format '(:eval (my/get-frame-title)))\n\n;; Terminal Emacs: Send escape sequence to set terminal window title\n(defun my/set-terminal-title ()\n  \"Set terminal window title to project name or directory.\"\n  (when (and (not (display-graphic-p))\n             (getenv \"TERM\"))\n    (send-string-to-terminal\n     (format \"\\033]0;%s\\007\" (my/get-frame-title)))))\n\n;; Update terminal title on relevant events\n(unless (display-graphic-p)\n  (add-hook 'buffer-list-update-hook #'my/set-terminal-title)\n  (add-hook 'window-configuration-change-hook #'my/set-terminal-title)\n  ;; Set initial title\n  (add-hook 'emacs-startup-hook #'my/set-terminal-title))\n\n(defconst demo-packages\n  '(anzu\n    company\n    ;; duplicate-thing  ; removed - no longer available on MELPA\n    ;; Completion framework - Vertico ecosystem (replaces Helm)\n    vertico\n    orderless\n    marginalia\n    consult\n    embark\n    embark-consult\n    migemo\n    ;; function-args\n    clean-aindent-mode\n    comment-dwim-2\n    dtrt-indent\n    ws-butler\n    iedit\n    yasnippet\n    smartparens\n    volatile-highlights\n    undo-tree\n    zygospore\n    ;; Modern language modes\n    exec-path-from-shell  ; Better PATH handling on macOS\n    go-mode               ; Go support (fallback if tree-sitter grammar unavailable)\n    yaml-mode             ; YAML support (fallback if tree-sitter grammar unavailable)\n    typescript-mode       ; TypeScript support (fallback if tree-sitter grammar unavailable)\n    web-mode              ; TSX/JSX support (fallback if tree-sitter grammar unavailable)\n    markdown-mode         ; Markdown support\n    ;; JVM languages\n    kotlin-mode           ; Kotlin support (fallback if tree-sitter grammar unavailable)\n    groovy-mode           ; Groovy/Gradle support\n    ;; Navigation fallback\n    dumb-jump             ; Jump to definition without tags/LSP\n    ;; Terminal\n    vterm                 ; Terminal emulator for Claude Code\n    eat                   ; Emulate A Terminal (another terminal emulator)\n    ))\n\n(defun install-packages ()\n  \"Install all required packages.\"\n  (interactive)\n  (unless package-archive-contents\n    (package-refresh-contents))\n  (dolist (package demo-packages)\n    (unless (package-installed-p package)\n      (package-install package))))\n\n(install-packages)\n\n;; ============================================================\n;; Navigation Enhancements\n;; ============================================================\n;; M-. (xref-find-definitions) and M-? (xref-find-references) are\n;; built-in bindings. Eglot automatically registers as xref backend.\n\n;; ============================================================\n;; dumb-jump - Fallback navigation when no tags/LSP available\n;; ============================================================\n(use-package dumb-jump\n  :config\n  (add-hook 'xref-backend-functions #'dumb-jump-xref-activate)\n  :custom\n  (dumb-jump-prefer-searcher 'rg)  ; Use ripgrep if available\n  (dumb-jump-force-searcher nil))\n\n;; ============================================================\n;; Completion - Company Mode\n;; ============================================================\n(use-package company\n  :hook (after-init . global-company-mode)\n  :config\n  (delete 'company-semantic company-backends)\n  ;; Add tab completion for C/C++ modes\n  (add-hook 'c-mode-hook\n            (lambda ()\n              (local-set-key (kbd \"<tab>\") 'company-complete)))\n  (add-hook 'c++-mode-hook\n            (lambda ()\n              (local-set-key (kbd \"<tab>\") 'company-complete)))\n  :custom\n  (company-idle-delay 0.1)\n  (company-minimum-prefix-length 2)\n  (company-show-numbers t))\n\n(use-package company-c-headers\n  :after company\n  :config\n  (add-to-list 'company-backends 'company-c-headers))\n\n;; hs-minor-mode for folding source code\n(add-hook 'c-mode-common-hook 'hs-minor-mode)\n\n;; Available C style:\n;; “gnu”: The default style for GNU projects\n;; “k&r”: What Kernighan and Ritchie, the authors of C used in their book\n;; “bsd”: What BSD developers use, aka “Allman style” after Eric Allman.\n;; “whitesmith”: Popularized by the examples that came with Whitesmiths C, an early commercial C compiler.\n;; “stroustrup”: What Stroustrup, the author of C++ used in his book\n;; “ellemtel”: Popular C++ coding standards as defined by “Programming in C++, Rules and Recommendations,” Erik Nyquist and Mats Henricson, Ellemtel\n;; “linux”: What the Linux developers use for kernel development\n;; “python”: What Python developers use for extension modules\n;; “java”: The default style for java-mode (see below)\n;; “user”: When you want to define your own style\n(setq\n c-default-style \"linux\" ;; set style to \"linux\"\n )\n\n(global-set-key (kbd \"RET\") 'newline-and-indent)  ; automatically indent when press RET\n\n;; activate whitespace-mode to view all whitespace characters\n(global-set-key (kbd \"C-c w\") 'whitespace-mode)\n\n;; show unncessary whitespace that can mess up your diff\n(add-hook 'prog-mode-hook (lambda () (interactive) (setq show-trailing-whitespace 1)))\n\n;; use space to indent by default\n(setq-default indent-tabs-mode nil)\n\n;; set appearance of a tab that is represented by 4 spaces\n(setq-default tab-width 4)\n\n;; Compilation\n(global-set-key (kbd \"<f5>\") (lambda ()\n                               (interactive)\n                               (setq-local compilation-read-command nil)\n                               (call-interactively 'compile)))\n\n;; setup GDB\n(setq\n ;; use gdb-many-windows by default\n gdb-many-windows t\n\n ;; Non-nil means display source file containing the main routine at startup\n gdb-show-main t\n )\n\n;; ============================================================\n;; Completion Framework - Vertico Ecosystem\n;; ============================================================\n\n;; vertico - Vertical completion UI\n(use-package vertico\n  :init\n  (vertico-mode)\n  :custom\n  (vertico-cycle t)\n  :bind (:map vertico-map\n              (\"C-j\" . vertico-next)\n              (\"C-k\" . vertico-previous)))\n\n;; orderless - Flexible completion matching\n(use-package orderless\n  :custom\n  (completion-styles '(orderless basic))\n  (completion-category-defaults nil)\n  (completion-category-overrides '((file (styles partial-completion)))))\n\n;; marginalia - Rich annotations in minibuffer\n(use-package marginalia\n  :init\n  (marginalia-mode))\n\n;; consult - Consulting completing-read\n(use-package consult\n  :bind ((\"C-x b\" . consult-buffer)\n         (\"M-g i\" . consult-imenu)\n         (\"M-s l\" . consult-line)\n         (\"M-s g\" . consult-grep)\n         (\"M-s r\" . consult-ripgrep)\n         (\"M-y\" . consult-yank-pop)\n         ;; Alternative bindings for terminal (M-s often conflicts)\n         (\"C-c s l\" . consult-line)       ; Alternative to M-s l\n         (\"C-c s g\" . consult-grep)       ; Alternative to M-s g\n         (\"C-c s r\" . consult-ripgrep)    ; Alternative to M-s r\n         (\"C-c s i\" . consult-imenu)      ; Alternative to M-g i\n         :map minibuffer-local-map\n         (\"M-p\" . consult-history)))\n\n;; embark - Contextual actions\n(use-package embark\n  :bind ((\"C-.\" . embark-act)\n         (\"C-c e b\" . embark-bindings)))  ; C-h B conflicts with C-h as backspace\n\n;; embark-consult - Integration between embark and consult\n(use-package embark-consult\n  :after (embark consult))\n\n;; ============================================================\n;; Editing Enhancements (use-package)\n;; ============================================================\n\n;; Package: clean-aindent-mode - Clean auto-indent and backspace behavior\n(use-package clean-aindent-mode\n  :hook (prog-mode . clean-aindent-mode))\n\n;; Package: dtrt-indent - Detect indent style automatically\n(use-package dtrt-indent\n  :config\n  (dtrt-indent-mode 1)\n  (setq dtrt-indent-verbosity 0))\n\n;; Package: ws-butler - Trim whitespace only on edited lines\n(use-package ws-butler\n  :hook ((prog-mode . ws-butler-mode)\n         (text-mode . ws-butler-mode)\n         (fundamental-mode . ws-butler-mode)))\n\n;; Package: yasnippet - Template system\n(use-package yasnippet\n  :config\n  (yas-global-mode 1)\n  ;; Don't activate in terminal mode\n  (add-hook 'term-mode-hook (lambda() (setq yas-dont-activate t)))\n  :custom\n  (yas-verbosity 1)\n  (yas-wrap-around-region t)\n  (yas-prompt-functions '(yas/ido-prompt yas/completing-prompt)))\n\n;; Package: smartparens - Parenthesis management\n(use-package smartparens\n  :config\n  (require 'smartparens-config)\n  (setq sp-base-key-bindings 'paredit)\n  (setq sp-autoskip-closing-pair 'always)\n  (setq sp-hybrid-kill-entire-symbol nil)\n  (sp-use-paredit-bindings)\n  (show-smartparens-global-mode +1)\n  (smartparens-global-mode 1))\n\n;; ============================================================\n;; Project Management - Built-in project.el (Emacs 28+)\n;; ============================================================\n;; project.el is built-in and integrates natively with Eglot, xref, and Consult.\n;; Default prefix: C-x p\n\n(setq project-switch-commands\n      '((project-find-file \"Find file\" ?f)\n        (project-find-regexp \"Find regexp\" ?g)\n        (project-find-dir \"Find directory\" ?d)\n        (project-eshell \"Eshell\" ?e)))\n\n;; ============================================================\n;; Dired Configuration\n;; ============================================================\n;; Auto-revert Dired buffer when switching to it (picks up filesystem changes)\n(setq dired-auto-revert-buffer t)\n\n;; Package: zygospore - Reversible C-x 1 (delete-other-windows)\n(use-package zygospore\n  :bind ((\"C-x 1\" . zygospore-toggle-delete-other-windows)))\n\n;; Package: anzu - Show match count in mode-line while searching\n(use-package anzu\n  :config\n  (global-anzu-mode)\n  :bind ((\"M-%\" . anzu-query-replace)\n         (\"C-M-%\" . anzu-query-replace-regexp)))\n\n;; Package: volatile-highlights - Highlight changes from yanking, undo, etc.\n(use-package volatile-highlights\n  :config\n  (volatile-highlights-mode t))\n\n;; Package: undo-tree - Visualize undo history as a tree\n(use-package undo-tree\n  :config\n  (global-undo-tree-mode))\n\n;; Package: comment-dwim-2 - Smarter comment/uncomment\n(use-package comment-dwim-2\n  :bind ((\"M-;\" . comment-dwim-2)))\n\n;; Package: iedit - Edit multiple occurrences simultaneously\n(use-package iedit\n  :custom\n  (iedit-toggle-key-default nil)\n  :bind ((\"C-;\" . iedit-mode)))\n\n;; ============================================================\n;; Custom Editing Behaviors (modernized from setup-editing.el)\n;; ============================================================\n\n;; Enhanced kill/copy/yank behaviors using modern advice-add\n\n;; 1. Copy line when no region is active (M-w)\n(defun my/slick-copy-advice (orig-fun &rest args)\n  \"Copy line when no region is active.\"\n  (interactive\n   (if mark-active\n       (list (region-beginning) (region-end))\n     (message \"Copied line\")\n     (list (line-beginning-position)\n           (line-beginning-position 2))))\n  (apply orig-fun args))\n\n(advice-add 'kill-ring-save :around #'my/slick-copy-advice)\n\n;; 2. Cut line when no region is active (C-w)\n(defun my/slick-cut-advice (orig-fun &rest args)\n  \"Cut line when no region is active.\"\n  (interactive\n   (if mark-active\n       (list (region-beginning) (region-end))\n     (list (line-beginning-position)\n           (line-beginning-position 2))))\n  (apply orig-fun args))\n\n(advice-add 'kill-region :around #'my/slick-cut-advice)\n\n;; 3. Clean whitespace before killing line (C-k)\n(defun my/kill-line-whitespace-advice (&rest _args)\n  \"Clean whitespace before killing line in programming modes.\"\n  (when (member major-mode\n                '(emacs-lisp-mode scheme-mode lisp-mode\n                  c-mode c++-mode objc-mode\n                  latex-mode plain-tex-mode))\n    (when (and (eolp) (not (bolp)))\n      (forward-char 1)\n      (just-one-space 0)\n      (backward-char 1))))\n\n(advice-add 'kill-line :before #'my/kill-line-whitespace-advice)\n\n;; 4. Auto-indent yanked text in programming modes (C-y, M-y)\n(defvar yank-indent-modes\n  '(LaTeX-mode TeX-mode)\n  \"Modes in which to indent regions that are yanked (or yank-popped).\nOnly modes that don't derive from `prog-mode' should be listed here.\")\n\n(defvar yank-indent-blacklisted-modes\n  '(python-mode slim-mode haml-mode)\n  \"Modes for which auto-indenting is suppressed.\")\n\n(defvar yank-advised-indent-threshold 1000\n  \"Threshold (# chars) over which indentation does not automatically occur.\")\n\n(defun yank-advised-indent-function (beg end)\n  \"Do indentation, as long as the region isn't too large.\"\n  (if (<= (- end beg) yank-advised-indent-threshold)\n      (indent-region beg end nil)))\n\n(defun my/yank-indent-advice (orig-fun &rest args)\n  \"Auto-indent yanked text in programming modes.\"\n  (let ((result (apply orig-fun args)))\n    (when (and (not (car args))\n               (not (member major-mode yank-indent-blacklisted-modes))\n               (or (derived-mode-p 'prog-mode)\n                   (member major-mode yank-indent-modes)))\n      (let ((transient-mark-mode nil))\n        (yank-advised-indent-function (region-beginning) (region-end))))\n    result))\n\n(advice-add 'yank :around #'my/yank-indent-advice)\n(advice-add 'yank-pop :around #'my/yank-indent-advice)\n\n;; Other useful editing functions from setup-editing.el\n\n;; Smart move to beginning of line (C-a)\n(defun prelude-move-beginning-of-line (arg)\n  \"Move point back to indentation of beginning of line.\n\nMove point to the first non-whitespace character on this line.\nIf point is already there, move to the beginning of the line.\nEffectively toggle between the first non-whitespace character and\nthe beginning of the line.\n\nIf ARG is not nil or 1, move forward ARG - 1 lines first. If\npoint reaches the beginning or end of the buffer, stop there.\"\n  (interactive \"^p\")\n  (setq arg (or arg 1))\n\n  ;; Move lines first\n  (when (/= arg 1)\n    (let ((line-move-visual nil))\n      (forward-line (1- arg))))\n\n  (let ((orig-point (point)))\n    (back-to-indentation)\n    (when (= orig-point (point))\n      (move-beginning-of-line 1))))\n\n(global-set-key (kbd \"C-a\") 'prelude-move-beginning-of-line)\n\n;; Smart open line (M-o)\n(defun prelude-smart-open-line (arg)\n  \"Insert an empty line after the current line.\nPosition the cursor at its beginning, according to the current mode.\nWith a prefix ARG open line above the current line.\"\n  (interactive \"P\")\n  (if arg\n      (prelude-smart-open-line-above)\n    (progn\n      (move-end-of-line nil)\n      (newline-and-indent))))\n\n(defun prelude-smart-open-line-above ()\n  \"Insert an empty line above the current line.\nPosition the cursor at it's beginning, according to the current mode.\"\n  (interactive)\n  (move-beginning-of-line nil)\n  (newline-and-indent)\n  (forward-line -1)\n  (indent-according-to-mode))\n\n(global-set-key (kbd \"M-o\") 'prelude-smart-open-line)\n\n;; Indent buffer or region (C-c i)\n(defun indent-buffer ()\n  \"Indent the currently visited buffer.\"\n  (interactive)\n  (indent-region (point-min) (point-max)))\n\n(defcustom prelude-indent-sensitive-modes\n  '(coffee-mode python-mode slim-mode haml-mode yaml-mode)\n  \"Modes for which auto-indenting is suppressed.\"\n  :type 'list)\n\n(defun indent-region-or-buffer ()\n  \"Indent a region if selected, otherwise the whole buffer.\"\n  (interactive)\n  (unless (member major-mode prelude-indent-sensitive-modes)\n    (save-excursion\n      (if (region-active-p)\n          (progn\n            (indent-region (region-beginning) (region-end))\n            (message \"Indented selected region.\"))\n        (progn\n          (indent-buffer)\n          (message \"Indented buffer.\")))\n      (whitespace-cleanup))))\n\n(global-set-key (kbd \"C-c i\") 'indent-region-or-buffer)\n\n;; ============================================================\n;; Speedbar\n(setq speedbar-show-unknown-files t)\n\n;; NOTE: Removed old macOS Mavericks workaround that forced home directory\n;; This was causing issues with `emacs .` not respecting current directory\n;; If you need to start in home directory, use: emacs ~\n;;\n;; Old code (commented out):\n;; ;;　Changing the home directory as the initial dir(for Mervelicks)\n;; (setq default-directory \"~/\")\n;; (setq command-line-default-directory \"~/\")\n;;\n;; ;; Changing the default directory as of '〜/' for Mavericks\n;; (defun cd-to-homedir-all-buffers ()\n;;   \"Change every current directory of all buffers to the home directory.\"\n;;   (mapc\n;;    (lambda (buf) (set-buffer buf) (cd (expand-file-name \"~\"))) (buffer-list)))\n;; (add-hook 'after-init-hook 'cd-to-homedir-all-buffers)\n\n;; Japanese Configuration (UTF-8)\n(set-language-environment \"Japanese\")\n(set-terminal-coding-system 'utf-8)\n(set-keyboard-coding-system 'utf-8)\n(set-buffer-file-coding-system 'utf-8)\n(setq buffer-file-coding-system 'utf-8)\n(setq slime-net-coding-system 'utf-8-unix)\n\n;; key bindings\n(windmove-default-keybindings 'meta)\n(setq mac-option-modifier 'meta)\n(setq mac-command-modifier 'meta)\n(global-set-key [kp-delete] 'delete-char) ;; sets fn-delete to be right-delete\n\n;; Enabling Font Lock mode (e.g. bold display)\n(global-font-lock-mode t)\n\n;; Enabling automcatically the temporarily mode\n(setq-default transient-mark-mode t)\n\n;; Changing C-x C-u to be worked nothing (undo / typo countermeasure)\n(global-unset-key \"\\C-x\\C-u\")\n\n;; High lighting the pared parenethesis\n(show-paren-mode 1)\n\n(setq next-line-add-newlines nil)\n\n;; C-x l/ run goto-line\n(define-key ctl-x-map \"l\" 'goto-line)\n;; alternate of '¥', entering '/'\n(define-key global-map [?¥] [?\\\\])\n\n(display-time)\n\n;; display the column number\n(column-number-mode 1)\n\n;; NOTE: menu-bar, tool-bar, and scroll-bars are disabled in early-init.el\n;; to prevent UI flickering during startup\n\n;; Make C-h act as backspace\n(define-key global-map \"\\C-h\" 'delete-backward-char)\n(define-key global-map \"\\C-x\\C-h\" 'help-command)\n;; Also bind in key-translation-map to override help-map\n(define-key key-translation-map (kbd \"C-h\") (kbd \"<DEL>\"))\n;; Override in isearch-mode\n(define-key isearch-mode-map \"\\C-h\" 'isearch-delete-char)\n(define-key global-map \"\\C-o\" 'dabbrev-expand)\n(setq dabbrev-case-fold-search nil)\n\n;;; Don't create the backup file\n(setq backup-inhibited t)\n\n;;; Deleting the save files when it was exited.\n(setq delete-auto-save-files t)\n\n;; Configuration for Japanese and English\n;; http://www.alles.or.jp/~torutk/oojava/meadow/Meadow210Install.html\n(defun my/dabbrev-expand-japanese-advice (orig-fun &rest args)\n  \"Modify `dabbrev-abbrev-char-regexp' dynamically for Japanese words.\"\n  (if (bobp)\n      (apply orig-fun args)\n    (let ((dabbrev-abbrev-char-regexp\n           (let ((c (char-category-set (char-before))))\n             (cond\n              ((aref c ?a) \"[-_A-Za-z0-9]\") ; ASCII\n              ((aref c ?j) ; Japanese\n               (cond\n                ((aref c ?K) \"\\\\cK\") ; katakana\n                ((aref c ?A) \"\\\\cA\") ; 2byte alphanumeric\n                ((aref c ?H) \"\\\\cH\") ; hiragana\n                ((aref c ?C) \"\\\\cC\") ; kanji\n                (t \"\\\\cj\")))\n              ((aref c ?k) \"\\\\ck\") ; hankaku-kana\n              ((aref c ?r) \"\\\\cr\") ; Japanese roman ?\n              (t dabbrev-abbrev-char-regexp)))))\n      (apply orig-fun args))))\n\n(advice-add 'dabbrev-expand :around #'my/dabbrev-expand-japanese-advice)\n\n;; Configuration Backspace\n(delete-selection-mode 1)\n\n;; The local variables list in .emacs と言われるのを抑止\n(add-to-list 'ignored-local-variables 'syntax)\n\n;; http://0xcc.net/blog/archives/000041.html\n(set-default-coding-systems 'utf-8)\n\n;; ============================================================\n;; Theme and Colors\n;; ============================================================\n;; modus-vivendi - High contrast dark theme (built-in since Emacs 28)\n;; Part of the modus-themes package by Protesilaos Stavrou\n(load-theme 'modus-vivendi t)\n\n;; Font configuration\n(when window-system\n  (set-frame-font \"Monaco-12\" nil t)\n  (set-frame-parameter nil 'alpha 100))\n\n(setq default-frame-alist\n  (append\n   '((font . \"Monaco-12\") ;; Default Fontset\n  (width . 140) (height . 50) ;; Window Size\n  )\n  default-frame-alist))\n\n;; ============================================================\n;; migemo - Japanese incremental search with Romanization\n;; ============================================================\n;; Requires: brew install cmigemo\n(use-package migemo\n  :if (executable-find \"cmigemo\")\n  :custom\n  (migemo-command \"cmigemo\")\n  (migemo-options '(\"-q\" \"--emacs\"))\n  (migemo-dictionary \"/opt/homebrew/share/migemo/utf-8/migemo-dict\")\n  (migemo-user-dictionary nil)\n  (migemo-regex-dictionary nil)\n  (migemo-coding-system 'utf-8-unix)\n  :config\n  (migemo-init))\n\n;; ============================================================\n;; exec-path-from-shell - Better PATH handling on macOS\n;; ============================================================\n(use-package exec-path-from-shell\n  :if (memq window-system '(mac ns x))\n  :config\n  (exec-path-from-shell-initialize)\n  ;; Copy additional environment variables for development tools\n  (exec-path-from-shell-copy-envs '(\"GOPATH\" \"GOROOT\" \"PYENV_ROOT\" \"VOLTA_HOME\"))\n  ;; Add Volta bin directory to exec-path for npm global packages\n  (when-let ((volta-home (getenv \"VOLTA_HOME\")))\n    (add-to-list 'exec-path (expand-file-name \"bin\" volta-home)))\n  ;; Add pyenv shims to exec-path for pip global packages\n  (let ((pyenv-root (or (getenv \"PYENV_ROOT\")\n                        (expand-file-name \"~/.pyenv\"))))\n    (when (file-directory-p pyenv-root)\n      (add-to-list 'exec-path (expand-file-name \"shims\" pyenv-root)))))\n\n;; ============================================================\n;; Eglot - Built-in LSP client (Emacs 29+)\n;; ============================================================\n(require 'eglot)\n\n;; Don't log every event (improves performance)\n(setq eglot-events-buffer-size 0)\n\n;; Shutdown server when last managed buffer is killed\n(setq eglot-autoshutdown t)\n\n;; ============================================================\n;; Tree-sitter Configuration\n;; ============================================================\n;; Tree-sitter provides accurate syntax highlighting via grammar libraries.\n;; Install grammars with: M-x treesit-install-language-grammar\n;;\n;; Grammar sources for common languages:\n(setq treesit-language-source-alist\n      '((python \"https://github.com/tree-sitter/tree-sitter-python\")\n        (go \"https://github.com/tree-sitter/tree-sitter-go\")\n        (gomod \"https://github.com/camdencheek/tree-sitter-go-mod\")\n        (yaml \"https://github.com/ikatyang/tree-sitter-yaml\")\n        ;; C/C++\n        (c \"https://github.com/tree-sitter/tree-sitter-c\")\n        (cpp \"https://github.com/tree-sitter/tree-sitter-cpp\")\n        ;; JavaScript/TypeScript\n        (javascript \"https://github.com/tree-sitter/tree-sitter-javascript\")\n        (typescript \"https://github.com/tree-sitter/tree-sitter-typescript\" \"master\" \"typescript/src\")\n        (tsx \"https://github.com/tree-sitter/tree-sitter-typescript\" \"master\" \"tsx/src\")\n        ;; JVM languages\n        (java \"https://github.com/tree-sitter/tree-sitter-java\")\n        (kotlin \"https://github.com/fwcd/tree-sitter-kotlin\")\n        (groovy \"https://github.com/murtaza64/tree-sitter-groovy\")))\n\n;; Helper function to check if tree-sitter grammar is actually usable\n(defun my/treesit-available-p (lang)\n  \"Check if tree-sitter grammar for LANG is actually usable.\nUses treesit-ready-p which verifies the grammar can be loaded.\"\n  (and (fboundp 'treesit-ready-p)\n       (treesit-ready-p lang t)))  ; t = quiet, don't signal error\n\n;; ============================================================\n;; Python Configuration\n;; ============================================================\n;; Uses python-ts-mode if grammar available, otherwise python-mode\n;; LSP servers (install one): pip install python-lsp-server\n;;                        or: pip install basedpyright\n;;                        or: pip install ruff\n\n;; Use tree-sitter mode if grammar is available\n(when (my/treesit-available-p 'python)\n  (add-to-list 'major-mode-remap-alist '(python-mode . python-ts-mode)))\n\n(add-hook 'python-mode-hook 'eglot-ensure)\n(add-hook 'python-ts-mode-hook 'eglot-ensure)\n\n;; Python indentation\n(setq python-indent-offset 4)\n\n;; ============================================================\n;; Go Configuration\n;; ============================================================\n;; Requires: go install golang.org/x/tools/gopls@latest\n\n;; Help project.el find Go project roots (look for go.mod)\n(defun project-find-go-module (dir)\n  \"Find Go module root for DIR by locating go.mod.\"\n  (when-let ((root (locate-dominating-file dir \"go.mod\")))\n    (cons 'go-module root)))\n\n(cl-defmethod project-root ((project (head go-module)))\n  \"Return root directory of Go PROJECT.\"\n  (cdr project))\n\n;; Add Go module detection to project-find-functions\n(add-hook 'project-find-functions #'project-find-go-module)\n\n;; Use tree-sitter mode if grammar is available, otherwise use go-mode\n(if (my/treesit-available-p 'go)\n    (progn\n      (add-to-list 'auto-mode-alist '(\"\\\\.go\\\\'\" . go-ts-mode))\n      (when (my/treesit-available-p 'gomod)\n        (add-to-list 'auto-mode-alist '(\"go\\\\.mod\\\\'\" . go-mod-ts-mode)))\n      (add-hook 'go-ts-mode-hook\n                (lambda ()\n                  (eglot-ensure)\n                  (setq-local indent-tabs-mode t)\n                  (setq-local tab-width 4)\n                  (add-hook 'before-save-hook\n                            (lambda ()\n                              (when (derived-mode-p 'go-ts-mode)\n                                (eglot-format-buffer)))\n                            nil t))))\n  ;; Fallback to go-mode package\n  (use-package go-mode\n    :hook ((go-mode . eglot-ensure)\n           (go-mode . (lambda ()\n                        (setq-local indent-tabs-mode t)\n                        (setq-local tab-width 4)))\n           (go-mode . (lambda ()\n                        (add-hook 'before-save-hook\n                                  (lambda ()\n                                    (when (derived-mode-p 'go-mode)\n                                      (eglot-format-buffer)))\n                                  nil t))))))\n\n;; Gopls configuration\n(setq-default eglot-workspace-configuration\n              '(:gopls (:staticcheck t :usePlaceholders t)))\n\n;; ============================================================\n;; C/C++ Configuration\n;; ============================================================\n;; Uses c-ts-mode and c++-ts-mode if grammars available (built-in Emacs 29+)\n;; LSP: clangd (usually comes with Xcode or LLVM)\n;;   Install: xcode-select --install (macOS)\n;;        or: brew install llvm\n\n;; Use tree-sitter modes if grammars are available\n(when (my/treesit-available-p 'c)\n  (add-to-list 'major-mode-remap-alist '(c-mode . c-ts-mode)))\n\n(when (my/treesit-available-p 'cpp)\n  (add-to-list 'major-mode-remap-alist '(c++-mode . c++-ts-mode))\n  (add-to-list 'auto-mode-alist '(\"\\\\.cpp\\\\'\" . c++-ts-mode))\n  (add-to-list 'auto-mode-alist '(\"\\\\.hpp\\\\'\" . c++-ts-mode))\n  (add-to-list 'auto-mode-alist '(\"\\\\.cc\\\\'\" . c++-ts-mode))\n  (add-to-list 'auto-mode-alist '(\"\\\\.hh\\\\'\" . c++-ts-mode)))\n\n;; Enable Eglot for C/C++ (clangd)\n(add-hook 'c-mode-hook 'eglot-ensure)\n(add-hook 'c-ts-mode-hook 'eglot-ensure)\n(add-hook 'c++-mode-hook 'eglot-ensure)\n(add-hook 'c++-ts-mode-hook 'eglot-ensure)\n\n;; ============================================================\n;; JavaScript / Node.js Configuration\n;; ============================================================\n;; Uses js-ts-mode if grammar available (built-in Emacs 29+)\n;; Requires: npm install -g typescript-language-server typescript\n;; (typescript-language-server also handles JavaScript)\n\n;; Use tree-sitter mode if grammar is available\n(when (my/treesit-available-p 'javascript)\n  (add-to-list 'major-mode-remap-alist '(javascript-mode . js-ts-mode))\n  (add-to-list 'auto-mode-alist '(\"\\\\.js\\\\'\" . js-ts-mode))\n  (add-to-list 'auto-mode-alist '(\"\\\\.mjs\\\\'\" . js-ts-mode))\n  (add-to-list 'auto-mode-alist '(\"\\\\.cjs\\\\'\" . js-ts-mode)))\n\n(add-hook 'js-mode-hook 'eglot-ensure)\n(add-hook 'js-ts-mode-hook 'eglot-ensure)\n\n;; JavaScript indentation\n(setq js-indent-level 2)\n\n;; ============================================================\n;; TypeScript Configuration\n;; ============================================================\n;; Uses typescript-ts-mode if grammar available, otherwise typescript-mode\n;; Requires: npm install -g typescript-language-server typescript\n\n;; TypeScript indentation\n(setq typescript-ts-mode-indent-offset 2)\n\n;; Use tree-sitter mode if grammar available, otherwise typescript-mode package\n(if (my/treesit-available-p 'typescript)\n    (progn\n      (add-to-list 'auto-mode-alist '(\"\\\\.ts\\\\'\" . typescript-ts-mode))\n      (add-hook 'typescript-ts-mode-hook 'eglot-ensure))\n  ;; Fallback to typescript-mode package\n  (use-package typescript-mode\n    :mode \"\\\\.ts\\\\'\"\n    :hook (typescript-mode . eglot-ensure)\n    :custom\n    (typescript-indent-level 2)))\n\n;; TSX - tree-sitter mode if available, otherwise web-mode as fallback\n(if (my/treesit-available-p 'tsx)\n    (progn\n      (add-to-list 'auto-mode-alist '(\"\\\\.tsx\\\\'\" . tsx-ts-mode))\n      (add-hook 'tsx-ts-mode-hook 'eglot-ensure))\n  ;; Fallback to web-mode for TSX\n  (use-package web-mode\n    :mode \"\\\\.tsx\\\\'\"\n    :hook (web-mode . eglot-ensure)\n    :custom\n    (web-mode-markup-indent-offset 2)\n    (web-mode-code-indent-offset 2)))\n\n;; ============================================================\n;; YAML Configuration\n;; ============================================================\n;; Optional LSP: npm install -g yaml-language-server\n\n;; Use tree-sitter mode if grammar available, otherwise yaml-mode\n(if (my/treesit-available-p 'yaml)\n    (progn\n      (add-to-list 'auto-mode-alist '(\"\\\\.ya?ml\\\\'\" . yaml-ts-mode))\n      (add-to-list 'auto-mode-alist '(\"\\\\.eyaml\\\\'\" . yaml-ts-mode))\n      (add-hook 'yaml-ts-mode-hook\n                (lambda ()\n                  (setq-local indent-tabs-mode nil)\n                  (setq-local tab-width 2)\n                  (when (executable-find \"yaml-language-server\")\n                    (eglot-ensure)))))\n  ;; Fallback to yaml-mode package\n  (use-package yaml-mode\n    :mode ((\"\\\\.ya?ml\\\\'\" . yaml-mode)\n           (\"\\\\.eyaml\\\\'\" . yaml-mode))\n    :hook ((yaml-mode . (lambda ()\n                          (setq-local indent-tabs-mode nil)\n                          (setq-local tab-width 2)\n                          (when (executable-find \"yaml-language-server\")\n                            (eglot-ensure)))))))\n\n;; ============================================================\n;; Java Configuration\n;; ============================================================\n;; Uses java-ts-mode if grammar available (built-in Emacs 29+)\n;; Requires: Eclipse JDTLS for LSP\n;;   macOS: brew install jdtls\n;;   or download from: https://download.eclipse.org/jdtls/\n;;\n;; Note: JDTLS needs a workspace directory for each project\n\n;; Use tree-sitter mode if grammar is available\n(when (my/treesit-available-p 'java)\n  (add-to-list 'major-mode-remap-alist '(java-mode . java-ts-mode)))\n\n;; Configure Eglot for Java (JDTLS)\n(with-eval-after-load 'eglot\n  (add-to-list 'eglot-server-programs\n               '((java-mode java-ts-mode) . (\"jdtls\"))))\n\n(add-hook 'java-mode-hook 'eglot-ensure)\n(add-hook 'java-ts-mode-hook 'eglot-ensure)\n\n;; Java indentation\n(add-hook 'java-mode-hook\n          (lambda ()\n            (setq-local c-basic-offset 4)\n            (setq-local tab-width 4)\n            (setq-local indent-tabs-mode nil)))\n(add-hook 'java-ts-mode-hook\n          (lambda ()\n            (setq-local c-basic-offset 4)\n            (setq-local tab-width 4)\n            (setq-local indent-tabs-mode nil)))\n\n;; ============================================================\n;; Kotlin Configuration\n;; ============================================================\n;; Uses kotlin-mode package (no built-in kotlin-ts-mode in Emacs yet)\n;; Tree-sitter grammar available at: https://github.com/fwcd/tree-sitter-kotlin\n;; Requires: kotlin-language-server for LSP\n;;   Install: brew install kotlin-language-server\n;;        or: https://github.com/fwcd/kotlin-language-server\n\n;; Configure Eglot for Kotlin\n(with-eval-after-load 'eglot\n  (add-to-list 'eglot-server-programs\n               '(kotlin-mode . (\"kotlin-language-server\"))))\n\n;; Use kotlin-mode package\n(use-package kotlin-mode\n  :ensure t\n  :mode ((\"\\\\.kt\\\\'\" . kotlin-mode)\n         (\"\\\\.kts\\\\'\" . kotlin-mode))\n  :hook ((kotlin-mode . eglot-ensure)\n         (kotlin-mode . (lambda ()\n                          (setq-local tab-width 4)\n                          (setq-local indent-tabs-mode nil)))))\n\n;; ============================================================\n;; Gradle / Groovy Configuration\n;; ============================================================\n;; Uses groovy-mode package (no built-in groovy-ts-mode in Emacs yet)\n;; Tree-sitter grammar available at: https://github.com/murtaza64/tree-sitter-groovy\n;;\n;; Gradle build files come in two flavors:\n;; - .gradle files: Groovy DSL (use groovy-mode)\n;; - .gradle.kts files: Kotlin DSL (use kotlin-mode)\n;;\n;; Optional LSP: gradle-language-server (experimental)\n;;   Install: npm install -g gradle-language-server\n\n;; Groovy mode for .gradle and .groovy files\n(use-package groovy-mode\n  :ensure t\n  :mode ((\"\\\\.gradle\\\\'\" . groovy-mode)\n         (\"\\\\.groovy\\\\'\" . groovy-mode))\n  :config\n  (setq groovy-indent-offset 4))\n\n;; For .gradle.kts files, use Kotlin mode (already configured above)\n;; The \"\\\\.kts\\\\'\" pattern in kotlin configuration handles build.gradle.kts\n\n;; ============================================================\n;; Markdown Configuration\n;; ============================================================\n;; Optional: brew install pandoc (for preview/export)\n\n(use-package markdown-mode\n  :mode ((\"README\\\\.md\\\\'\" . gfm-mode)\n         (\"\\\\.md\\\\'\" . markdown-mode)\n         (\"\\\\.markdown\\\\'\" . markdown-mode))\n  :config\n  ;; Use pandoc for markdown processing if available\n  (when (executable-find \"pandoc\")\n    (setq markdown-command\n          (if (executable-find \"mermaid-filter\")\n              \"pandoc --filter mermaid-filter\"\n            \"pandoc\")))\n  ;; Open live preview window on the right side\n  (defun my/markdown-live-preview-window-right (file)\n    \"Open markdown live preview in a window on the right side.\"\n    (eww-open-file file)\n    (let ((buf (if (bound-and-true-p eww-auto-rename-buffer)\n                   (cl-loop for b in (buffer-list)\n                            when (string-match-p \"eww\\\\*\\\\'\" (buffer-name b))\n                            return b)\n                 (get-buffer \"*eww*\"))))\n      (pop-to-buffer buf '((display-buffer-in-direction)\n                           (direction . right)\n                           (window-width . 0.5)))\n      buf))\n  (setq markdown-live-preview-window-function #'my/markdown-live-preview-window-right)\n  :custom\n  (markdown-enable-math t)\n  (markdown-fontify-code-blocks-natively t)\n  ;; Delete exported HTML files after live preview\n  (markdown-live-preview-delete-export 'delete-on-export))\n\n;; grip-mode - GitHub-flavored Markdown preview\n;; Uses go-grip for local rendering (no GitHub API needed)\n;; Requires: go install github.com/chrishrb/go-grip@latest\n(use-package grip-mode\n  :ensure t\n  :after markdown-mode\n  :bind (:map markdown-mode-command-map\n         (\"g\" . grip-mode))\n  :custom\n  (grip-command 'go-grip)           ; Use go-grip (no GitHub API)\n  (grip-preview-use-webkit nil))    ; Use external browser\n\n;; ============================================================\n;; Terminal Emulators\n;; ============================================================\n;; vterm - Full-featured terminal emulator (requires libvterm)\n;; Requires: brew install libvterm\n(use-package vterm\n  :ensure t\n  :demand t  ; Load eagerly so it's available for claude-code\n  :custom\n  ;; Large scrollback buffer for Claude Code history (default is 1000)\n  (vterm-max-scrollback 100000)\n  :config\n  ;; Disable modes that interfere with terminal input\n  (defun my/vterm-mode-setup ()\n    \"Setup vterm buffer for proper terminal input.\"\n    (setq-local global-hl-line-mode nil)\n    (setq-local line-spacing nil)\n    ;; Disable modes that intercept keyboard input\n    (smartparens-mode -1)\n    (company-mode -1)\n    (yas-minor-mode -1)\n    ;; Ensure vterm handles all input\n    (setq-local scroll-margin 0)\n    ;; Fix border overflow and alignment (UI rendering issues)\n    (when (fboundp 'set-window-fringes)\n      (set-window-fringes (selected-window) 0 0))  ; Remove fringes (GUI only)\n    (setq-local truncate-lines t)  ; Let vterm/Claude Code handle wrapping\n    (when (bound-and-true-p display-line-numbers-mode)\n      (display-line-numbers-mode -1)))  ; Disable line numbers\n  (add-hook 'vterm-mode-hook #'my/vterm-mode-setup)\n\n  ;; Prevent vterm windows from getting too narrow (for Claude Code display)\n  (defvar my/vterm-min-width 80\n    \"Minimum width for vterm windows.\")\n\n  (defun my/vterm-enforce-min-width ()\n    \"Enlarge vterm window if it's too narrow.\"\n    (when (and (eq major-mode 'vterm-mode)\n               (< (window-width) my/vterm-min-width)\n               (window-resizable nil (- my/vterm-min-width (window-width)) t))\n      (enlarge-window-horizontally (- my/vterm-min-width (window-width)))))\n\n  (add-hook 'window-configuration-change-hook #'my/vterm-enforce-min-width)\n\n  ;; Mouse wheel scrolling - enters copy mode to scroll through full history\n  (defun my/vterm-scroll-up ()\n    \"Scroll up in vterm, entering copy mode to access full scrollback.\"\n    (interactive)\n    (unless vterm-copy-mode\n      (vterm-copy-mode 1))\n    (scroll-down-command 3))\n  (defun my/vterm-scroll-down ()\n    \"Scroll down in vterm. Exit copy mode when reaching the bottom.\"\n    (interactive)\n    (if vterm-copy-mode\n        (progn\n          (scroll-up-command 3)\n          ;; Exit copy mode if we're at the bottom (end of buffer visible)\n          (when (pos-visible-in-window-p (point-max))\n            (vterm-copy-mode -1)))\n      (scroll-up-command 3)))\n  (define-key vterm-mode-map (kbd \"<mouse-4>\") #'my/vterm-scroll-up)\n  (define-key vterm-mode-map (kbd \"<mouse-5>\") #'my/vterm-scroll-down)\n  (define-key vterm-mode-map (kbd \"<wheel-up>\") #'my/vterm-scroll-up)\n  (define-key vterm-mode-map (kbd \"<wheel-down>\") #'my/vterm-scroll-down)\n  ;; Keybindings to send Escape to terminal (for Claude Code cancel)\n  (define-key vterm-mode-map (kbd \"C-c C-e\") #'vterm-send-escape)\n  (define-key vterm-mode-map (kbd \"C-c <escape>\") #'vterm-send-escape)\n\n  ;; Copy mode with mouse support\n  ;; Click to enter copy mode and set mark, drag to select, release to copy\n  (defun my/vterm-mouse-select-start (event)\n    \"Start mouse selection in vterm - enters copy mode and sets mark.\"\n    (interactive \"e\")\n    (unless vterm-copy-mode\n      (vterm-copy-mode 1))\n    (mouse-set-point event)\n    (push-mark (point) t t))\n\n  (defun my/vterm-mouse-select-end (event)\n    \"End mouse selection in vterm - copies region to clipboard.\"\n    (interactive \"e\")\n    (when vterm-copy-mode\n      (mouse-set-point event)\n      (when (use-region-p)\n        (kill-ring-save (region-beginning) (region-end))\n        (message \"Copied to clipboard\"))))\n\n  ;; Mouse drag selection that copies to kill-ring\n  (defun my/vterm-mouse-drag-copy (start-event)\n    \"Select region with mouse drag and copy to kill-ring.\"\n    (interactive \"e\")\n    (unless vterm-copy-mode\n      (vterm-copy-mode 1))\n    (mouse-drag-region start-event)\n    (when (use-region-p)\n      (kill-ring-save (region-beginning) (region-end))\n      (message \"Copied to clipboard\")))\n\n  ;; Mouse bindings for copy mode - DISABLED for testing\n  ;; (define-key vterm-mode-map (kbd \"<down-mouse-1>\") #'my/vterm-mouse-drag-copy)\n\n  ;; Paste from kill-ring into vterm\n  (define-key vterm-mode-map (kbd \"C-y\") #'vterm-yank)\n  (define-key vterm-mode-map (kbd \"M-y\") #'vterm-yank-pop)\n\n  ;; Copy mode keybindings\n  ;; C-c C-t: enter copy mode (default vterm binding)\n  ;; Select with mouse or keyboard, then:\n  (define-key vterm-copy-mode-map (kbd \"M-w\") #'vterm-copy-mode-done)  ; Copy and exit\n  (define-key vterm-copy-mode-map (kbd \"M-c\") #'vterm-copy-mode-done)  ; Cmd+c (mac-command = meta)\n  (define-key vterm-copy-mode-map (kbd \"C-c C-c\") #'vterm-copy-mode-done)\n  (define-key vterm-copy-mode-map (kbd \"q\") #'vterm-copy-mode)  ; Exit without copying\n  (define-key vterm-copy-mode-map (kbd \"<return>\") #'vterm-copy-mode-done))\n\n;; eat - Emulate A Terminal (pure elisp, no external dependencies)\n(use-package eat\n  :commands eat)\n\n;; ============================================================\n;; Claude Code Integration\n;; ============================================================\n;; Requires: brew install --cask claude-code (already installed)\n;;           brew install libvterm (already installed)\n\n;; transient - Required dependency for claude-code.el (menu system)\n(use-package transient\n  :ensure t)\n\n;; inheritenv - Required dependency for claude-code.el (environment handling)\n(use-package inheritenv\n  :vc (:url \"https://github.com/purcell/inheritenv\" :rev :newest))\n\n(use-package claude-code\n  :vc (:url \"https://github.com/stevemolitor/claude-code.el\" :rev :newest)\n  :demand t  ; Load immediately, don't defer\n  :after vterm  ; Ensure vterm is loaded first\n  :init\n  ;; Set these BEFORE package loads (defcustom defaults are read at load time)\n  (setq claude-code-terminal-backend 'vterm)   ; Use vterm for best TUI experience\n  (setq claude-code-program \"claude\")       ; CLI program name\n  (require 'vterm)  ; Ensure vterm is available\n  :config\n  (claude-code-mode)  ; Enable global minor mode for IDE integration\n  ;; Set up keybindings explicitly (more reliable than :bind-keymap with :vc)\n  (global-set-key (kbd \"C-c c\") claude-code-command-map))\n\n(custom-set-variables\n ;; custom-set-variables was added by Custom.\n ;; If you edit it by hand, you could mess it up, so be careful.\n ;; Your init file should contain only one such instance.\n ;; If there is more than one, they won't work right.\n '(company-show-quick-access t nil nil \"Customized with use-package company\")\n '(package-selected-packages nil))\n(custom-set-faces\n ;; custom-set-faces was added by Custom.\n ;; If you edit it by hand, you could mess it up, so be careful.\n ;; Your init file should contain only one such instance.\n ;; If there is more than one, they won't work right.\n )\n\n;;; init.el ends here\n","numLines":1334,"startLine":1,"totalLines":1334}},"sourceToolAssistantUUID":"a1846e4b-8bf8-4401-903f-ec4e3b8332a0"}
{"parentUuid":"946fb232-b513-43c4-bfca-51ced40f0a20","isSidechain":false,"userType":"external","cwd":"/Users/naokisega/src/github.com/nsega/.emacs.d","sessionId":"3662272f-90eb-4f6d-acc3-1b561237eac1","version":"2.1.49","gitBranch":"feature/update-gitignore","slug":"clever-shimmying-tiger","message":{"model":"claude-sonnet-4-6","id":"msg_012v8Gr1kR29E3McQjR83d4B","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"Looking at this Emacs config, I can identify several potential causes of high CPU usage:\n\n1. **`buffer-list-update-hook` + `window-configuration-change-hook` with `my/set-terminal-title`** - These hooks fire very frequently (every buffer switch, every window change) and call `project-current` which can be expensive.\n\n2. **`frame-title-format` with `(:eval (my/get-frame-title))`** - This calls `my/get-frame-title` on every redisplay, which calls `project-current` repeatedly.\n\n3. **`my/get-frame-title` calling `project-current`** - `project-current` can be slow as it scans directories looking for project roots.\n\n\n4. **`my/vterm-enforce-min-width` on `window-configuration-change-hook`** - Fires on every window change, adding more overhead to an already-expensive hook.\n\n5. **`vterm-max-scrollback 100000`** - The large scrollback buffer can consume significant memory and CPU resources.\n\n6. **`global-company-mode` with `company-idle-delay 0.1`** - The very short idle delay triggers completion candidates constantly.\n\n7. **`undo-tree`, `smartparens`, and `dtrt-indent-mode`** - These packages add processing overhead, especially in large buffers or when frequently triggered.\n\n8. **`interprogram-paste-function` spawning `pbpaste`** - This is spawning a shell process potentially very frequently whenever Emacs checks the clipboard.\n\nThe real performance killers are likely the `buffer-list-update-hook` calling `project-current`, the `frame-title-format` eval doing the same on every redisplay, the clipboard function spawning processes, and the massive scrollback buffer. The `project-current` calls are probably the worst offenders since that function can be expensive, especially in large projects.\n\nTo diagnose this properly, I should recommend using the profiler to see where the CPU is actually going, but the most practical fixes would be to debounce or remove the `buffer-list-update-hook`, cache the project information in the frame title, replace the clipboard function with something more efficient, and reduce the vterm scrollback. The real issue is that custom clipboard function spawning shell processes constantly on every paste attempt, combined with the title hook firing on every buffer change. I should walk them through profiling first to confirm what's actually consuming CPU, then suggest removing the unnecessary macOS clipboard workaround since Emacs 29+ handles it natively, and debouncing the title updates.","signature":"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"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":20730,"cache_read_input_tokens":29185,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":20730},"output_tokens":8,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYMfwynCKTGexRNt3bwXm","type":"assistant","uuid":"10b64d5e-5aae-4114-83d0-1e23fb852dfe","timestamp":"2026-02-21T18:17:12.769Z"}
{"parentUuid":"10b64d5e-5aae-4114-83d0-1e23fb852dfe","isSidechain":false,"userType":"external","cwd":"/Users/naokisega/src/github.com/nsega/.emacs.d","sessionId":"3662272f-90eb-4f6d-acc3-1b561237eac1","version":"2.1.49","gitBranch":"feature/update-gitignore","slug":"clever-shimmying-tiger","message":{"model":"claude-sonnet-4-6","id":"msg_012v8Gr1kR29E3McQjR83d4B","type":"message","role":"assistant","content":[{"type":"text","text":"Looking at your config, I can spot several likely causes of high CPU usage. Let me highlight the key suspects:\n\n**1. Clipboard integration (most likely culprit)**\nLines 106-117: `interprogram-paste-function` calls `shell-command-to-string \"pbpaste\"` — this spawns a new shell process every time Emacs polls the clipboard, which can be very frequent.\n\n**2. `buffer-list-update-hook` fires extremely often**\nLines 222-226: `my/set-terminal-title` runs on every buffer list change and calls `project-current` (directory scanning) each time.\n\n**3. `frame-title-format` with `:eval`**\nLine 211: `(:eval (my/get-frame-title))` calls `project-current` on every display redraw.\n\n**4. `vterm-max-scrollback 100000`**\nLine 1182: A 100k-line scrollback is very memory/CPU intensive.\n\nHere are the fixes:"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":20730,"cache_read_input_tokens":29185,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":20730},"output_tokens":8,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYMfwynCKTGexRNt3bwXm","type":"assistant","uuid":"14df30f3-c42b-4250-a2e4-7a9aeff74778","timestamp":"2026-02-21T18:17:14.214Z"}
{"parentUuid":"14df30f3-c42b-4250-a2e4-7a9aeff74778","isSidechain":false,"userType":"external","cwd":"/Users/naokisega/src/github.com/nsega/.emacs.d","sessionId":"3662272f-90eb-4f6d-acc3-1b561237eac1","version":"2.1.49","gitBranch":"feature/update-gitignore","slug":"clever-shimmying-tiger","message":{"model":"claude-sonnet-4-6","id":"msg_012v8Gr1kR29E3McQjR83d4B","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01CDZNp2P8rGpJSnnZVdmv8i","name":"Read","input":{"file_path":"/Users/naokisega/src/github.com/nsega/.emacs.d/early-init.el"},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":20730,"cache_read_input_tokens":29185,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":20730},"output_tokens":8,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYMfwynCKTGexRNt3bwXm","type":"assistant","uuid":"a50773cc-b461-424c-bdbd-1b579ccae074","timestamp":"2026-02-21T18:17:15.367Z"}
{"parentUuid":"a50773cc-b461-424c-bdbd-1b579ccae074","isSidechain":false,"userType":"external","cwd":"/Users/naokisega/src/github.com/nsega/.emacs.d","sessionId":"3662272f-90eb-4f6d-acc3-1b561237eac1","version":"2.1.49","gitBranch":"feature/update-gitignore","slug":"clever-shimmying-tiger","type":"progress","data":{"type":"hook_progress","hookEvent":"PostToolUse","hookName":"PostToolUse:Read","command":"callback"},"parentToolUseID":"toolu_01CDZNp2P8rGpJSnnZVdmv8i","toolUseID":"toolu_01CDZNp2P8rGpJSnnZVdmv8i","timestamp":"2026-02-21T18:17:15.380Z","uuid":"1886fc6e-8d17-4ceb-bf98-008e4fec170d"}
{"parentUuid":"a50773cc-b461-424c-bdbd-1b579ccae074","isSidechain":false,"userType":"external","cwd":"/Users/naokisega/src/github.com/nsega/.emacs.d","sessionId":"3662272f-90eb-4f6d-acc3-1b561237eac1","version":"2.1.49","gitBranch":"feature/update-gitignore","slug":"clever-shimmying-tiger","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01CDZNp2P8rGpJSnnZVdmv8i","type":"tool_result","content":"     1→;;; early-init.el --- Early initialization -*- lexical-binding: t; -*-\n     2→\n     3→;; Author: Naoki Sega\n     4→;; Maintainer: Naoki Sega\n     5→\n     6→;;; Commentary:\n     7→;; This file is loaded before init.el, before the package system and GUI\n     8→;; are initialized. Use it for frame settings and startup optimizations.\n     9→\n    10→;;; Code:\n    11→\n    12→;; Prevent package.el from loading packages before use-package\n    13→(setq package-enable-at-startup nil)\n    14→\n    15→;; Disable UI elements early to prevent flickering\n    16→(push '(menu-bar-lines . 0) default-frame-alist)\n    17→(push '(tool-bar-lines . 0) default-frame-alist)\n    18→(push '(vertical-scroll-bars) default-frame-alist)\n    19→\n    20→;; Prevent resize flickering\n    21→(setq frame-inhibit-implied-resize t)\n    22→\n    23→;; Faster startup: temporarily increase GC threshold\n    24→;; Will be reset to reasonable value in init.el after startup\n    25→(setq gc-cons-threshold most-positive-fixnum)\n    26→(setq gc-cons-percentage 0.6)\n    27→\n    28→;; Prevent early file-name-handler processing (speeds up startup)\n    29→(defvar my/file-name-handler-alist file-name-handler-alist)\n    30→(setq file-name-handler-alist nil)\n    31→\n    32→;; Restore defaults after startup\n    33→(add-hook 'emacs-startup-hook\n    34→          (lambda ()\n    35→            (setq gc-cons-threshold (* 16 1024 1024))  ; 16MB\n    36→            (setq gc-cons-percentage 0.1)\n    37→            (setq file-name-handler-alist my/file-name-handler-alist)))\n    38→\n    39→;;; early-init.el ends here\n    40→"}]},"uuid":"b4dd9ad6-68d9-4d36-97f8-5cc6bac3242d","timestamp":"2026-02-21T18:17:15.379Z","toolUseResult":{"type":"text","file":{"filePath":"/Users/naokisega/src/github.com/nsega/.emacs.d/early-init.el","content":";;; early-init.el --- Early initialization -*- lexical-binding: t; -*-\n\n;; Author: Naoki Sega\n;; Maintainer: Naoki Sega\n\n;;; Commentary:\n;; This file is loaded before init.el, before the package system and GUI\n;; are initialized. Use it for frame settings and startup optimizations.\n\n;;; Code:\n\n;; Prevent package.el from loading packages before use-package\n(setq package-enable-at-startup nil)\n\n;; Disable UI elements early to prevent flickering\n(push '(menu-bar-lines . 0) default-frame-alist)\n(push '(tool-bar-lines . 0) default-frame-alist)\n(push '(vertical-scroll-bars) default-frame-alist)\n\n;; Prevent resize flickering\n(setq frame-inhibit-implied-resize t)\n\n;; Faster startup: temporarily increase GC threshold\n;; Will be reset to reasonable value in init.el after startup\n(setq gc-cons-threshold most-positive-fixnum)\n(setq gc-cons-percentage 0.6)\n\n;; Prevent early file-name-handler processing (speeds up startup)\n(defvar my/file-name-handler-alist file-name-handler-alist)\n(setq file-name-handler-alist nil)\n\n;; Restore defaults after startup\n(add-hook 'emacs-startup-hook\n          (lambda ()\n            (setq gc-cons-threshold (* 16 1024 1024))  ; 16MB\n            (setq gc-cons-percentage 0.1)\n            (setq file-name-handler-alist my/file-name-handler-alist)))\n\n;;; early-init.el ends here\n","numLines":40,"startLine":1,"totalLines":40}},"sourceToolAssistantUUID":"a50773cc-b461-424c-bdbd-1b579ccae074"}
{"parentUuid":"b4dd9ad6-68d9-4d36-97f8-5cc6bac3242d","isSidechain":false,"userType":"external","cwd":"/Users/naokisega/src/github.com/nsega/.emacs.d","sessionId":"3662272f-90eb-4f6d-acc3-1b561237eac1","version":"2.1.49","gitBranch":"feature/update-gitignore","slug":"clever-shimmying-tiger","message":{"model":"claude-sonnet-4-6","id":"msg_01GXJ31m8ss33BG9bhVGATdV","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"Now let me provide targeted fixes. The main issues I'll address:\n\n1. **Remove custom clipboard code** - Emacs 29+ on macOS handles this natively. The `shell-command-to-string \"pbpaste\"` is very expensive if called frequently.\n\n2. **Debounce the terminal title** - Don't use `buffer-list-update-hook` which fires too often\n\n3. **Reduce vterm scrollback** - 100k is too much\n\n4. **Cache the frame title** - Avoid calling `project-current` on every redraw\n\nLet me also note that `gc-cons-threshold` is set back to 16MB in early-init, which is reasonable, so that's fine.\n\n\nI also see there's a minor inconsistency with `package-enable-at-startup nil` in early-init but then calling `package-initialize` in init.el, though that's not contributing to the CPU issues. Now I'll write out the specific changes needed.","signature":"ErYHCkYICxgCKkDVtucQdri+2fbquY2kspAUxmIQRPjZaC6b6wRuzG+3NOO/ctqkFNIrbmB48OtSfU0hkNw3FV5tOaU9yKBRSKz0EgwltKI9149GN4DOLQIaDD0UHSIoNGgAQWprdCIw9iVIyQDeLOmndMTDFmdKgdr7aX74pyHlNzKjTaj2IU+OivtcbwH0XXZ9DDOTxx4QKp0G+Z6v4c1JDhXkHUPND3LcthTNc/PO9VTALFFbd7h6998V8RHXP78vwEkzABMa5XyS4tX3Xqpx0YP7a/xMoJ0oNKO80ueq+vVuWrnzfvLFyPX/4rBt2yI6D1mWHEU2f4d7hMr3wI8RjrDD8B6RQv1ZdA1s8tmfWU6Y8+xweztoEK7Se5ZM0gZPbQRuEhz9un4NXBr7MeO5g0kIBtmMWQ/DNqQEbbsngpZ76dVCuPlYon+Vr0Tx6zI0FCHtScNwWoXJiNhSUkRNLEinMIq4mdiBi710Kq2dYjSuifG5qsSR2K387fpLJzGCQj76KMdpRij38XcAOxxnXSu8DtxGox50wUlq+myr4NaeMyLnZTX8mOQz5DRjcWp2qAhEt1jf7KKrSWGCRdh+WiA1Ctj7sTZEONvZzk+x113ZqPghO8/BEuu5FkIAzsNRvuvQ26uzSn33WqHqjF14BRpaIOEyopi+RGUffFxPs487oPWCxT+K+vSDPeL4LUksMzcmKU0WqlqNoOryXsEFzjkucDb6pQjibCreePy4HGUQmj3Tg4XZecxm/drgVNAI4C8f5le2gTgm0aRgkvL6zBXXrUjIIR3kGCr6fbvTRrKp0y8DvZh371Qoxt04rhB0dN6f1LvlQjzrzaNtb01pyuBTH+dU72XS93KWe7wBdTEpn4qY6140NpyRht6CoSizFGu4JltsduA4V3/JTz1N9ApDIGNJJzGdQ+oy6n49MjRp0jI4tHWePlACgZulXAy70R0jOKxwtN4pHzEwLTbGB1Ffabqo8Sk0fr3tZaAFO5AvXhyP3xb1VmL6MHkNaOPz/EZPXzFhQuavjuER6RsT1cK51GHQ9XcH+dwNckpKRWsyDkSrcwyEe05DBATdAzU97IxIhphkXAiljavOc+sq6cKCkSg1nWKIJNwnTr7o1PjgFgPlR7gkWYYBN7djZ/jhFLLzuWbbK0MRoQ/ePP73YRiXFH3Y5VzkDs2HuCp5Rgy5poaCf60Xl4wwRt18WECI7Hl7oWigMlMFD4feJDkpnzAN/sew1eLeXSYSu7aNoV0R92UAjXcYAQ=="}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":2016,"cache_read_input_tokens":49915,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":2016},"output_tokens":8,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYMfysSWC7K9qzGwbasuF","type":"assistant","uuid":"557f217e-aca1-46c2-9392-7dab492caeba","timestamp":"2026-02-21T18:17:21.458Z"}
{"parentUuid":"557f217e-aca1-46c2-9392-7dab492caeba","isSidechain":false,"userType":"external","cwd":"/Users/naokisega/src/github.com/nsega/.emacs.d","sessionId":"3662272f-90eb-4f6d-acc3-1b561237eac1","version":"2.1.49","gitBranch":"feature/update-gitignore","slug":"clever-shimmying-tiger","message":{"model":"claude-sonnet-4-6","id":"msg_01GXJ31m8ss33BG9bhVGATdV","type":"message","role":"assistant","content":[{"type":"text","text":"Now I have a clear picture. Here are the specific fixes to apply:"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":2016,"cache_read_input_tokens":49915,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":2016},"output_tokens":8,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYMfysSWC7K9qzGwbasuF","type":"assistant","uuid":"c972e24c-dbc8-43da-bc21-69d4a76e192e","timestamp":"2026-02-21T18:17:21.467Z"}
{"parentUuid":"c972e24c-dbc8-43da-bc21-69d4a76e192e","isSidechain":false,"userType":"external","cwd":"/Users/naokisega/src/github.com/nsega/.emacs.d","sessionId":"3662272f-90eb-4f6d-acc3-1b561237eac1","version":"2.1.49","gitBranch":"feature/update-gitignore","slug":"clever-shimmying-tiger","message":{"model":"claude-sonnet-4-6","id":"msg_01GXJ31m8ss33BG9bhVGATdV","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01H9n2wQrEgVBSakBqxFf3de","name":"Edit","input":{"replace_all":false,"file_path":"/Users/naokisega/src/github.com/nsega/.emacs.d/init.el","old_string":";; ============================================================\n;; macOS Clipboard Integration\n;; ============================================================\n;; Sync kill ring with macOS system clipboard via pbcopy/pbpaste\n(when (eq system-type 'darwin)\n  (setq interprogram-cut-function\n        (lambda (text &optional _)\n          (let ((process-connection-type nil))\n            (let ((proc (start-process \"pbcopy\" nil \"pbcopy\")))\n              (process-send-string proc text)\n              (process-send-eof proc)))))\n  (setq interprogram-paste-function\n        (lambda ()\n          (let ((clipboard (shell-command-to-string \"pbpaste\")))\n            (unless (string= clipboard (car kill-ring))\n              clipboard)))))","new_string":";; ============================================================\n;; macOS Clipboard Integration\n;; ============================================================\n;; Emacs 29+ on macOS handles clipboard natively via GUI - no pbcopy/pbpaste needed.\n;; The old shell-command-to-string approach spawns processes too frequently (CPU hog).\n(when (eq system-type 'darwin)\n  (setq select-enable-clipboard t)\n  (setq select-enable-primary nil))"},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":2016,"cache_read_input_tokens":49915,"output_tokens":653,"server_tool_use":{"web_search_requests":0,"web_fetch_requests":0},"service_tier":"standard","cache_creation":{"ephemeral_1h_input_tokens":2016,"ephemeral_5m_input_tokens":0},"inference_geo":"","iterations":[],"speed":"standard"}},"requestId":"req_011CYMfysSWC7K9qzGwbasuF","type":"assistant","uuid":"18f9a550-9b44-4546-9d70-8c12f550bb2e","timestamp":"2026-02-21T18:17:25.816Z"}
{"parentUuid":"18f9a550-9b44-4546-9d70-8c12f550bb2e","isSidechain":false,"userType":"external","cwd":"/Users/naokisega/src/github.com/nsega/.emacs.d","sessionId":"3662272f-90eb-4f6d-acc3-1b561237eac1","version":"2.1.49","gitBranch":"feature/update-gitignore","slug":"clever-shimmying-tiger","type":"user","message":{"role":"user","content":[{"type":"tool_result","content":"The user doesn't want to proceed with this tool use. The tool use was rejected (eg. if it was a file edit, the new_string was NOT written to the file). STOP what you are doing and wait for the user to tell you how to proceed.","is_error":true,"tool_use_id":"toolu_01H9n2wQrEgVBSakBqxFf3de"}]},"uuid":"67e1bfa8-50b8-4b05-816e-adde2b37c7d9","timestamp":"2026-02-21T20:09:19.799Z","toolUseResult":"User rejected tool use","sourceToolAssistantUUID":"18f9a550-9b44-4546-9d70-8c12f550bb2e"}
{"parentUuid":"67e1bfa8-50b8-4b05-816e-adde2b37c7d9","isSidechain":false,"userType":"external","cwd":"/Users/naokisega/src/github.com/nsega/.emacs.d","sessionId":"3662272f-90eb-4f6d-acc3-1b561237eac1","version":"2.1.49","gitBranch":"feature/update-gitignore","slug":"clever-shimmying-tiger","type":"user","message":{"role":"user","content":[{"type":"text","text":"[Request interrupted by user for tool use]"}]},"uuid":"7d648183-3fc1-494e-b2a1-b2bd49a41faf","timestamp":"2026-02-21T20:09:19.803Z"}
{"type":"file-history-snapshot","messageId":"08047eff-4cd6-4d8a-9f42-3d971954781f","snapshot":{"messageId":"08047eff-4cd6-4d8a-9f42-3d971954781f","trackedFileBackups":{},"timestamp":"2026-02-21T20:09:33.586Z"},"isSnapshotUpdate":false}
{"parentUuid":"7d648183-3fc1-494e-b2a1-b2bd49a41faf","isSidechain":false,"userType":"external","cwd":"/Users/naokisega/src/github.com/nsega/.emacs.d","sessionId":"3662272f-90eb-4f6d-acc3-1b561237eac1","version":"2.1.49","gitBranch":"feature/update-gitignore","slug":"clever-shimmying-tiger","type":"user","message":{"role":"user","content":" 2. buffer-list-update-hook fires extremely often"},"uuid":"08047eff-4cd6-4d8a-9f42-3d971954781f","timestamp":"2026-02-21T20:09:33.423Z","permissionMode":"default"}
{"parentUuid":"08047eff-4cd6-4d8a-9f42-3d971954781f","isSidechain":false,"userType":"external","cwd":"/Users/naokisega/src/github.com/nsega/.emacs.d","sessionId":"3662272f-90eb-4f6d-acc3-1b561237eac1","version":"2.1.49","gitBranch":"feature/update-gitignore","slug":"clever-shimmying-tiger","message":{"model":"claude-sonnet-4-6","id":"msg_01K2nR8uH3MGJC3iDEM7fRvN","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"The user interrupted my edit and is pointing specifically to the `buffer-list-update-hook` issue. They want to focus on that. Let me address that specific fix.\n\nThe issue is in lines 222-226:\n```elisp\n(unless (display-graphic-p)\n  (add-hook 'buffer-list-update-hook #'my/set-terminal-title)\n  (add-hook 'window-configuration-change-hook #'my/set-terminal-title)\n  ;; Set initial title\n  (add-hook 'emacs-startup-hook #'my/set-terminal-title))\n```\n\n`buffer-list-update-hook` fires on literally every buffer operation - every time a buffer is accessed, created, etc. \n\nThe real problem is that `my/set-terminal-title` triggers `my/get-frame-title`, which calls `project-current` and does expensive directory scanning on every single buffer change. I need to debounce this—either by switching to a less frequent hook with idle timers, or using window-specific hooks that fire less often. The GUI mode also has the same issue with `frame-title-format` calling the same expensive function.","signature":"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"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":3,"cache_creation_input_tokens":42332,"cache_read_input_tokens":10370,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":42332},"output_tokens":8,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYMpYaYMkfmn1ZnL8eAUD","type":"assistant","uuid":"edbacca2-b675-4068-b9de-059084cbd0aa","timestamp":"2026-02-21T20:09:43.041Z"}
{"parentUuid":"edbacca2-b675-4068-b9de-059084cbd0aa","isSidechain":false,"userType":"external","cwd":"/Users/naokisega/src/github.com/nsega/.emacs.d","sessionId":"3662272f-90eb-4f6d-acc3-1b561237eac1","version":"2.1.49","gitBranch":"feature/update-gitignore","slug":"clever-shimmying-tiger","message":{"model":"claude-sonnet-4-6","id":"msg_01K2nR8uH3MGJC3iDEM7fRvN","type":"message","role":"assistant","content":[{"type":"text","text":"Right. The `buffer-list-update-hook` fires on every buffer access (read, write, switch — everything). Your `my/set-terminal-title` calls `project-current` (directory scan) each time. This alone can cause sustained high CPU.\n\n**The fix:** replace `buffer-list-update-hook` with an idle timer so the title only updates when Emacs is idle:"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":3,"cache_creation_input_tokens":42332,"cache_read_input_tokens":10370,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":42332},"output_tokens":8,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYMpYaYMkfmn1ZnL8eAUD","type":"assistant","uuid":"0192857a-405f-4d22-bc83-46575a8d064a","timestamp":"2026-02-21T20:09:44.448Z"}
{"parentUuid":"0192857a-405f-4d22-bc83-46575a8d064a","isSidechain":false,"userType":"external","cwd":"/Users/naokisega/src/github.com/nsega/.emacs.d","sessionId":"3662272f-90eb-4f6d-acc3-1b561237eac1","version":"2.1.49","gitBranch":"feature/update-gitignore","slug":"clever-shimmying-tiger","message":{"model":"claude-sonnet-4-6","id":"msg_01K2nR8uH3MGJC3iDEM7fRvN","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_016Npr1DGWJ1jHWGjnwb94JY","name":"Edit","input":{"replace_all":false,"file_path":"/Users/naokisega/src/github.com/nsega/.emacs.d/init.el","old_string":";; Update terminal title on relevant events\n(unless (display-graphic-p)\n  (add-hook 'buffer-list-update-hook #'my/set-terminal-title)\n  (add-hook 'window-configuration-change-hook #'my/set-terminal-title)\n  ;; Set initial title\n  (add-hook 'emacs-startup-hook #'my/set-terminal-title))","new_string":";; Update terminal title on relevant events\n;; Use idle timer instead of buffer-list-update-hook (which fires on every buffer access)\n(unless (display-graphic-p)\n  (run-with-idle-timer 1 t #'my/set-terminal-title)\n  (add-hook 'emacs-startup-hook #'my/set-terminal-title))"},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":3,"cache_creation_input_tokens":42332,"cache_read_input_tokens":10370,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":42332},"output_tokens":8,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYMpYaYMkfmn1ZnL8eAUD","type":"assistant","uuid":"0e10e472-e29a-40e8-961b-0e79d8941c39","timestamp":"2026-02-21T20:09:46.842Z"}
{"type":"file-history-snapshot","messageId":"0e10e472-e29a-40e8-961b-0e79d8941c39","snapshot":{"messageId":"08047eff-4cd6-4d8a-9f42-3d971954781f","trackedFileBackups":{"init.el":{"backupFileName":"ca1a9224200ea1df@v1","version":1,"backupTime":"2026-02-21T20:09:48.807Z"}},"timestamp":"2026-02-21T20:09:33.586Z"},"isSnapshotUpdate":true}
{"parentUuid":"0e10e472-e29a-40e8-961b-0e79d8941c39","isSidechain":false,"userType":"external","cwd":"/Users/naokisega/src/github.com/nsega/.emacs.d","sessionId":"3662272f-90eb-4f6d-acc3-1b561237eac1","version":"2.1.49","gitBranch":"feature/update-gitignore","slug":"clever-shimmying-tiger","type":"progress","data":{"type":"hook_progress","hookEvent":"PostToolUse","hookName":"PostToolUse:Edit","command":"callback"},"parentToolUseID":"toolu_016Npr1DGWJ1jHWGjnwb94JY","toolUseID":"toolu_016Npr1DGWJ1jHWGjnwb94JY","timestamp":"2026-02-21T20:09:48.811Z","uuid":"c27d4fbb-9efa-40ee-9914-f0b0c5acbb19"}
{"parentUuid":"0e10e472-e29a-40e8-961b-0e79d8941c39","isSidechain":false,"userType":"external","cwd":"/Users/naokisega/src/github.com/nsega/.emacs.d","sessionId":"3662272f-90eb-4f6d-acc3-1b561237eac1","version":"2.1.49","gitBranch":"feature/update-gitignore","slug":"clever-shimmying-tiger","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_016Npr1DGWJ1jHWGjnwb94JY","type":"tool_result","content":"The file /Users/naokisega/src/github.com/nsega/.emacs.d/init.el has been updated successfully."}]},"uuid":"e0ac74cc-6c12-4e2b-9263-26b68dbcb551","timestamp":"2026-02-21T20:09:48.810Z","toolUseResult":{"filePath":"/Users/naokisega/src/github.com/nsega/.emacs.d/init.el","oldString":";; Update terminal title on relevant events\n(unless (display-graphic-p)\n  (add-hook 'buffer-list-update-hook #'my/set-terminal-title)\n  (add-hook 'window-configuration-change-hook #'my/set-terminal-title)\n  ;; Set initial title\n  (add-hook 'emacs-startup-hook #'my/set-terminal-title))","newString":";; Update terminal title on relevant events\n;; Use idle timer instead of buffer-list-update-hook (which fires on every buffer access)\n(unless (display-graphic-p)\n  (run-with-idle-timer 1 t #'my/set-terminal-title)\n  (add-hook 'emacs-startup-hook #'my/set-terminal-title))","originalFile":";;; init.el --- Modern Emacs Configuration -*- lexical-binding: t; -*-\n\n;; Author: Naoki Sega\n;; Maintainer: Naoki Sega\n;; URL: https://github.com/nsega/.emacs.d\n;; Keywords: convenience\n\n;;; Commentary:\n\n;; Modern Emacs configuration using use-package for declarative package management.\n;; Migrated from traditional setup to use modern best practices for Emacs 30+.\n;;\n;; Key Features:\n;; - Vertico ecosystem for lightweight, fast completion (replaces Helm)\n;; - Eglot LSP for intelligent code navigation (Python, Go, TypeScript)\n;; - Tree-sitter modes for Python, Go, YAML (accurate syntax highlighting)\n;; - Company-mode for auto-completion\n;; - Modern advice-add instead of deprecated defadvice\n;; - Single, well-organized init.el (no separate custom/*.el files)\n;; - early-init.el for faster startup and no UI flickering\n;; - no-littering for clean .emacs.d directory\n;;\n;; Package Management:\n;; - Uses use-package for all package configuration\n;; - Lazy loading where appropriate for fast startup\n;; - Self-documenting package declarations\n;;\n;; Completion Framework:\n;; - vertico: Vertical completion UI\n;; - consult: Enhanced completing-read commands\n;; - marginalia: Rich annotations in minibuffer\n;; - embark: Contextual actions on completion candidates\n;; - orderless: Flexible matching style\n;;\n;; Code Intelligence:\n;; - Eglot: Built-in LSP client (Emacs 29+)\n;; - Company: Auto-completion framework\n;; - dumb-jump: Fallback navigation for non-LSP files\n;;\n;; For more information, see: https://github.com/nsega/.emacs.d\n\n;;; Code:\n\n;; ============================================================\n;; Package Management\n;; ============================================================\n(require 'package)\n(add-to-list 'package-archives\n             '(\"melpa\" . \"https://melpa.org/packages/\") t)\n(package-initialize)\n\n;; ============================================================\n;; Bootstrap use-package\n;; ============================================================\n(unless (package-installed-p 'use-package)\n  (package-refresh-contents)\n  (package-install 'use-package))\n\n(eval-when-compile (require 'use-package))\n(setq use-package-always-ensure t)\n(setq use-package-compute-statistics t)  ; For performance monitoring via M-x use-package-report\n\n;; ============================================================\n;; Directory Organization - no-littering\n;; ============================================================\n;; Keep .emacs.d clean by redirecting package files to var/ and etc/\n(use-package no-littering\n  :demand t  ; Load early to affect all subsequent packages\n  :config\n  ;; Put auto-save files in var directory\n  (setq auto-save-file-name-transforms\n        `((\".*\" ,(no-littering-expand-var-file-name \"auto-save/\") t)))\n  ;; Put native-comp cache in var directory (only if native-comp is available)\n  (when (and (fboundp 'startup-redirect-eln-cache)\n             (boundp 'native-comp-eln-load-path))\n    (startup-redirect-eln-cache\n     (convert-standard-filename\n      (expand-file-name \"var/eln-cache/\" user-emacs-directory)))))\n\n;; Pre-configure claude-code to use vterm (must be set before package loads)\n(setq claude-code-terminal-backend 'vterm)\n\n;; ============================================================\n;; Basic Settings\n;; ============================================================\n;; NOTE: gc-cons-threshold is set in early-init.el for faster startup\n;; and automatically reset after Emacs finishes loading\n(setq inhibit-startup-message t)\n\n;; Suppress byte-compile warnings from packages\n(setq byte-compile-warnings '(not obsolete))\n(setq warning-suppress-log-types '((comp) (bytecomp)))\n(setq native-comp-async-report-warnings-errors 'silent)\n\n;; PATH setup is handled by exec-path-from-shell (see below)\n;; This ensures Emacs inherits PATH from your shell\n(setq exec-path (cons \"/opt/homebrew/bin\" exec-path))\n(setq exec-path (cons \"/usr/local/bin\" exec-path))\n\n(defalias 'yes-or-no-p 'y-or-n-p)\n\n;; ============================================================\n;; macOS Clipboard Integration\n;; ============================================================\n;; Sync kill ring with macOS system clipboard via pbcopy/pbpaste\n(when (eq system-type 'darwin)\n  (setq interprogram-cut-function\n        (lambda (text &optional _)\n          (let ((process-connection-type nil))\n            (let ((proc (start-process \"pbcopy\" nil \"pbcopy\")))\n              (process-send-string proc text)\n              (process-send-eof proc)))))\n  (setq interprogram-paste-function\n        (lambda ()\n          (let ((clipboard (shell-command-to-string \"pbpaste\")))\n            (unless (string= clipboard (car kill-ring))\n              clipboard)))))\n\n;; ============================================================\n;; macOS Native Scrolling\n;; ============================================================\n;; Enable pixel-precise scrolling for smooth trackpad experience\n;; Makes Emacs feel like a native macOS application (Emacs 29+)\n(when (fboundp 'pixel-scroll-precision-mode)\n  (pixel-scroll-precision-mode 1))\n\n;; ============================================================\n;; Mouse Support (Terminal and GUI)\n;; ============================================================\n;; Enable mouse in terminal emulators (Ghostty, iTerm2, etc.)\n;; Safe to enable always - only activates in terminal frames\n(xterm-mouse-mode 1)\n\n;; Auto-copy mouse selection to clipboard (like typical terminal behavior)\n(setq mouse-drag-copy-region t)\n\n;; Mouse wheel scrolling (works in both terminal and GUI)\n(global-set-key [mouse-4] 'scroll-down-command)\n(global-set-key [mouse-5] 'scroll-up-command)\n\n;; Drag mode-line to resize windows vertically (click and drag the status bar)\n;; Drag vertical border to resize windows horizontally\n(global-set-key [mode-line mouse-1] 'mouse-drag-mode-line)\n(global-set-key [vertical-line mouse-1] 'mouse-drag-vertical-line)\n\n;; Scroll through buffer history with mouse wheel on mode-line\n(global-set-key [mode-line mouse-4] 'previous-buffer)\n(global-set-key [mode-line mouse-5] 'next-buffer)\n(global-set-key [mode-line wheel-up] 'previous-buffer)\n(global-set-key [mode-line wheel-down] 'next-buffer)\n\n;; Or use Ctrl+wheel anywhere to switch buffers\n(global-set-key [C-mouse-4] 'previous-buffer)\n(global-set-key [C-mouse-5] 'next-buffer)\n(global-set-key [C-wheel-up] 'previous-buffer)\n(global-set-key [C-wheel-down] 'next-buffer)\n\n;; Window layout undo/redo\n;; C-c <left> to undo, C-c <right> to redo window configuration\n;; Note: May conflict with org-mode/markdown-mode C-c bindings in those buffers\n(winner-mode 1)\n\n;; Allow resizing side windows (help, compilation, etc.) via mouse drag\n(setq window-resize-pixelwise t)  ; Precise pixel resizing for smoother drag\n(setq window-sides-slots '(1 1 1 1))  ; Allow side windows on all sides\n;; Don't preserve side window sizes - allow free resizing\n(setq window-sides-vertical nil)  ; Side windows on left/right don't span full height\n(add-to-list 'window-persistent-parameters '(window-side . writable))\n\n;; GUI-only: window dividers for easier grabbing\n(when (display-graphic-p)\n  (setq window-divider-default-places t)\n  (setq window-divider-default-right-width 6)  ; Wider for easier grabbing\n  (setq window-divider-default-bottom-width 6)\n  (window-divider-mode 1)\n  (global-set-key [right-divider mouse-1] 'mouse-drag-vertical-line)\n  (global-set-key [bottom-divider mouse-1] 'mouse-drag-mode-line))\n\n;; ============================================================\n;; Terminal Vertical Split Display Fix\n;; ============================================================\n;; Prevent text overflow between vertically split windows in terminal\n(unless (display-graphic-p)\n  ;; Force line truncation in split windows to prevent overflow\n  (setq truncate-partial-width-windows t)\n  (setq-default truncate-lines t)  ; Truncate all lines in terminal\n  ;; Use ASCII vertical bar for window border (Unicode can cause width issues)\n  (set-display-table-slot standard-display-table 'vertical-border ?|)\n  ;; Ensure no margins\n  (setq-default left-margin-width 0)\n  (setq-default right-margin-width 0)\n  ;; Disable word wrap that can cause overflow\n  (setq-default word-wrap nil)\n  (global-visual-line-mode -1))\n\n;; ============================================================\n;; Frame/Terminal Title - Show project name in window list\n;; ============================================================\n;; This makes it easy to identify Emacs instances in Ghostty/terminal window lists\n\n(defun my/get-frame-title ()\n  \"Return a title string showing project and current buffer.\"\n  (let ((project (project-current)))\n    (format \"emacs [%s] - %s\"\n            (if project\n                (project-name project)\n              (abbreviate-file-name default-directory))\n            (buffer-name))))\n\n;; GUI Emacs: Set frame title\n(setq frame-title-format '(:eval (my/get-frame-title)))\n\n;; Terminal Emacs: Send escape sequence to set terminal window title\n(defun my/set-terminal-title ()\n  \"Set terminal window title to project name or directory.\"\n  (when (and (not (display-graphic-p))\n             (getenv \"TERM\"))\n    (send-string-to-terminal\n     (format \"\\033]0;%s\\007\" (my/get-frame-title)))))\n\n;; Update terminal title on relevant events\n(unless (display-graphic-p)\n  (add-hook 'buffer-list-update-hook #'my/set-terminal-title)\n  (add-hook 'window-configuration-change-hook #'my/set-terminal-title)\n  ;; Set initial title\n  (add-hook 'emacs-startup-hook #'my/set-terminal-title))\n\n(defconst demo-packages\n  '(anzu\n    company\n    ;; duplicate-thing  ; removed - no longer available on MELPA\n    ;; Completion framework - Vertico ecosystem (replaces Helm)\n    vertico\n    orderless\n    marginalia\n    consult\n    embark\n    embark-consult\n    migemo\n    ;; function-args\n    clean-aindent-mode\n    comment-dwim-2\n    dtrt-indent\n    ws-butler\n    iedit\n    yasnippet\n    smartparens\n    volatile-highlights\n    undo-tree\n    zygospore\n    ;; Modern language modes\n    exec-path-from-shell  ; Better PATH handling on macOS\n    go-mode               ; Go support (fallback if tree-sitter grammar unavailable)\n    yaml-mode             ; YAML support (fallback if tree-sitter grammar unavailable)\n    typescript-mode       ; TypeScript support (fallback if tree-sitter grammar unavailable)\n    web-mode              ; TSX/JSX support (fallback if tree-sitter grammar unavailable)\n    markdown-mode         ; Markdown support\n    ;; JVM languages\n    kotlin-mode           ; Kotlin support (fallback if tree-sitter grammar unavailable)\n    groovy-mode           ; Groovy/Gradle support\n    ;; Navigation fallback\n    dumb-jump             ; Jump to definition without tags/LSP\n    ;; Terminal\n    vterm                 ; Terminal emulator for Claude Code\n    eat                   ; Emulate A Terminal (another terminal emulator)\n    ))\n\n(defun install-packages ()\n  \"Install all required packages.\"\n  (interactive)\n  (unless package-archive-contents\n    (package-refresh-contents))\n  (dolist (package demo-packages)\n    (unless (package-installed-p package)\n      (package-install package))))\n\n(install-packages)\n\n;; ============================================================\n;; Navigation Enhancements\n;; ============================================================\n;; M-. (xref-find-definitions) and M-? (xref-find-references) are\n;; built-in bindings. Eglot automatically registers as xref backend.\n\n;; ============================================================\n;; dumb-jump - Fallback navigation when no tags/LSP available\n;; ============================================================\n(use-package dumb-jump\n  :config\n  (add-hook 'xref-backend-functions #'dumb-jump-xref-activate)\n  :custom\n  (dumb-jump-prefer-searcher 'rg)  ; Use ripgrep if available\n  (dumb-jump-force-searcher nil))\n\n;; ============================================================\n;; Completion - Company Mode\n;; ============================================================\n(use-package company\n  :hook (after-init . global-company-mode)\n  :config\n  (delete 'company-semantic company-backends)\n  ;; Add tab completion for C/C++ modes\n  (add-hook 'c-mode-hook\n            (lambda ()\n              (local-set-key (kbd \"<tab>\") 'company-complete)))\n  (add-hook 'c++-mode-hook\n            (lambda ()\n              (local-set-key (kbd \"<tab>\") 'company-complete)))\n  :custom\n  (company-idle-delay 0.1)\n  (company-minimum-prefix-length 2)\n  (company-show-numbers t))\n\n(use-package company-c-headers\n  :after company\n  :config\n  (add-to-list 'company-backends 'company-c-headers))\n\n;; hs-minor-mode for folding source code\n(add-hook 'c-mode-common-hook 'hs-minor-mode)\n\n;; Available C style:\n;; “gnu”: The default style for GNU projects\n;; “k&r”: What Kernighan and Ritchie, the authors of C used in their book\n;; “bsd”: What BSD developers use, aka “Allman style” after Eric Allman.\n;; “whitesmith”: Popularized by the examples that came with Whitesmiths C, an early commercial C compiler.\n;; “stroustrup”: What Stroustrup, the author of C++ used in his book\n;; “ellemtel”: Popular C++ coding standards as defined by “Programming in C++, Rules and Recommendations,” Erik Nyquist and Mats Henricson, Ellemtel\n;; “linux”: What the Linux developers use for kernel development\n;; “python”: What Python developers use for extension modules\n;; “java”: The default style for java-mode (see below)\n;; “user”: When you want to define your own style\n(setq\n c-default-style \"linux\" ;; set style to \"linux\"\n )\n\n(global-set-key (kbd \"RET\") 'newline-and-indent)  ; automatically indent when press RET\n\n;; activate whitespace-mode to view all whitespace characters\n(global-set-key (kbd \"C-c w\") 'whitespace-mode)\n\n;; show unncessary whitespace that can mess up your diff\n(add-hook 'prog-mode-hook (lambda () (interactive) (setq show-trailing-whitespace 1)))\n\n;; use space to indent by default\n(setq-default indent-tabs-mode nil)\n\n;; set appearance of a tab that is represented by 4 spaces\n(setq-default tab-width 4)\n\n;; Compilation\n(global-set-key (kbd \"<f5>\") (lambda ()\n                               (interactive)\n                               (setq-local compilation-read-command nil)\n                               (call-interactively 'compile)))\n\n;; setup GDB\n(setq\n ;; use gdb-many-windows by default\n gdb-many-windows t\n\n ;; Non-nil means display source file containing the main routine at startup\n gdb-show-main t\n )\n\n;; ============================================================\n;; Completion Framework - Vertico Ecosystem\n;; ============================================================\n\n;; vertico - Vertical completion UI\n(use-package vertico\n  :init\n  (vertico-mode)\n  :custom\n  (vertico-cycle t)\n  :bind (:map vertico-map\n              (\"C-j\" . vertico-next)\n              (\"C-k\" . vertico-previous)))\n\n;; orderless - Flexible completion matching\n(use-package orderless\n  :custom\n  (completion-styles '(orderless basic))\n  (completion-category-defaults nil)\n  (completion-category-overrides '((file (styles partial-completion)))))\n\n;; marginalia - Rich annotations in minibuffer\n(use-package marginalia\n  :init\n  (marginalia-mode))\n\n;; consult - Consulting completing-read\n(use-package consult\n  :bind ((\"C-x b\" . consult-buffer)\n         (\"M-g i\" . consult-imenu)\n         (\"M-s l\" . consult-line)\n         (\"M-s g\" . consult-grep)\n         (\"M-s r\" . consult-ripgrep)\n         (\"M-y\" . consult-yank-pop)\n         ;; Alternative bindings for terminal (M-s often conflicts)\n         (\"C-c s l\" . consult-line)       ; Alternative to M-s l\n         (\"C-c s g\" . consult-grep)       ; Alternative to M-s g\n         (\"C-c s r\" . consult-ripgrep)    ; Alternative to M-s r\n         (\"C-c s i\" . consult-imenu)      ; Alternative to M-g i\n         :map minibuffer-local-map\n         (\"M-p\" . consult-history)))\n\n;; embark - Contextual actions\n(use-package embark\n  :bind ((\"C-.\" . embark-act)\n         (\"C-c e b\" . embark-bindings)))  ; C-h B conflicts with C-h as backspace\n\n;; embark-consult - Integration between embark and consult\n(use-package embark-consult\n  :after (embark consult))\n\n;; ============================================================\n;; Editing Enhancements (use-package)\n;; ============================================================\n\n;; Package: clean-aindent-mode - Clean auto-indent and backspace behavior\n(use-package clean-aindent-mode\n  :hook (prog-mode . clean-aindent-mode))\n\n;; Package: dtrt-indent - Detect indent style automatically\n(use-package dtrt-indent\n  :config\n  (dtrt-indent-mode 1)\n  (setq dtrt-indent-verbosity 0))\n\n;; Package: ws-butler - Trim whitespace only on edited lines\n(use-package ws-butler\n  :hook ((prog-mode . ws-butler-mode)\n         (text-mode . ws-butler-mode)\n         (fundamental-mode . ws-butler-mode)))\n\n;; Package: yasnippet - Template system\n(use-package yasnippet\n  :config\n  (yas-global-mode 1)\n  ;; Don't activate in terminal mode\n  (add-hook 'term-mode-hook (lambda() (setq yas-dont-activate t)))\n  :custom\n  (yas-verbosity 1)\n  (yas-wrap-around-region t)\n  (yas-prompt-functions '(yas/ido-prompt yas/completing-prompt)))\n\n;; Package: smartparens - Parenthesis management\n(use-package smartparens\n  :config\n  (require 'smartparens-config)\n  (setq sp-base-key-bindings 'paredit)\n  (setq sp-autoskip-closing-pair 'always)\n  (setq sp-hybrid-kill-entire-symbol nil)\n  (sp-use-paredit-bindings)\n  (show-smartparens-global-mode +1)\n  (smartparens-global-mode 1))\n\n;; ============================================================\n;; Project Management - Built-in project.el (Emacs 28+)\n;; ============================================================\n;; project.el is built-in and integrates natively with Eglot, xref, and Consult.\n;; Default prefix: C-x p\n\n(setq project-switch-commands\n      '((project-find-file \"Find file\" ?f)\n        (project-find-regexp \"Find regexp\" ?g)\n        (project-find-dir \"Find directory\" ?d)\n        (project-eshell \"Eshell\" ?e)))\n\n;; ============================================================\n;; Dired Configuration\n;; ============================================================\n;; Auto-revert Dired buffer when switching to it (picks up filesystem changes)\n(setq dired-auto-revert-buffer t)\n\n;; Package: zygospore - Reversible C-x 1 (delete-other-windows)\n(use-package zygospore\n  :bind ((\"C-x 1\" . zygospore-toggle-delete-other-windows)))\n\n;; Package: anzu - Show match count in mode-line while searching\n(use-package anzu\n  :config\n  (global-anzu-mode)\n  :bind ((\"M-%\" . anzu-query-replace)\n         (\"C-M-%\" . anzu-query-replace-regexp)))\n\n;; Package: volatile-highlights - Highlight changes from yanking, undo, etc.\n(use-package volatile-highlights\n  :config\n  (volatile-highlights-mode t))\n\n;; Package: undo-tree - Visualize undo history as a tree\n(use-package undo-tree\n  :config\n  (global-undo-tree-mode))\n\n;; Package: comment-dwim-2 - Smarter comment/uncomment\n(use-package comment-dwim-2\n  :bind ((\"M-;\" . comment-dwim-2)))\n\n;; Package: iedit - Edit multiple occurrences simultaneously\n(use-package iedit\n  :custom\n  (iedit-toggle-key-default nil)\n  :bind ((\"C-;\" . iedit-mode)))\n\n;; ============================================================\n;; Custom Editing Behaviors (modernized from setup-editing.el)\n;; ============================================================\n\n;; Enhanced kill/copy/yank behaviors using modern advice-add\n\n;; 1. Copy line when no region is active (M-w)\n(defun my/slick-copy-advice (orig-fun &rest args)\n  \"Copy line when no region is active.\"\n  (interactive\n   (if mark-active\n       (list (region-beginning) (region-end))\n     (message \"Copied line\")\n     (list (line-beginning-position)\n           (line-beginning-position 2))))\n  (apply orig-fun args))\n\n(advice-add 'kill-ring-save :around #'my/slick-copy-advice)\n\n;; 2. Cut line when no region is active (C-w)\n(defun my/slick-cut-advice (orig-fun &rest args)\n  \"Cut line when no region is active.\"\n  (interactive\n   (if mark-active\n       (list (region-beginning) (region-end))\n     (list (line-beginning-position)\n           (line-beginning-position 2))))\n  (apply orig-fun args))\n\n(advice-add 'kill-region :around #'my/slick-cut-advice)\n\n;; 3. Clean whitespace before killing line (C-k)\n(defun my/kill-line-whitespace-advice (&rest _args)\n  \"Clean whitespace before killing line in programming modes.\"\n  (when (member major-mode\n                '(emacs-lisp-mode scheme-mode lisp-mode\n                  c-mode c++-mode objc-mode\n                  latex-mode plain-tex-mode))\n    (when (and (eolp) (not (bolp)))\n      (forward-char 1)\n      (just-one-space 0)\n      (backward-char 1))))\n\n(advice-add 'kill-line :before #'my/kill-line-whitespace-advice)\n\n;; 4. Auto-indent yanked text in programming modes (C-y, M-y)\n(defvar yank-indent-modes\n  '(LaTeX-mode TeX-mode)\n  \"Modes in which to indent regions that are yanked (or yank-popped).\nOnly modes that don't derive from `prog-mode' should be listed here.\")\n\n(defvar yank-indent-blacklisted-modes\n  '(python-mode slim-mode haml-mode)\n  \"Modes for which auto-indenting is suppressed.\")\n\n(defvar yank-advised-indent-threshold 1000\n  \"Threshold (# chars) over which indentation does not automatically occur.\")\n\n(defun yank-advised-indent-function (beg end)\n  \"Do indentation, as long as the region isn't too large.\"\n  (if (<= (- end beg) yank-advised-indent-threshold)\n      (indent-region beg end nil)))\n\n(defun my/yank-indent-advice (orig-fun &rest args)\n  \"Auto-indent yanked text in programming modes.\"\n  (let ((result (apply orig-fun args)))\n    (when (and (not (car args))\n               (not (member major-mode yank-indent-blacklisted-modes))\n               (or (derived-mode-p 'prog-mode)\n                   (member major-mode yank-indent-modes)))\n      (let ((transient-mark-mode nil))\n        (yank-advised-indent-function (region-beginning) (region-end))))\n    result))\n\n(advice-add 'yank :around #'my/yank-indent-advice)\n(advice-add 'yank-pop :around #'my/yank-indent-advice)\n\n;; Other useful editing functions from setup-editing.el\n\n;; Smart move to beginning of line (C-a)\n(defun prelude-move-beginning-of-line (arg)\n  \"Move point back to indentation of beginning of line.\n\nMove point to the first non-whitespace character on this line.\nIf point is already there, move to the beginning of the line.\nEffectively toggle between the first non-whitespace character and\nthe beginning of the line.\n\nIf ARG is not nil or 1, move forward ARG - 1 lines first. If\npoint reaches the beginning or end of the buffer, stop there.\"\n  (interactive \"^p\")\n  (setq arg (or arg 1))\n\n  ;; Move lines first\n  (when (/= arg 1)\n    (let ((line-move-visual nil))\n      (forward-line (1- arg))))\n\n  (let ((orig-point (point)))\n    (back-to-indentation)\n    (when (= orig-point (point))\n      (move-beginning-of-line 1))))\n\n(global-set-key (kbd \"C-a\") 'prelude-move-beginning-of-line)\n\n;; Smart open line (M-o)\n(defun prelude-smart-open-line (arg)\n  \"Insert an empty line after the current line.\nPosition the cursor at its beginning, according to the current mode.\nWith a prefix ARG open line above the current line.\"\n  (interactive \"P\")\n  (if arg\n      (prelude-smart-open-line-above)\n    (progn\n      (move-end-of-line nil)\n      (newline-and-indent))))\n\n(defun prelude-smart-open-line-above ()\n  \"Insert an empty line above the current line.\nPosition the cursor at it's beginning, according to the current mode.\"\n  (interactive)\n  (move-beginning-of-line nil)\n  (newline-and-indent)\n  (forward-line -1)\n  (indent-according-to-mode))\n\n(global-set-key (kbd \"M-o\") 'prelude-smart-open-line)\n\n;; Indent buffer or region (C-c i)\n(defun indent-buffer ()\n  \"Indent the currently visited buffer.\"\n  (interactive)\n  (indent-region (point-min) (point-max)))\n\n(defcustom prelude-indent-sensitive-modes\n  '(coffee-mode python-mode slim-mode haml-mode yaml-mode)\n  \"Modes for which auto-indenting is suppressed.\"\n  :type 'list)\n\n(defun indent-region-or-buffer ()\n  \"Indent a region if selected, otherwise the whole buffer.\"\n  (interactive)\n  (unless (member major-mode prelude-indent-sensitive-modes)\n    (save-excursion\n      (if (region-active-p)\n          (progn\n            (indent-region (region-beginning) (region-end))\n            (message \"Indented selected region.\"))\n        (progn\n          (indent-buffer)\n          (message \"Indented buffer.\")))\n      (whitespace-cleanup))))\n\n(global-set-key (kbd \"C-c i\") 'indent-region-or-buffer)\n\n;; ============================================================\n;; Speedbar\n(setq speedbar-show-unknown-files t)\n\n;; NOTE: Removed old macOS Mavericks workaround that forced home directory\n;; This was causing issues with `emacs .` not respecting current directory\n;; If you need to start in home directory, use: emacs ~\n;;\n;; Old code (commented out):\n;; ;;　Changing the home directory as the initial dir(for Mervelicks)\n;; (setq default-directory \"~/\")\n;; (setq command-line-default-directory \"~/\")\n;;\n;; ;; Changing the default directory as of '〜/' for Mavericks\n;; (defun cd-to-homedir-all-buffers ()\n;;   \"Change every current directory of all buffers to the home directory.\"\n;;   (mapc\n;;    (lambda (buf) (set-buffer buf) (cd (expand-file-name \"~\"))) (buffer-list)))\n;; (add-hook 'after-init-hook 'cd-to-homedir-all-buffers)\n\n;; Japanese Configuration (UTF-8)\n(set-language-environment \"Japanese\")\n(set-terminal-coding-system 'utf-8)\n(set-keyboard-coding-system 'utf-8)\n(set-buffer-file-coding-system 'utf-8)\n(setq buffer-file-coding-system 'utf-8)\n(setq slime-net-coding-system 'utf-8-unix)\n\n;; key bindings\n(windmove-default-keybindings 'meta)\n(setq mac-option-modifier 'meta)\n(setq mac-command-modifier 'meta)\n(global-set-key [kp-delete] 'delete-char) ;; sets fn-delete to be right-delete\n\n;; Enabling Font Lock mode (e.g. bold display)\n(global-font-lock-mode t)\n\n;; Enabling automcatically the temporarily mode\n(setq-default transient-mark-mode t)\n\n;; Changing C-x C-u to be worked nothing (undo / typo countermeasure)\n(global-unset-key \"\\C-x\\C-u\")\n\n;; High lighting the pared parenethesis\n(show-paren-mode 1)\n\n(setq next-line-add-newlines nil)\n\n;; C-x l/ run goto-line\n(define-key ctl-x-map \"l\" 'goto-line)\n;; alternate of '¥', entering '/'\n(define-key global-map [?¥] [?\\\\])\n\n(display-time)\n\n;; display the column number\n(column-number-mode 1)\n\n;; NOTE: menu-bar, tool-bar, and scroll-bars are disabled in early-init.el\n;; to prevent UI flickering during startup\n\n;; Make C-h act as backspace\n(define-key global-map \"\\C-h\" 'delete-backward-char)\n(define-key global-map \"\\C-x\\C-h\" 'help-command)\n;; Also bind in key-translation-map to override help-map\n(define-key key-translation-map (kbd \"C-h\") (kbd \"<DEL>\"))\n;; Override in isearch-mode\n(define-key isearch-mode-map \"\\C-h\" 'isearch-delete-char)\n(define-key global-map \"\\C-o\" 'dabbrev-expand)\n(setq dabbrev-case-fold-search nil)\n\n;;; Don't create the backup file\n(setq backup-inhibited t)\n\n;;; Deleting the save files when it was exited.\n(setq delete-auto-save-files t)\n\n;; Configuration for Japanese and English\n;; http://www.alles.or.jp/~torutk/oojava/meadow/Meadow210Install.html\n(defun my/dabbrev-expand-japanese-advice (orig-fun &rest args)\n  \"Modify `dabbrev-abbrev-char-regexp' dynamically for Japanese words.\"\n  (if (bobp)\n      (apply orig-fun args)\n    (let ((dabbrev-abbrev-char-regexp\n           (let ((c (char-category-set (char-before))))\n             (cond\n              ((aref c ?a) \"[-_A-Za-z0-9]\") ; ASCII\n              ((aref c ?j) ; Japanese\n               (cond\n                ((aref c ?K) \"\\\\cK\") ; katakana\n                ((aref c ?A) \"\\\\cA\") ; 2byte alphanumeric\n                ((aref c ?H) \"\\\\cH\") ; hiragana\n                ((aref c ?C) \"\\\\cC\") ; kanji\n                (t \"\\\\cj\")))\n              ((aref c ?k) \"\\\\ck\") ; hankaku-kana\n              ((aref c ?r) \"\\\\cr\") ; Japanese roman ?\n              (t dabbrev-abbrev-char-regexp)))))\n      (apply orig-fun args))))\n\n(advice-add 'dabbrev-expand :around #'my/dabbrev-expand-japanese-advice)\n\n;; Configuration Backspace\n(delete-selection-mode 1)\n\n;; The local variables list in .emacs と言われるのを抑止\n(add-to-list 'ignored-local-variables 'syntax)\n\n;; http://0xcc.net/blog/archives/000041.html\n(set-default-coding-systems 'utf-8)\n\n;; ============================================================\n;; Theme and Colors\n;; ============================================================\n;; modus-vivendi - High contrast dark theme (built-in since Emacs 28)\n;; Part of the modus-themes package by Protesilaos Stavrou\n(load-theme 'modus-vivendi t)\n\n;; Font configuration\n(when window-system\n  (set-frame-font \"Monaco-12\" nil t)\n  (set-frame-parameter nil 'alpha 100))\n\n(setq default-frame-alist\n  (append\n   '((font . \"Monaco-12\") ;; Default Fontset\n  (width . 140) (height . 50) ;; Window Size\n  )\n  default-frame-alist))\n\n;; ============================================================\n;; migemo - Japanese incremental search with Romanization\n;; ============================================================\n;; Requires: brew install cmigemo\n(use-package migemo\n  :if (executable-find \"cmigemo\")\n  :custom\n  (migemo-command \"cmigemo\")\n  (migemo-options '(\"-q\" \"--emacs\"))\n  (migemo-dictionary \"/opt/homebrew/share/migemo/utf-8/migemo-dict\")\n  (migemo-user-dictionary nil)\n  (migemo-regex-dictionary nil)\n  (migemo-coding-system 'utf-8-unix)\n  :config\n  (migemo-init))\n\n;; ============================================================\n;; exec-path-from-shell - Better PATH handling on macOS\n;; ============================================================\n(use-package exec-path-from-shell\n  :if (memq window-system '(mac ns x))\n  :config\n  (exec-path-from-shell-initialize)\n  ;; Copy additional environment variables for development tools\n  (exec-path-from-shell-copy-envs '(\"GOPATH\" \"GOROOT\" \"PYENV_ROOT\" \"VOLTA_HOME\"))\n  ;; Add Volta bin directory to exec-path for npm global packages\n  (when-let ((volta-home (getenv \"VOLTA_HOME\")))\n    (add-to-list 'exec-path (expand-file-name \"bin\" volta-home)))\n  ;; Add pyenv shims to exec-path for pip global packages\n  (let ((pyenv-root (or (getenv \"PYENV_ROOT\")\n                        (expand-file-name \"~/.pyenv\"))))\n    (when (file-directory-p pyenv-root)\n      (add-to-list 'exec-path (expand-file-name \"shims\" pyenv-root)))))\n\n;; ============================================================\n;; Eglot - Built-in LSP client (Emacs 29+)\n;; ============================================================\n(require 'eglot)\n\n;; Don't log every event (improves performance)\n(setq eglot-events-buffer-size 0)\n\n;; Shutdown server when last managed buffer is killed\n(setq eglot-autoshutdown t)\n\n;; ============================================================\n;; Tree-sitter Configuration\n;; ============================================================\n;; Tree-sitter provides accurate syntax highlighting via grammar libraries.\n;; Install grammars with: M-x treesit-install-language-grammar\n;;\n;; Grammar sources for common languages:\n(setq treesit-language-source-alist\n      '((python \"https://github.com/tree-sitter/tree-sitter-python\")\n        (go \"https://github.com/tree-sitter/tree-sitter-go\")\n        (gomod \"https://github.com/camdencheek/tree-sitter-go-mod\")\n        (yaml \"https://github.com/ikatyang/tree-sitter-yaml\")\n        ;; C/C++\n        (c \"https://github.com/tree-sitter/tree-sitter-c\")\n        (cpp \"https://github.com/tree-sitter/tree-sitter-cpp\")\n        ;; JavaScript/TypeScript\n        (javascript \"https://github.com/tree-sitter/tree-sitter-javascript\")\n        (typescript \"https://github.com/tree-sitter/tree-sitter-typescript\" \"master\" \"typescript/src\")\n        (tsx \"https://github.com/tree-sitter/tree-sitter-typescript\" \"master\" \"tsx/src\")\n        ;; JVM languages\n        (java \"https://github.com/tree-sitter/tree-sitter-java\")\n        (kotlin \"https://github.com/fwcd/tree-sitter-kotlin\")\n        (groovy \"https://github.com/murtaza64/tree-sitter-groovy\")))\n\n;; Helper function to check if tree-sitter grammar is actually usable\n(defun my/treesit-available-p (lang)\n  \"Check if tree-sitter grammar for LANG is actually usable.\nUses treesit-ready-p which verifies the grammar can be loaded.\"\n  (and (fboundp 'treesit-ready-p)\n       (treesit-ready-p lang t)))  ; t = quiet, don't signal error\n\n;; ============================================================\n;; Python Configuration\n;; ============================================================\n;; Uses python-ts-mode if grammar available, otherwise python-mode\n;; LSP servers (install one): pip install python-lsp-server\n;;                        or: pip install basedpyright\n;;                        or: pip install ruff\n\n;; Use tree-sitter mode if grammar is available\n(when (my/treesit-available-p 'python)\n  (add-to-list 'major-mode-remap-alist '(python-mode . python-ts-mode)))\n\n(add-hook 'python-mode-hook 'eglot-ensure)\n(add-hook 'python-ts-mode-hook 'eglot-ensure)\n\n;; Python indentation\n(setq python-indent-offset 4)\n\n;; ============================================================\n;; Go Configuration\n;; ============================================================\n;; Requires: go install golang.org/x/tools/gopls@latest\n\n;; Help project.el find Go project roots (look for go.mod)\n(defun project-find-go-module (dir)\n  \"Find Go module root for DIR by locating go.mod.\"\n  (when-let ((root (locate-dominating-file dir \"go.mod\")))\n    (cons 'go-module root)))\n\n(cl-defmethod project-root ((project (head go-module)))\n  \"Return root directory of Go PROJECT.\"\n  (cdr project))\n\n;; Add Go module detection to project-find-functions\n(add-hook 'project-find-functions #'project-find-go-module)\n\n;; Use tree-sitter mode if grammar is available, otherwise use go-mode\n(if (my/treesit-available-p 'go)\n    (progn\n      (add-to-list 'auto-mode-alist '(\"\\\\.go\\\\'\" . go-ts-mode))\n      (when (my/treesit-available-p 'gomod)\n        (add-to-list 'auto-mode-alist '(\"go\\\\.mod\\\\'\" . go-mod-ts-mode)))\n      (add-hook 'go-ts-mode-hook\n                (lambda ()\n                  (eglot-ensure)\n                  (setq-local indent-tabs-mode t)\n                  (setq-local tab-width 4)\n                  (add-hook 'before-save-hook\n                            (lambda ()\n                              (when (derived-mode-p 'go-ts-mode)\n                                (eglot-format-buffer)))\n                            nil t))))\n  ;; Fallback to go-mode package\n  (use-package go-mode\n    :hook ((go-mode . eglot-ensure)\n           (go-mode . (lambda ()\n                        (setq-local indent-tabs-mode t)\n                        (setq-local tab-width 4)))\n           (go-mode . (lambda ()\n                        (add-hook 'before-save-hook\n                                  (lambda ()\n                                    (when (derived-mode-p 'go-mode)\n                                      (eglot-format-buffer)))\n                                  nil t))))))\n\n;; Gopls configuration\n(setq-default eglot-workspace-configuration\n              '(:gopls (:staticcheck t :usePlaceholders t)))\n\n;; ============================================================\n;; C/C++ Configuration\n;; ============================================================\n;; Uses c-ts-mode and c++-ts-mode if grammars available (built-in Emacs 29+)\n;; LSP: clangd (usually comes with Xcode or LLVM)\n;;   Install: xcode-select --install (macOS)\n;;        or: brew install llvm\n\n;; Use tree-sitter modes if grammars are available\n(when (my/treesit-available-p 'c)\n  (add-to-list 'major-mode-remap-alist '(c-mode . c-ts-mode)))\n\n(when (my/treesit-available-p 'cpp)\n  (add-to-list 'major-mode-remap-alist '(c++-mode . c++-ts-mode))\n  (add-to-list 'auto-mode-alist '(\"\\\\.cpp\\\\'\" . c++-ts-mode))\n  (add-to-list 'auto-mode-alist '(\"\\\\.hpp\\\\'\" . c++-ts-mode))\n  (add-to-list 'auto-mode-alist '(\"\\\\.cc\\\\'\" . c++-ts-mode))\n  (add-to-list 'auto-mode-alist '(\"\\\\.hh\\\\'\" . c++-ts-mode)))\n\n;; Enable Eglot for C/C++ (clangd)\n(add-hook 'c-mode-hook 'eglot-ensure)\n(add-hook 'c-ts-mode-hook 'eglot-ensure)\n(add-hook 'c++-mode-hook 'eglot-ensure)\n(add-hook 'c++-ts-mode-hook 'eglot-ensure)\n\n;; ============================================================\n;; JavaScript / Node.js Configuration\n;; ============================================================\n;; Uses js-ts-mode if grammar available (built-in Emacs 29+)\n;; Requires: npm install -g typescript-language-server typescript\n;; (typescript-language-server also handles JavaScript)\n\n;; Use tree-sitter mode if grammar is available\n(when (my/treesit-available-p 'javascript)\n  (add-to-list 'major-mode-remap-alist '(javascript-mode . js-ts-mode))\n  (add-to-list 'auto-mode-alist '(\"\\\\.js\\\\'\" . js-ts-mode))\n  (add-to-list 'auto-mode-alist '(\"\\\\.mjs\\\\'\" . js-ts-mode))\n  (add-to-list 'auto-mode-alist '(\"\\\\.cjs\\\\'\" . js-ts-mode)))\n\n(add-hook 'js-mode-hook 'eglot-ensure)\n(add-hook 'js-ts-mode-hook 'eglot-ensure)\n\n;; JavaScript indentation\n(setq js-indent-level 2)\n\n;; ============================================================\n;; TypeScript Configuration\n;; ============================================================\n;; Uses typescript-ts-mode if grammar available, otherwise typescript-mode\n;; Requires: npm install -g typescript-language-server typescript\n\n;; TypeScript indentation\n(setq typescript-ts-mode-indent-offset 2)\n\n;; Use tree-sitter mode if grammar available, otherwise typescript-mode package\n(if (my/treesit-available-p 'typescript)\n    (progn\n      (add-to-list 'auto-mode-alist '(\"\\\\.ts\\\\'\" . typescript-ts-mode))\n      (add-hook 'typescript-ts-mode-hook 'eglot-ensure))\n  ;; Fallback to typescript-mode package\n  (use-package typescript-mode\n    :mode \"\\\\.ts\\\\'\"\n    :hook (typescript-mode . eglot-ensure)\n    :custom\n    (typescript-indent-level 2)))\n\n;; TSX - tree-sitter mode if available, otherwise web-mode as fallback\n(if (my/treesit-available-p 'tsx)\n    (progn\n      (add-to-list 'auto-mode-alist '(\"\\\\.tsx\\\\'\" . tsx-ts-mode))\n      (add-hook 'tsx-ts-mode-hook 'eglot-ensure))\n  ;; Fallback to web-mode for TSX\n  (use-package web-mode\n    :mode \"\\\\.tsx\\\\'\"\n    :hook (web-mode . eglot-ensure)\n    :custom\n    (web-mode-markup-indent-offset 2)\n    (web-mode-code-indent-offset 2)))\n\n;; ============================================================\n;; YAML Configuration\n;; ============================================================\n;; Optional LSP: npm install -g yaml-language-server\n\n;; Use tree-sitter mode if grammar available, otherwise yaml-mode\n(if (my/treesit-available-p 'yaml)\n    (progn\n      (add-to-list 'auto-mode-alist '(\"\\\\.ya?ml\\\\'\" . yaml-ts-mode))\n      (add-to-list 'auto-mode-alist '(\"\\\\.eyaml\\\\'\" . yaml-ts-mode))\n      (add-hook 'yaml-ts-mode-hook\n                (lambda ()\n                  (setq-local indent-tabs-mode nil)\n                  (setq-local tab-width 2)\n                  (when (executable-find \"yaml-language-server\")\n                    (eglot-ensure)))))\n  ;; Fallback to yaml-mode package\n  (use-package yaml-mode\n    :mode ((\"\\\\.ya?ml\\\\'\" . yaml-mode)\n           (\"\\\\.eyaml\\\\'\" . yaml-mode))\n    :hook ((yaml-mode . (lambda ()\n                          (setq-local indent-tabs-mode nil)\n                          (setq-local tab-width 2)\n                          (when (executable-find \"yaml-language-server\")\n                            (eglot-ensure)))))))\n\n;; ============================================================\n;; Java Configuration\n;; ============================================================\n;; Uses java-ts-mode if grammar available (built-in Emacs 29+)\n;; Requires: Eclipse JDTLS for LSP\n;;   macOS: brew install jdtls\n;;   or download from: https://download.eclipse.org/jdtls/\n;;\n;; Note: JDTLS needs a workspace directory for each project\n\n;; Use tree-sitter mode if grammar is available\n(when (my/treesit-available-p 'java)\n  (add-to-list 'major-mode-remap-alist '(java-mode . java-ts-mode)))\n\n;; Configure Eglot for Java (JDTLS)\n(with-eval-after-load 'eglot\n  (add-to-list 'eglot-server-programs\n               '((java-mode java-ts-mode) . (\"jdtls\"))))\n\n(add-hook 'java-mode-hook 'eglot-ensure)\n(add-hook 'java-ts-mode-hook 'eglot-ensure)\n\n;; Java indentation\n(add-hook 'java-mode-hook\n          (lambda ()\n            (setq-local c-basic-offset 4)\n            (setq-local tab-width 4)\n            (setq-local indent-tabs-mode nil)))\n(add-hook 'java-ts-mode-hook\n          (lambda ()\n            (setq-local c-basic-offset 4)\n            (setq-local tab-width 4)\n            (setq-local indent-tabs-mode nil)))\n\n;; ============================================================\n;; Kotlin Configuration\n;; ============================================================\n;; Uses kotlin-mode package (no built-in kotlin-ts-mode in Emacs yet)\n;; Tree-sitter grammar available at: https://github.com/fwcd/tree-sitter-kotlin\n;; Requires: kotlin-language-server for LSP\n;;   Install: brew install kotlin-language-server\n;;        or: https://github.com/fwcd/kotlin-language-server\n\n;; Configure Eglot for Kotlin\n(with-eval-after-load 'eglot\n  (add-to-list 'eglot-server-programs\n               '(kotlin-mode . (\"kotlin-language-server\"))))\n\n;; Use kotlin-mode package\n(use-package kotlin-mode\n  :ensure t\n  :mode ((\"\\\\.kt\\\\'\" . kotlin-mode)\n         (\"\\\\.kts\\\\'\" . kotlin-mode))\n  :hook ((kotlin-mode . eglot-ensure)\n         (kotlin-mode . (lambda ()\n                          (setq-local tab-width 4)\n                          (setq-local indent-tabs-mode nil)))))\n\n;; ============================================================\n;; Gradle / Groovy Configuration\n;; ============================================================\n;; Uses groovy-mode package (no built-in groovy-ts-mode in Emacs yet)\n;; Tree-sitter grammar available at: https://github.com/murtaza64/tree-sitter-groovy\n;;\n;; Gradle build files come in two flavors:\n;; - .gradle files: Groovy DSL (use groovy-mode)\n;; - .gradle.kts files: Kotlin DSL (use kotlin-mode)\n;;\n;; Optional LSP: gradle-language-server (experimental)\n;;   Install: npm install -g gradle-language-server\n\n;; Groovy mode for .gradle and .groovy files\n(use-package groovy-mode\n  :ensure t\n  :mode ((\"\\\\.gradle\\\\'\" . groovy-mode)\n         (\"\\\\.groovy\\\\'\" . groovy-mode))\n  :config\n  (setq groovy-indent-offset 4))\n\n;; For .gradle.kts files, use Kotlin mode (already configured above)\n;; The \"\\\\.kts\\\\'\" pattern in kotlin configuration handles build.gradle.kts\n\n;; ============================================================\n;; Markdown Configuration\n;; ============================================================\n;; Optional: brew install pandoc (for preview/export)\n\n(use-package markdown-mode\n  :mode ((\"README\\\\.md\\\\'\" . gfm-mode)\n         (\"\\\\.md\\\\'\" . markdown-mode)\n         (\"\\\\.markdown\\\\'\" . markdown-mode))\n  :config\n  ;; Use pandoc for markdown processing if available\n  (when (executable-find \"pandoc\")\n    (setq markdown-command\n          (if (executable-find \"mermaid-filter\")\n              \"pandoc --filter mermaid-filter\"\n            \"pandoc\")))\n  ;; Open live preview window on the right side\n  (defun my/markdown-live-preview-window-right (file)\n    \"Open markdown live preview in a window on the right side.\"\n    (eww-open-file file)\n    (let ((buf (if (bound-and-true-p eww-auto-rename-buffer)\n                   (cl-loop for b in (buffer-list)\n                            when (string-match-p \"eww\\\\*\\\\'\" (buffer-name b))\n                            return b)\n                 (get-buffer \"*eww*\"))))\n      (pop-to-buffer buf '((display-buffer-in-direction)\n                           (direction . right)\n                           (window-width . 0.5)))\n      buf))\n  (setq markdown-live-preview-window-function #'my/markdown-live-preview-window-right)\n  :custom\n  (markdown-enable-math t)\n  (markdown-fontify-code-blocks-natively t)\n  ;; Delete exported HTML files after live preview\n  (markdown-live-preview-delete-export 'delete-on-export))\n\n;; grip-mode - GitHub-flavored Markdown preview\n;; Uses go-grip for local rendering (no GitHub API needed)\n;; Requires: go install github.com/chrishrb/go-grip@latest\n(use-package grip-mode\n  :ensure t\n  :after markdown-mode\n  :bind (:map markdown-mode-command-map\n         (\"g\" . grip-mode))\n  :custom\n  (grip-command 'go-grip)           ; Use go-grip (no GitHub API)\n  (grip-preview-use-webkit nil))    ; Use external browser\n\n;; ============================================================\n;; Terminal Emulators\n;; ============================================================\n;; vterm - Full-featured terminal emulator (requires libvterm)\n;; Requires: brew install libvterm\n(use-package vterm\n  :ensure t\n  :demand t  ; Load eagerly so it's available for claude-code\n  :custom\n  ;; Large scrollback buffer for Claude Code history (default is 1000)\n  (vterm-max-scrollback 100000)\n  :config\n  ;; Disable modes that interfere with terminal input\n  (defun my/vterm-mode-setup ()\n    \"Setup vterm buffer for proper terminal input.\"\n    (setq-local global-hl-line-mode nil)\n    (setq-local line-spacing nil)\n    ;; Disable modes that intercept keyboard input\n    (smartparens-mode -1)\n    (company-mode -1)\n    (yas-minor-mode -1)\n    ;; Ensure vterm handles all input\n    (setq-local scroll-margin 0)\n    ;; Fix border overflow and alignment (UI rendering issues)\n    (when (fboundp 'set-window-fringes)\n      (set-window-fringes (selected-window) 0 0))  ; Remove fringes (GUI only)\n    (setq-local truncate-lines t)  ; Let vterm/Claude Code handle wrapping\n    (when (bound-and-true-p display-line-numbers-mode)\n      (display-line-numbers-mode -1)))  ; Disable line numbers\n  (add-hook 'vterm-mode-hook #'my/vterm-mode-setup)\n\n  ;; Prevent vterm windows from getting too narrow (for Claude Code display)\n  (defvar my/vterm-min-width 80\n    \"Minimum width for vterm windows.\")\n\n  (defun my/vterm-enforce-min-width ()\n    \"Enlarge vterm window if it's too narrow.\"\n    (when (and (eq major-mode 'vterm-mode)\n               (< (window-width) my/vterm-min-width)\n               (window-resizable nil (- my/vterm-min-width (window-width)) t))\n      (enlarge-window-horizontally (- my/vterm-min-width (window-width)))))\n\n  (add-hook 'window-configuration-change-hook #'my/vterm-enforce-min-width)\n\n  ;; Mouse wheel scrolling - enters copy mode to scroll through full history\n  (defun my/vterm-scroll-up ()\n    \"Scroll up in vterm, entering copy mode to access full scrollback.\"\n    (interactive)\n    (unless vterm-copy-mode\n      (vterm-copy-mode 1))\n    (scroll-down-command 3))\n  (defun my/vterm-scroll-down ()\n    \"Scroll down in vterm. Exit copy mode when reaching the bottom.\"\n    (interactive)\n    (if vterm-copy-mode\n        (progn\n          (scroll-up-command 3)\n          ;; Exit copy mode if we're at the bottom (end of buffer visible)\n          (when (pos-visible-in-window-p (point-max))\n            (vterm-copy-mode -1)))\n      (scroll-up-command 3)))\n  (define-key vterm-mode-map (kbd \"<mouse-4>\") #'my/vterm-scroll-up)\n  (define-key vterm-mode-map (kbd \"<mouse-5>\") #'my/vterm-scroll-down)\n  (define-key vterm-mode-map (kbd \"<wheel-up>\") #'my/vterm-scroll-up)\n  (define-key vterm-mode-map (kbd \"<wheel-down>\") #'my/vterm-scroll-down)\n  ;; Keybindings to send Escape to terminal (for Claude Code cancel)\n  (define-key vterm-mode-map (kbd \"C-c C-e\") #'vterm-send-escape)\n  (define-key vterm-mode-map (kbd \"C-c <escape>\") #'vterm-send-escape)\n\n  ;; Copy mode with mouse support\n  ;; Click to enter copy mode and set mark, drag to select, release to copy\n  (defun my/vterm-mouse-select-start (event)\n    \"Start mouse selection in vterm - enters copy mode and sets mark.\"\n    (interactive \"e\")\n    (unless vterm-copy-mode\n      (vterm-copy-mode 1))\n    (mouse-set-point event)\n    (push-mark (point) t t))\n\n  (defun my/vterm-mouse-select-end (event)\n    \"End mouse selection in vterm - copies region to clipboard.\"\n    (interactive \"e\")\n    (when vterm-copy-mode\n      (mouse-set-point event)\n      (when (use-region-p)\n        (kill-ring-save (region-beginning) (region-end))\n        (message \"Copied to clipboard\"))))\n\n  ;; Mouse drag selection that copies to kill-ring\n  (defun my/vterm-mouse-drag-copy (start-event)\n    \"Select region with mouse drag and copy to kill-ring.\"\n    (interactive \"e\")\n    (unless vterm-copy-mode\n      (vterm-copy-mode 1))\n    (mouse-drag-region start-event)\n    (when (use-region-p)\n      (kill-ring-save (region-beginning) (region-end))\n      (message \"Copied to clipboard\")))\n\n  ;; Mouse bindings for copy mode - DISABLED for testing\n  ;; (define-key vterm-mode-map (kbd \"<down-mouse-1>\") #'my/vterm-mouse-drag-copy)\n\n  ;; Paste from kill-ring into vterm\n  (define-key vterm-mode-map (kbd \"C-y\") #'vterm-yank)\n  (define-key vterm-mode-map (kbd \"M-y\") #'vterm-yank-pop)\n\n  ;; Copy mode keybindings\n  ;; C-c C-t: enter copy mode (default vterm binding)\n  ;; Select with mouse or keyboard, then:\n  (define-key vterm-copy-mode-map (kbd \"M-w\") #'vterm-copy-mode-done)  ; Copy and exit\n  (define-key vterm-copy-mode-map (kbd \"M-c\") #'vterm-copy-mode-done)  ; Cmd+c (mac-command = meta)\n  (define-key vterm-copy-mode-map (kbd \"C-c C-c\") #'vterm-copy-mode-done)\n  (define-key vterm-copy-mode-map (kbd \"q\") #'vterm-copy-mode)  ; Exit without copying\n  (define-key vterm-copy-mode-map (kbd \"<return>\") #'vterm-copy-mode-done))\n\n;; eat - Emulate A Terminal (pure elisp, no external dependencies)\n(use-package eat\n  :commands eat)\n\n;; ============================================================\n;; Claude Code Integration\n;; ============================================================\n;; Requires: brew install --cask claude-code (already installed)\n;;           brew install libvterm (already installed)\n\n;; transient - Required dependency for claude-code.el (menu system)\n(use-package transient\n  :ensure t)\n\n;; inheritenv - Required dependency for claude-code.el (environment handling)\n(use-package inheritenv\n  :vc (:url \"https://github.com/purcell/inheritenv\" :rev :newest))\n\n(use-package claude-code\n  :vc (:url \"https://github.com/stevemolitor/claude-code.el\" :rev :newest)\n  :demand t  ; Load immediately, don't defer\n  :after vterm  ; Ensure vterm is loaded first\n  :init\n  ;; Set these BEFORE package loads (defcustom defaults are read at load time)\n  (setq claude-code-terminal-backend 'vterm)   ; Use vterm for best TUI experience\n  (setq claude-code-program \"claude\")       ; CLI program name\n  (require 'vterm)  ; Ensure vterm is available\n  :config\n  (claude-code-mode)  ; Enable global minor mode for IDE integration\n  ;; Set up keybindings explicitly (more reliable than :bind-keymap with :vc)\n  (global-set-key (kbd \"C-c c\") claude-code-command-map))\n\n(custom-set-variables\n ;; custom-set-variables was added by Custom.\n ;; If you edit it by hand, you could mess it up, so be careful.\n ;; Your init file should contain only one such instance.\n ;; If there is more than one, they won't work right.\n '(company-show-quick-access t nil nil \"Customized with use-package company\")\n '(package-selected-packages nil))\n(custom-set-faces\n ;; custom-set-faces was added by Custom.\n ;; If you edit it by hand, you could mess it up, so be careful.\n ;; Your init file should contain only one such instance.\n ;; If there is more than one, they won't work right.\n )\n\n;;; init.el ends here\n","structuredPatch":[{"oldStart":219,"oldLines":10,"newStart":219,"newLines":9,"lines":["      (format \"\\033]0;%s\\007\" (my/get-frame-title)))))"," "," ;; Update terminal title on relevant events","+;; Use idle timer instead of buffer-list-update-hook (which fires on every buffer access)"," (unless (display-graphic-p)","-  (add-hook 'buffer-list-update-hook #'my/set-terminal-title)","-  (add-hook 'window-configuration-change-hook #'my/set-terminal-title)","-  ;; Set initial title","+  (run-with-idle-timer 1 t #'my/set-terminal-title)","   (add-hook 'emacs-startup-hook #'my/set-terminal-title))"," "," (defconst demo-packages"]}],"userModified":false,"replaceAll":false},"sourceToolAssistantUUID":"0e10e472-e29a-40e8-961b-0e79d8941c39"}
{"parentUuid":"e0ac74cc-6c12-4e2b-9263-26b68dbcb551","isSidechain":false,"userType":"external","cwd":"/Users/naokisega/src/github.com/nsega/.emacs.d","sessionId":"3662272f-90eb-4f6d-acc3-1b561237eac1","version":"2.1.49","gitBranch":"feature/update-gitignore","slug":"clever-shimmying-tiger","message":{"model":"claude-sonnet-4-6","id":"msg_01CebFFoAuTnh5GqH7CFD3PJ","type":"message","role":"assistant","content":[{"type":"text","text":"Similarly, the `frame-title-format` with `(:eval ...)` on line 211 also calls `project-current` on every GUI redraw. A cache helps there too:"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":854,"cache_read_input_tokens":52702,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":854},"output_tokens":1,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYMpZhETrD8CWNyLx4pGn","type":"assistant","uuid":"a345f4a9-5170-43af-ad11-a51b1d3ceca9","timestamp":"2026-02-21T20:09:51.129Z"}
{"parentUuid":"a345f4a9-5170-43af-ad11-a51b1d3ceca9","isSidechain":false,"userType":"external","cwd":"/Users/naokisega/src/github.com/nsega/.emacs.d","sessionId":"3662272f-90eb-4f6d-acc3-1b561237eac1","version":"2.1.49","gitBranch":"feature/update-gitignore","slug":"clever-shimmying-tiger","message":{"model":"claude-sonnet-4-6","id":"msg_01CebFFoAuTnh5GqH7CFD3PJ","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_019WDG8J7fvabTsF47dJeZwS","name":"Edit","input":{"replace_all":false,"file_path":"/Users/naokisega/src/github.com/nsega/.emacs.d/init.el","old_string":";; GUI Emacs: Set frame title\n(setq frame-title-format '(:eval (my/get-frame-title)))","new_string":";; GUI Emacs: Set frame title via idle timer to avoid calling project-current on every redraw\n(defvar my/frame-title-cached \"\"\n  \"Cached frame title string, updated by idle timer.\")\n\n(defun my/update-frame-title-cache ()\n  \"Update cached frame title and apply it.\"\n  (setq my/frame-title-cached (my/get-frame-title))\n  (modify-frame-parameters nil `((title . ,my/frame-title-cached))))\n\n(setq frame-title-format '(:eval my/frame-title-cached))\n(run-with-idle-timer 1 t #'my/update-frame-title-cache)"},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":854,"cache_read_input_tokens":52702,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":854},"output_tokens":1,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYMpZhETrD8CWNyLx4pGn","type":"assistant","uuid":"b4edf650-9be5-4546-a6c4-8d90b3561588","timestamp":"2026-02-21T20:09:54.362Z"}
{"parentUuid":"b4edf650-9be5-4546-a6c4-8d90b3561588","isSidechain":false,"userType":"external","cwd":"/Users/naokisega/src/github.com/nsega/.emacs.d","sessionId":"3662272f-90eb-4f6d-acc3-1b561237eac1","version":"2.1.49","gitBranch":"feature/update-gitignore","slug":"clever-shimmying-tiger","type":"progress","data":{"type":"hook_progress","hookEvent":"PostToolUse","hookName":"PostToolUse:Edit","command":"callback"},"parentToolUseID":"toolu_019WDG8J7fvabTsF47dJeZwS","toolUseID":"toolu_019WDG8J7fvabTsF47dJeZwS","timestamp":"2026-02-21T20:09:58.789Z","uuid":"63efef0e-9ba8-492d-835b-740152d0d223"}
{"parentUuid":"b4edf650-9be5-4546-a6c4-8d90b3561588","isSidechain":false,"userType":"external","cwd":"/Users/naokisega/src/github.com/nsega/.emacs.d","sessionId":"3662272f-90eb-4f6d-acc3-1b561237eac1","version":"2.1.49","gitBranch":"feature/update-gitignore","slug":"clever-shimmying-tiger","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_019WDG8J7fvabTsF47dJeZwS","type":"tool_result","content":"The file /Users/naokisega/src/github.com/nsega/.emacs.d/init.el has been updated successfully."}]},"uuid":"b73c2ceb-1861-42d4-894f-cccd567bb8d7","timestamp":"2026-02-21T20:09:58.788Z","toolUseResult":{"filePath":"/Users/naokisega/src/github.com/nsega/.emacs.d/init.el","oldString":";; GUI Emacs: Set frame title\n(setq frame-title-format '(:eval (my/get-frame-title)))","newString":";; GUI Emacs: Set frame title via idle timer to avoid calling project-current on every redraw\n(defvar my/frame-title-cached \"\"\n  \"Cached frame title string, updated by idle timer.\")\n\n(defun my/update-frame-title-cache ()\n  \"Update cached frame title and apply it.\"\n  (setq my/frame-title-cached (my/get-frame-title))\n  (modify-frame-parameters nil `((title . ,my/frame-title-cached))))\n\n(setq frame-title-format '(:eval my/frame-title-cached))\n(run-with-idle-timer 1 t #'my/update-frame-title-cache)","originalFile":";;; init.el --- Modern Emacs Configuration -*- lexical-binding: t; -*-\n\n;; Author: Naoki Sega\n;; Maintainer: Naoki Sega\n;; URL: https://github.com/nsega/.emacs.d\n;; Keywords: convenience\n\n;;; Commentary:\n\n;; Modern Emacs configuration using use-package for declarative package management.\n;; Migrated from traditional setup to use modern best practices for Emacs 30+.\n;;\n;; Key Features:\n;; - Vertico ecosystem for lightweight, fast completion (replaces Helm)\n;; - Eglot LSP for intelligent code navigation (Python, Go, TypeScript)\n;; - Tree-sitter modes for Python, Go, YAML (accurate syntax highlighting)\n;; - Company-mode for auto-completion\n;; - Modern advice-add instead of deprecated defadvice\n;; - Single, well-organized init.el (no separate custom/*.el files)\n;; - early-init.el for faster startup and no UI flickering\n;; - no-littering for clean .emacs.d directory\n;;\n;; Package Management:\n;; - Uses use-package for all package configuration\n;; - Lazy loading where appropriate for fast startup\n;; - Self-documenting package declarations\n;;\n;; Completion Framework:\n;; - vertico: Vertical completion UI\n;; - consult: Enhanced completing-read commands\n;; - marginalia: Rich annotations in minibuffer\n;; - embark: Contextual actions on completion candidates\n;; - orderless: Flexible matching style\n;;\n;; Code Intelligence:\n;; - Eglot: Built-in LSP client (Emacs 29+)\n;; - Company: Auto-completion framework\n;; - dumb-jump: Fallback navigation for non-LSP files\n;;\n;; For more information, see: https://github.com/nsega/.emacs.d\n\n;;; Code:\n\n;; ============================================================\n;; Package Management\n;; ============================================================\n(require 'package)\n(add-to-list 'package-archives\n             '(\"melpa\" . \"https://melpa.org/packages/\") t)\n(package-initialize)\n\n;; ============================================================\n;; Bootstrap use-package\n;; ============================================================\n(unless (package-installed-p 'use-package)\n  (package-refresh-contents)\n  (package-install 'use-package))\n\n(eval-when-compile (require 'use-package))\n(setq use-package-always-ensure t)\n(setq use-package-compute-statistics t)  ; For performance monitoring via M-x use-package-report\n\n;; ============================================================\n;; Directory Organization - no-littering\n;; ============================================================\n;; Keep .emacs.d clean by redirecting package files to var/ and etc/\n(use-package no-littering\n  :demand t  ; Load early to affect all subsequent packages\n  :config\n  ;; Put auto-save files in var directory\n  (setq auto-save-file-name-transforms\n        `((\".*\" ,(no-littering-expand-var-file-name \"auto-save/\") t)))\n  ;; Put native-comp cache in var directory (only if native-comp is available)\n  (when (and (fboundp 'startup-redirect-eln-cache)\n             (boundp 'native-comp-eln-load-path))\n    (startup-redirect-eln-cache\n     (convert-standard-filename\n      (expand-file-name \"var/eln-cache/\" user-emacs-directory)))))\n\n;; Pre-configure claude-code to use vterm (must be set before package loads)\n(setq claude-code-terminal-backend 'vterm)\n\n;; ============================================================\n;; Basic Settings\n;; ============================================================\n;; NOTE: gc-cons-threshold is set in early-init.el for faster startup\n;; and automatically reset after Emacs finishes loading\n(setq inhibit-startup-message t)\n\n;; Suppress byte-compile warnings from packages\n(setq byte-compile-warnings '(not obsolete))\n(setq warning-suppress-log-types '((comp) (bytecomp)))\n(setq native-comp-async-report-warnings-errors 'silent)\n\n;; PATH setup is handled by exec-path-from-shell (see below)\n;; This ensures Emacs inherits PATH from your shell\n(setq exec-path (cons \"/opt/homebrew/bin\" exec-path))\n(setq exec-path (cons \"/usr/local/bin\" exec-path))\n\n(defalias 'yes-or-no-p 'y-or-n-p)\n\n;; ============================================================\n;; macOS Clipboard Integration\n;; ============================================================\n;; Sync kill ring with macOS system clipboard via pbcopy/pbpaste\n(when (eq system-type 'darwin)\n  (setq interprogram-cut-function\n        (lambda (text &optional _)\n          (let ((process-connection-type nil))\n            (let ((proc (start-process \"pbcopy\" nil \"pbcopy\")))\n              (process-send-string proc text)\n              (process-send-eof proc)))))\n  (setq interprogram-paste-function\n        (lambda ()\n          (let ((clipboard (shell-command-to-string \"pbpaste\")))\n            (unless (string= clipboard (car kill-ring))\n              clipboard)))))\n\n;; ============================================================\n;; macOS Native Scrolling\n;; ============================================================\n;; Enable pixel-precise scrolling for smooth trackpad experience\n;; Makes Emacs feel like a native macOS application (Emacs 29+)\n(when (fboundp 'pixel-scroll-precision-mode)\n  (pixel-scroll-precision-mode 1))\n\n;; ============================================================\n;; Mouse Support (Terminal and GUI)\n;; ============================================================\n;; Enable mouse in terminal emulators (Ghostty, iTerm2, etc.)\n;; Safe to enable always - only activates in terminal frames\n(xterm-mouse-mode 1)\n\n;; Auto-copy mouse selection to clipboard (like typical terminal behavior)\n(setq mouse-drag-copy-region t)\n\n;; Mouse wheel scrolling (works in both terminal and GUI)\n(global-set-key [mouse-4] 'scroll-down-command)\n(global-set-key [mouse-5] 'scroll-up-command)\n\n;; Drag mode-line to resize windows vertically (click and drag the status bar)\n;; Drag vertical border to resize windows horizontally\n(global-set-key [mode-line mouse-1] 'mouse-drag-mode-line)\n(global-set-key [vertical-line mouse-1] 'mouse-drag-vertical-line)\n\n;; Scroll through buffer history with mouse wheel on mode-line\n(global-set-key [mode-line mouse-4] 'previous-buffer)\n(global-set-key [mode-line mouse-5] 'next-buffer)\n(global-set-key [mode-line wheel-up] 'previous-buffer)\n(global-set-key [mode-line wheel-down] 'next-buffer)\n\n;; Or use Ctrl+wheel anywhere to switch buffers\n(global-set-key [C-mouse-4] 'previous-buffer)\n(global-set-key [C-mouse-5] 'next-buffer)\n(global-set-key [C-wheel-up] 'previous-buffer)\n(global-set-key [C-wheel-down] 'next-buffer)\n\n;; Window layout undo/redo\n;; C-c <left> to undo, C-c <right> to redo window configuration\n;; Note: May conflict with org-mode/markdown-mode C-c bindings in those buffers\n(winner-mode 1)\n\n;; Allow resizing side windows (help, compilation, etc.) via mouse drag\n(setq window-resize-pixelwise t)  ; Precise pixel resizing for smoother drag\n(setq window-sides-slots '(1 1 1 1))  ; Allow side windows on all sides\n;; Don't preserve side window sizes - allow free resizing\n(setq window-sides-vertical nil)  ; Side windows on left/right don't span full height\n(add-to-list 'window-persistent-parameters '(window-side . writable))\n\n;; GUI-only: window dividers for easier grabbing\n(when (display-graphic-p)\n  (setq window-divider-default-places t)\n  (setq window-divider-default-right-width 6)  ; Wider for easier grabbing\n  (setq window-divider-default-bottom-width 6)\n  (window-divider-mode 1)\n  (global-set-key [right-divider mouse-1] 'mouse-drag-vertical-line)\n  (global-set-key [bottom-divider mouse-1] 'mouse-drag-mode-line))\n\n;; ============================================================\n;; Terminal Vertical Split Display Fix\n;; ============================================================\n;; Prevent text overflow between vertically split windows in terminal\n(unless (display-graphic-p)\n  ;; Force line truncation in split windows to prevent overflow\n  (setq truncate-partial-width-windows t)\n  (setq-default truncate-lines t)  ; Truncate all lines in terminal\n  ;; Use ASCII vertical bar for window border (Unicode can cause width issues)\n  (set-display-table-slot standard-display-table 'vertical-border ?|)\n  ;; Ensure no margins\n  (setq-default left-margin-width 0)\n  (setq-default right-margin-width 0)\n  ;; Disable word wrap that can cause overflow\n  (setq-default word-wrap nil)\n  (global-visual-line-mode -1))\n\n;; ============================================================\n;; Frame/Terminal Title - Show project name in window list\n;; ============================================================\n;; This makes it easy to identify Emacs instances in Ghostty/terminal window lists\n\n(defun my/get-frame-title ()\n  \"Return a title string showing project and current buffer.\"\n  (let ((project (project-current)))\n    (format \"emacs [%s] - %s\"\n            (if project\n                (project-name project)\n              (abbreviate-file-name default-directory))\n            (buffer-name))))\n\n;; GUI Emacs: Set frame title\n(setq frame-title-format '(:eval (my/get-frame-title)))\n\n;; Terminal Emacs: Send escape sequence to set terminal window title\n(defun my/set-terminal-title ()\n  \"Set terminal window title to project name or directory.\"\n  (when (and (not (display-graphic-p))\n             (getenv \"TERM\"))\n    (send-string-to-terminal\n     (format \"\\033]0;%s\\007\" (my/get-frame-title)))))\n\n;; Update terminal title on relevant events\n;; Use idle timer instead of buffer-list-update-hook (which fires on every buffer access)\n(unless (display-graphic-p)\n  (run-with-idle-timer 1 t #'my/set-terminal-title)\n  (add-hook 'emacs-startup-hook #'my/set-terminal-title))\n\n(defconst demo-packages\n  '(anzu\n    company\n    ;; duplicate-thing  ; removed - no longer available on MELPA\n    ;; Completion framework - Vertico ecosystem (replaces Helm)\n    vertico\n    orderless\n    marginalia\n    consult\n    embark\n    embark-consult\n    migemo\n    ;; function-args\n    clean-aindent-mode\n    comment-dwim-2\n    dtrt-indent\n    ws-butler\n    iedit\n    yasnippet\n    smartparens\n    volatile-highlights\n    undo-tree\n    zygospore\n    ;; Modern language modes\n    exec-path-from-shell  ; Better PATH handling on macOS\n    go-mode               ; Go support (fallback if tree-sitter grammar unavailable)\n    yaml-mode             ; YAML support (fallback if tree-sitter grammar unavailable)\n    typescript-mode       ; TypeScript support (fallback if tree-sitter grammar unavailable)\n    web-mode              ; TSX/JSX support (fallback if tree-sitter grammar unavailable)\n    markdown-mode         ; Markdown support\n    ;; JVM languages\n    kotlin-mode           ; Kotlin support (fallback if tree-sitter grammar unavailable)\n    groovy-mode           ; Groovy/Gradle support\n    ;; Navigation fallback\n    dumb-jump             ; Jump to definition without tags/LSP\n    ;; Terminal\n    vterm                 ; Terminal emulator for Claude Code\n    eat                   ; Emulate A Terminal (another terminal emulator)\n    ))\n\n(defun install-packages ()\n  \"Install all required packages.\"\n  (interactive)\n  (unless package-archive-contents\n    (package-refresh-contents))\n  (dolist (package demo-packages)\n    (unless (package-installed-p package)\n      (package-install package))))\n\n(install-packages)\n\n;; ============================================================\n;; Navigation Enhancements\n;; ============================================================\n;; M-. (xref-find-definitions) and M-? (xref-find-references) are\n;; built-in bindings. Eglot automatically registers as xref backend.\n\n;; ============================================================\n;; dumb-jump - Fallback navigation when no tags/LSP available\n;; ============================================================\n(use-package dumb-jump\n  :config\n  (add-hook 'xref-backend-functions #'dumb-jump-xref-activate)\n  :custom\n  (dumb-jump-prefer-searcher 'rg)  ; Use ripgrep if available\n  (dumb-jump-force-searcher nil))\n\n;; ============================================================\n;; Completion - Company Mode\n;; ============================================================\n(use-package company\n  :hook (after-init . global-company-mode)\n  :config\n  (delete 'company-semantic company-backends)\n  ;; Add tab completion for C/C++ modes\n  (add-hook 'c-mode-hook\n            (lambda ()\n              (local-set-key (kbd \"<tab>\") 'company-complete)))\n  (add-hook 'c++-mode-hook\n            (lambda ()\n              (local-set-key (kbd \"<tab>\") 'company-complete)))\n  :custom\n  (company-idle-delay 0.1)\n  (company-minimum-prefix-length 2)\n  (company-show-numbers t))\n\n(use-package company-c-headers\n  :after company\n  :config\n  (add-to-list 'company-backends 'company-c-headers))\n\n;; hs-minor-mode for folding source code\n(add-hook 'c-mode-common-hook 'hs-minor-mode)\n\n;; Available C style:\n;; “gnu”: The default style for GNU projects\n;; “k&r”: What Kernighan and Ritchie, the authors of C used in their book\n;; “bsd”: What BSD developers use, aka “Allman style” after Eric Allman.\n;; “whitesmith”: Popularized by the examples that came with Whitesmiths C, an early commercial C compiler.\n;; “stroustrup”: What Stroustrup, the author of C++ used in his book\n;; “ellemtel”: Popular C++ coding standards as defined by “Programming in C++, Rules and Recommendations,” Erik Nyquist and Mats Henricson, Ellemtel\n;; “linux”: What the Linux developers use for kernel development\n;; “python”: What Python developers use for extension modules\n;; “java”: The default style for java-mode (see below)\n;; “user”: When you want to define your own style\n(setq\n c-default-style \"linux\" ;; set style to \"linux\"\n )\n\n(global-set-key (kbd \"RET\") 'newline-and-indent)  ; automatically indent when press RET\n\n;; activate whitespace-mode to view all whitespace characters\n(global-set-key (kbd \"C-c w\") 'whitespace-mode)\n\n;; show unncessary whitespace that can mess up your diff\n(add-hook 'prog-mode-hook (lambda () (interactive) (setq show-trailing-whitespace 1)))\n\n;; use space to indent by default\n(setq-default indent-tabs-mode nil)\n\n;; set appearance of a tab that is represented by 4 spaces\n(setq-default tab-width 4)\n\n;; Compilation\n(global-set-key (kbd \"<f5>\") (lambda ()\n                               (interactive)\n                               (setq-local compilation-read-command nil)\n                               (call-interactively 'compile)))\n\n;; setup GDB\n(setq\n ;; use gdb-many-windows by default\n gdb-many-windows t\n\n ;; Non-nil means display source file containing the main routine at startup\n gdb-show-main t\n )\n\n;; ============================================================\n;; Completion Framework - Vertico Ecosystem\n;; ============================================================\n\n;; vertico - Vertical completion UI\n(use-package vertico\n  :init\n  (vertico-mode)\n  :custom\n  (vertico-cycle t)\n  :bind (:map vertico-map\n              (\"C-j\" . vertico-next)\n              (\"C-k\" . vertico-previous)))\n\n;; orderless - Flexible completion matching\n(use-package orderless\n  :custom\n  (completion-styles '(orderless basic))\n  (completion-category-defaults nil)\n  (completion-category-overrides '((file (styles partial-completion)))))\n\n;; marginalia - Rich annotations in minibuffer\n(use-package marginalia\n  :init\n  (marginalia-mode))\n\n;; consult - Consulting completing-read\n(use-package consult\n  :bind ((\"C-x b\" . consult-buffer)\n         (\"M-g i\" . consult-imenu)\n         (\"M-s l\" . consult-line)\n         (\"M-s g\" . consult-grep)\n         (\"M-s r\" . consult-ripgrep)\n         (\"M-y\" . consult-yank-pop)\n         ;; Alternative bindings for terminal (M-s often conflicts)\n         (\"C-c s l\" . consult-line)       ; Alternative to M-s l\n         (\"C-c s g\" . consult-grep)       ; Alternative to M-s g\n         (\"C-c s r\" . consult-ripgrep)    ; Alternative to M-s r\n         (\"C-c s i\" . consult-imenu)      ; Alternative to M-g i\n         :map minibuffer-local-map\n         (\"M-p\" . consult-history)))\n\n;; embark - Contextual actions\n(use-package embark\n  :bind ((\"C-.\" . embark-act)\n         (\"C-c e b\" . embark-bindings)))  ; C-h B conflicts with C-h as backspace\n\n;; embark-consult - Integration between embark and consult\n(use-package embark-consult\n  :after (embark consult))\n\n;; ============================================================\n;; Editing Enhancements (use-package)\n;; ============================================================\n\n;; Package: clean-aindent-mode - Clean auto-indent and backspace behavior\n(use-package clean-aindent-mode\n  :hook (prog-mode . clean-aindent-mode))\n\n;; Package: dtrt-indent - Detect indent style automatically\n(use-package dtrt-indent\n  :config\n  (dtrt-indent-mode 1)\n  (setq dtrt-indent-verbosity 0))\n\n;; Package: ws-butler - Trim whitespace only on edited lines\n(use-package ws-butler\n  :hook ((prog-mode . ws-butler-mode)\n         (text-mode . ws-butler-mode)\n         (fundamental-mode . ws-butler-mode)))\n\n;; Package: yasnippet - Template system\n(use-package yasnippet\n  :config\n  (yas-global-mode 1)\n  ;; Don't activate in terminal mode\n  (add-hook 'term-mode-hook (lambda() (setq yas-dont-activate t)))\n  :custom\n  (yas-verbosity 1)\n  (yas-wrap-around-region t)\n  (yas-prompt-functions '(yas/ido-prompt yas/completing-prompt)))\n\n;; Package: smartparens - Parenthesis management\n(use-package smartparens\n  :config\n  (require 'smartparens-config)\n  (setq sp-base-key-bindings 'paredit)\n  (setq sp-autoskip-closing-pair 'always)\n  (setq sp-hybrid-kill-entire-symbol nil)\n  (sp-use-paredit-bindings)\n  (show-smartparens-global-mode +1)\n  (smartparens-global-mode 1))\n\n;; ============================================================\n;; Project Management - Built-in project.el (Emacs 28+)\n;; ============================================================\n;; project.el is built-in and integrates natively with Eglot, xref, and Consult.\n;; Default prefix: C-x p\n\n(setq project-switch-commands\n      '((project-find-file \"Find file\" ?f)\n        (project-find-regexp \"Find regexp\" ?g)\n        (project-find-dir \"Find directory\" ?d)\n        (project-eshell \"Eshell\" ?e)))\n\n;; ============================================================\n;; Dired Configuration\n;; ============================================================\n;; Auto-revert Dired buffer when switching to it (picks up filesystem changes)\n(setq dired-auto-revert-buffer t)\n\n;; Package: zygospore - Reversible C-x 1 (delete-other-windows)\n(use-package zygospore\n  :bind ((\"C-x 1\" . zygospore-toggle-delete-other-windows)))\n\n;; Package: anzu - Show match count in mode-line while searching\n(use-package anzu\n  :config\n  (global-anzu-mode)\n  :bind ((\"M-%\" . anzu-query-replace)\n         (\"C-M-%\" . anzu-query-replace-regexp)))\n\n;; Package: volatile-highlights - Highlight changes from yanking, undo, etc.\n(use-package volatile-highlights\n  :config\n  (volatile-highlights-mode t))\n\n;; Package: undo-tree - Visualize undo history as a tree\n(use-package undo-tree\n  :config\n  (global-undo-tree-mode))\n\n;; Package: comment-dwim-2 - Smarter comment/uncomment\n(use-package comment-dwim-2\n  :bind ((\"M-;\" . comment-dwim-2)))\n\n;; Package: iedit - Edit multiple occurrences simultaneously\n(use-package iedit\n  :custom\n  (iedit-toggle-key-default nil)\n  :bind ((\"C-;\" . iedit-mode)))\n\n;; ============================================================\n;; Custom Editing Behaviors (modernized from setup-editing.el)\n;; ============================================================\n\n;; Enhanced kill/copy/yank behaviors using modern advice-add\n\n;; 1. Copy line when no region is active (M-w)\n(defun my/slick-copy-advice (orig-fun &rest args)\n  \"Copy line when no region is active.\"\n  (interactive\n   (if mark-active\n       (list (region-beginning) (region-end))\n     (message \"Copied line\")\n     (list (line-beginning-position)\n           (line-beginning-position 2))))\n  (apply orig-fun args))\n\n(advice-add 'kill-ring-save :around #'my/slick-copy-advice)\n\n;; 2. Cut line when no region is active (C-w)\n(defun my/slick-cut-advice (orig-fun &rest args)\n  \"Cut line when no region is active.\"\n  (interactive\n   (if mark-active\n       (list (region-beginning) (region-end))\n     (list (line-beginning-position)\n           (line-beginning-position 2))))\n  (apply orig-fun args))\n\n(advice-add 'kill-region :around #'my/slick-cut-advice)\n\n;; 3. Clean whitespace before killing line (C-k)\n(defun my/kill-line-whitespace-advice (&rest _args)\n  \"Clean whitespace before killing line in programming modes.\"\n  (when (member major-mode\n                '(emacs-lisp-mode scheme-mode lisp-mode\n                  c-mode c++-mode objc-mode\n                  latex-mode plain-tex-mode))\n    (when (and (eolp) (not (bolp)))\n      (forward-char 1)\n      (just-one-space 0)\n      (backward-char 1))))\n\n(advice-add 'kill-line :before #'my/kill-line-whitespace-advice)\n\n;; 4. Auto-indent yanked text in programming modes (C-y, M-y)\n(defvar yank-indent-modes\n  '(LaTeX-mode TeX-mode)\n  \"Modes in which to indent regions that are yanked (or yank-popped).\nOnly modes that don't derive from `prog-mode' should be listed here.\")\n\n(defvar yank-indent-blacklisted-modes\n  '(python-mode slim-mode haml-mode)\n  \"Modes for which auto-indenting is suppressed.\")\n\n(defvar yank-advised-indent-threshold 1000\n  \"Threshold (# chars) over which indentation does not automatically occur.\")\n\n(defun yank-advised-indent-function (beg end)\n  \"Do indentation, as long as the region isn't too large.\"\n  (if (<= (- end beg) yank-advised-indent-threshold)\n      (indent-region beg end nil)))\n\n(defun my/yank-indent-advice (orig-fun &rest args)\n  \"Auto-indent yanked text in programming modes.\"\n  (let ((result (apply orig-fun args)))\n    (when (and (not (car args))\n               (not (member major-mode yank-indent-blacklisted-modes))\n               (or (derived-mode-p 'prog-mode)\n                   (member major-mode yank-indent-modes)))\n      (let ((transient-mark-mode nil))\n        (yank-advised-indent-function (region-beginning) (region-end))))\n    result))\n\n(advice-add 'yank :around #'my/yank-indent-advice)\n(advice-add 'yank-pop :around #'my/yank-indent-advice)\n\n;; Other useful editing functions from setup-editing.el\n\n;; Smart move to beginning of line (C-a)\n(defun prelude-move-beginning-of-line (arg)\n  \"Move point back to indentation of beginning of line.\n\nMove point to the first non-whitespace character on this line.\nIf point is already there, move to the beginning of the line.\nEffectively toggle between the first non-whitespace character and\nthe beginning of the line.\n\nIf ARG is not nil or 1, move forward ARG - 1 lines first. If\npoint reaches the beginning or end of the buffer, stop there.\"\n  (interactive \"^p\")\n  (setq arg (or arg 1))\n\n  ;; Move lines first\n  (when (/= arg 1)\n    (let ((line-move-visual nil))\n      (forward-line (1- arg))))\n\n  (let ((orig-point (point)))\n    (back-to-indentation)\n    (when (= orig-point (point))\n      (move-beginning-of-line 1))))\n\n(global-set-key (kbd \"C-a\") 'prelude-move-beginning-of-line)\n\n;; Smart open line (M-o)\n(defun prelude-smart-open-line (arg)\n  \"Insert an empty line after the current line.\nPosition the cursor at its beginning, according to the current mode.\nWith a prefix ARG open line above the current line.\"\n  (interactive \"P\")\n  (if arg\n      (prelude-smart-open-line-above)\n    (progn\n      (move-end-of-line nil)\n      (newline-and-indent))))\n\n(defun prelude-smart-open-line-above ()\n  \"Insert an empty line above the current line.\nPosition the cursor at it's beginning, according to the current mode.\"\n  (interactive)\n  (move-beginning-of-line nil)\n  (newline-and-indent)\n  (forward-line -1)\n  (indent-according-to-mode))\n\n(global-set-key (kbd \"M-o\") 'prelude-smart-open-line)\n\n;; Indent buffer or region (C-c i)\n(defun indent-buffer ()\n  \"Indent the currently visited buffer.\"\n  (interactive)\n  (indent-region (point-min) (point-max)))\n\n(defcustom prelude-indent-sensitive-modes\n  '(coffee-mode python-mode slim-mode haml-mode yaml-mode)\n  \"Modes for which auto-indenting is suppressed.\"\n  :type 'list)\n\n(defun indent-region-or-buffer ()\n  \"Indent a region if selected, otherwise the whole buffer.\"\n  (interactive)\n  (unless (member major-mode prelude-indent-sensitive-modes)\n    (save-excursion\n      (if (region-active-p)\n          (progn\n            (indent-region (region-beginning) (region-end))\n            (message \"Indented selected region.\"))\n        (progn\n          (indent-buffer)\n          (message \"Indented buffer.\")))\n      (whitespace-cleanup))))\n\n(global-set-key (kbd \"C-c i\") 'indent-region-or-buffer)\n\n;; ============================================================\n;; Speedbar\n(setq speedbar-show-unknown-files t)\n\n;; NOTE: Removed old macOS Mavericks workaround that forced home directory\n;; This was causing issues with `emacs .` not respecting current directory\n;; If you need to start in home directory, use: emacs ~\n;;\n;; Old code (commented out):\n;; ;;　Changing the home directory as the initial dir(for Mervelicks)\n;; (setq default-directory \"~/\")\n;; (setq command-line-default-directory \"~/\")\n;;\n;; ;; Changing the default directory as of '〜/' for Mavericks\n;; (defun cd-to-homedir-all-buffers ()\n;;   \"Change every current directory of all buffers to the home directory.\"\n;;   (mapc\n;;    (lambda (buf) (set-buffer buf) (cd (expand-file-name \"~\"))) (buffer-list)))\n;; (add-hook 'after-init-hook 'cd-to-homedir-all-buffers)\n\n;; Japanese Configuration (UTF-8)\n(set-language-environment \"Japanese\")\n(set-terminal-coding-system 'utf-8)\n(set-keyboard-coding-system 'utf-8)\n(set-buffer-file-coding-system 'utf-8)\n(setq buffer-file-coding-system 'utf-8)\n(setq slime-net-coding-system 'utf-8-unix)\n\n;; key bindings\n(windmove-default-keybindings 'meta)\n(setq mac-option-modifier 'meta)\n(setq mac-command-modifier 'meta)\n(global-set-key [kp-delete] 'delete-char) ;; sets fn-delete to be right-delete\n\n;; Enabling Font Lock mode (e.g. bold display)\n(global-font-lock-mode t)\n\n;; Enabling automcatically the temporarily mode\n(setq-default transient-mark-mode t)\n\n;; Changing C-x C-u to be worked nothing (undo / typo countermeasure)\n(global-unset-key \"\\C-x\\C-u\")\n\n;; High lighting the pared parenethesis\n(show-paren-mode 1)\n\n(setq next-line-add-newlines nil)\n\n;; C-x l/ run goto-line\n(define-key ctl-x-map \"l\" 'goto-line)\n;; alternate of '¥', entering '/'\n(define-key global-map [?¥] [?\\\\])\n\n(display-time)\n\n;; display the column number\n(column-number-mode 1)\n\n;; NOTE: menu-bar, tool-bar, and scroll-bars are disabled in early-init.el\n;; to prevent UI flickering during startup\n\n;; Make C-h act as backspace\n(define-key global-map \"\\C-h\" 'delete-backward-char)\n(define-key global-map \"\\C-x\\C-h\" 'help-command)\n;; Also bind in key-translation-map to override help-map\n(define-key key-translation-map (kbd \"C-h\") (kbd \"<DEL>\"))\n;; Override in isearch-mode\n(define-key isearch-mode-map \"\\C-h\" 'isearch-delete-char)\n(define-key global-map \"\\C-o\" 'dabbrev-expand)\n(setq dabbrev-case-fold-search nil)\n\n;;; Don't create the backup file\n(setq backup-inhibited t)\n\n;;; Deleting the save files when it was exited.\n(setq delete-auto-save-files t)\n\n;; Configuration for Japanese and English\n;; http://www.alles.or.jp/~torutk/oojava/meadow/Meadow210Install.html\n(defun my/dabbrev-expand-japanese-advice (orig-fun &rest args)\n  \"Modify `dabbrev-abbrev-char-regexp' dynamically for Japanese words.\"\n  (if (bobp)\n      (apply orig-fun args)\n    (let ((dabbrev-abbrev-char-regexp\n           (let ((c (char-category-set (char-before))))\n             (cond\n              ((aref c ?a) \"[-_A-Za-z0-9]\") ; ASCII\n              ((aref c ?j) ; Japanese\n               (cond\n                ((aref c ?K) \"\\\\cK\") ; katakana\n                ((aref c ?A) \"\\\\cA\") ; 2byte alphanumeric\n                ((aref c ?H) \"\\\\cH\") ; hiragana\n                ((aref c ?C) \"\\\\cC\") ; kanji\n                (t \"\\\\cj\")))\n              ((aref c ?k) \"\\\\ck\") ; hankaku-kana\n              ((aref c ?r) \"\\\\cr\") ; Japanese roman ?\n              (t dabbrev-abbrev-char-regexp)))))\n      (apply orig-fun args))))\n\n(advice-add 'dabbrev-expand :around #'my/dabbrev-expand-japanese-advice)\n\n;; Configuration Backspace\n(delete-selection-mode 1)\n\n;; The local variables list in .emacs と言われるのを抑止\n(add-to-list 'ignored-local-variables 'syntax)\n\n;; http://0xcc.net/blog/archives/000041.html\n(set-default-coding-systems 'utf-8)\n\n;; ============================================================\n;; Theme and Colors\n;; ============================================================\n;; modus-vivendi - High contrast dark theme (built-in since Emacs 28)\n;; Part of the modus-themes package by Protesilaos Stavrou\n(load-theme 'modus-vivendi t)\n\n;; Font configuration\n(when window-system\n  (set-frame-font \"Monaco-12\" nil t)\n  (set-frame-parameter nil 'alpha 100))\n\n(setq default-frame-alist\n  (append\n   '((font . \"Monaco-12\") ;; Default Fontset\n  (width . 140) (height . 50) ;; Window Size\n  )\n  default-frame-alist))\n\n;; ============================================================\n;; migemo - Japanese incremental search with Romanization\n;; ============================================================\n;; Requires: brew install cmigemo\n(use-package migemo\n  :if (executable-find \"cmigemo\")\n  :custom\n  (migemo-command \"cmigemo\")\n  (migemo-options '(\"-q\" \"--emacs\"))\n  (migemo-dictionary \"/opt/homebrew/share/migemo/utf-8/migemo-dict\")\n  (migemo-user-dictionary nil)\n  (migemo-regex-dictionary nil)\n  (migemo-coding-system 'utf-8-unix)\n  :config\n  (migemo-init))\n\n;; ============================================================\n;; exec-path-from-shell - Better PATH handling on macOS\n;; ============================================================\n(use-package exec-path-from-shell\n  :if (memq window-system '(mac ns x))\n  :config\n  (exec-path-from-shell-initialize)\n  ;; Copy additional environment variables for development tools\n  (exec-path-from-shell-copy-envs '(\"GOPATH\" \"GOROOT\" \"PYENV_ROOT\" \"VOLTA_HOME\"))\n  ;; Add Volta bin directory to exec-path for npm global packages\n  (when-let ((volta-home (getenv \"VOLTA_HOME\")))\n    (add-to-list 'exec-path (expand-file-name \"bin\" volta-home)))\n  ;; Add pyenv shims to exec-path for pip global packages\n  (let ((pyenv-root (or (getenv \"PYENV_ROOT\")\n                        (expand-file-name \"~/.pyenv\"))))\n    (when (file-directory-p pyenv-root)\n      (add-to-list 'exec-path (expand-file-name \"shims\" pyenv-root)))))\n\n;; ============================================================\n;; Eglot - Built-in LSP client (Emacs 29+)\n;; ============================================================\n(require 'eglot)\n\n;; Don't log every event (improves performance)\n(setq eglot-events-buffer-size 0)\n\n;; Shutdown server when last managed buffer is killed\n(setq eglot-autoshutdown t)\n\n;; ============================================================\n;; Tree-sitter Configuration\n;; ============================================================\n;; Tree-sitter provides accurate syntax highlighting via grammar libraries.\n;; Install grammars with: M-x treesit-install-language-grammar\n;;\n;; Grammar sources for common languages:\n(setq treesit-language-source-alist\n      '((python \"https://github.com/tree-sitter/tree-sitter-python\")\n        (go \"https://github.com/tree-sitter/tree-sitter-go\")\n        (gomod \"https://github.com/camdencheek/tree-sitter-go-mod\")\n        (yaml \"https://github.com/ikatyang/tree-sitter-yaml\")\n        ;; C/C++\n        (c \"https://github.com/tree-sitter/tree-sitter-c\")\n        (cpp \"https://github.com/tree-sitter/tree-sitter-cpp\")\n        ;; JavaScript/TypeScript\n        (javascript \"https://github.com/tree-sitter/tree-sitter-javascript\")\n        (typescript \"https://github.com/tree-sitter/tree-sitter-typescript\" \"master\" \"typescript/src\")\n        (tsx \"https://github.com/tree-sitter/tree-sitter-typescript\" \"master\" \"tsx/src\")\n        ;; JVM languages\n        (java \"https://github.com/tree-sitter/tree-sitter-java\")\n        (kotlin \"https://github.com/fwcd/tree-sitter-kotlin\")\n        (groovy \"https://github.com/murtaza64/tree-sitter-groovy\")))\n\n;; Helper function to check if tree-sitter grammar is actually usable\n(defun my/treesit-available-p (lang)\n  \"Check if tree-sitter grammar for LANG is actually usable.\nUses treesit-ready-p which verifies the grammar can be loaded.\"\n  (and (fboundp 'treesit-ready-p)\n       (treesit-ready-p lang t)))  ; t = quiet, don't signal error\n\n;; ============================================================\n;; Python Configuration\n;; ============================================================\n;; Uses python-ts-mode if grammar available, otherwise python-mode\n;; LSP servers (install one): pip install python-lsp-server\n;;                        or: pip install basedpyright\n;;                        or: pip install ruff\n\n;; Use tree-sitter mode if grammar is available\n(when (my/treesit-available-p 'python)\n  (add-to-list 'major-mode-remap-alist '(python-mode . python-ts-mode)))\n\n(add-hook 'python-mode-hook 'eglot-ensure)\n(add-hook 'python-ts-mode-hook 'eglot-ensure)\n\n;; Python indentation\n(setq python-indent-offset 4)\n\n;; ============================================================\n;; Go Configuration\n;; ============================================================\n;; Requires: go install golang.org/x/tools/gopls@latest\n\n;; Help project.el find Go project roots (look for go.mod)\n(defun project-find-go-module (dir)\n  \"Find Go module root for DIR by locating go.mod.\"\n  (when-let ((root (locate-dominating-file dir \"go.mod\")))\n    (cons 'go-module root)))\n\n(cl-defmethod project-root ((project (head go-module)))\n  \"Return root directory of Go PROJECT.\"\n  (cdr project))\n\n;; Add Go module detection to project-find-functions\n(add-hook 'project-find-functions #'project-find-go-module)\n\n;; Use tree-sitter mode if grammar is available, otherwise use go-mode\n(if (my/treesit-available-p 'go)\n    (progn\n      (add-to-list 'auto-mode-alist '(\"\\\\.go\\\\'\" . go-ts-mode))\n      (when (my/treesit-available-p 'gomod)\n        (add-to-list 'auto-mode-alist '(\"go\\\\.mod\\\\'\" . go-mod-ts-mode)))\n      (add-hook 'go-ts-mode-hook\n                (lambda ()\n                  (eglot-ensure)\n                  (setq-local indent-tabs-mode t)\n                  (setq-local tab-width 4)\n                  (add-hook 'before-save-hook\n                            (lambda ()\n                              (when (derived-mode-p 'go-ts-mode)\n                                (eglot-format-buffer)))\n                            nil t))))\n  ;; Fallback to go-mode package\n  (use-package go-mode\n    :hook ((go-mode . eglot-ensure)\n           (go-mode . (lambda ()\n                        (setq-local indent-tabs-mode t)\n                        (setq-local tab-width 4)))\n           (go-mode . (lambda ()\n                        (add-hook 'before-save-hook\n                                  (lambda ()\n                                    (when (derived-mode-p 'go-mode)\n                                      (eglot-format-buffer)))\n                                  nil t))))))\n\n;; Gopls configuration\n(setq-default eglot-workspace-configuration\n              '(:gopls (:staticcheck t :usePlaceholders t)))\n\n;; ============================================================\n;; C/C++ Configuration\n;; ============================================================\n;; Uses c-ts-mode and c++-ts-mode if grammars available (built-in Emacs 29+)\n;; LSP: clangd (usually comes with Xcode or LLVM)\n;;   Install: xcode-select --install (macOS)\n;;        or: brew install llvm\n\n;; Use tree-sitter modes if grammars are available\n(when (my/treesit-available-p 'c)\n  (add-to-list 'major-mode-remap-alist '(c-mode . c-ts-mode)))\n\n(when (my/treesit-available-p 'cpp)\n  (add-to-list 'major-mode-remap-alist '(c++-mode . c++-ts-mode))\n  (add-to-list 'auto-mode-alist '(\"\\\\.cpp\\\\'\" . c++-ts-mode))\n  (add-to-list 'auto-mode-alist '(\"\\\\.hpp\\\\'\" . c++-ts-mode))\n  (add-to-list 'auto-mode-alist '(\"\\\\.cc\\\\'\" . c++-ts-mode))\n  (add-to-list 'auto-mode-alist '(\"\\\\.hh\\\\'\" . c++-ts-mode)))\n\n;; Enable Eglot for C/C++ (clangd)\n(add-hook 'c-mode-hook 'eglot-ensure)\n(add-hook 'c-ts-mode-hook 'eglot-ensure)\n(add-hook 'c++-mode-hook 'eglot-ensure)\n(add-hook 'c++-ts-mode-hook 'eglot-ensure)\n\n;; ============================================================\n;; JavaScript / Node.js Configuration\n;; ============================================================\n;; Uses js-ts-mode if grammar available (built-in Emacs 29+)\n;; Requires: npm install -g typescript-language-server typescript\n;; (typescript-language-server also handles JavaScript)\n\n;; Use tree-sitter mode if grammar is available\n(when (my/treesit-available-p 'javascript)\n  (add-to-list 'major-mode-remap-alist '(javascript-mode . js-ts-mode))\n  (add-to-list 'auto-mode-alist '(\"\\\\.js\\\\'\" . js-ts-mode))\n  (add-to-list 'auto-mode-alist '(\"\\\\.mjs\\\\'\" . js-ts-mode))\n  (add-to-list 'auto-mode-alist '(\"\\\\.cjs\\\\'\" . js-ts-mode)))\n\n(add-hook 'js-mode-hook 'eglot-ensure)\n(add-hook 'js-ts-mode-hook 'eglot-ensure)\n\n;; JavaScript indentation\n(setq js-indent-level 2)\n\n;; ============================================================\n;; TypeScript Configuration\n;; ============================================================\n;; Uses typescript-ts-mode if grammar available, otherwise typescript-mode\n;; Requires: npm install -g typescript-language-server typescript\n\n;; TypeScript indentation\n(setq typescript-ts-mode-indent-offset 2)\n\n;; Use tree-sitter mode if grammar available, otherwise typescript-mode package\n(if (my/treesit-available-p 'typescript)\n    (progn\n      (add-to-list 'auto-mode-alist '(\"\\\\.ts\\\\'\" . typescript-ts-mode))\n      (add-hook 'typescript-ts-mode-hook 'eglot-ensure))\n  ;; Fallback to typescript-mode package\n  (use-package typescript-mode\n    :mode \"\\\\.ts\\\\'\"\n    :hook (typescript-mode . eglot-ensure)\n    :custom\n    (typescript-indent-level 2)))\n\n;; TSX - tree-sitter mode if available, otherwise web-mode as fallback\n(if (my/treesit-available-p 'tsx)\n    (progn\n      (add-to-list 'auto-mode-alist '(\"\\\\.tsx\\\\'\" . tsx-ts-mode))\n      (add-hook 'tsx-ts-mode-hook 'eglot-ensure))\n  ;; Fallback to web-mode for TSX\n  (use-package web-mode\n    :mode \"\\\\.tsx\\\\'\"\n    :hook (web-mode . eglot-ensure)\n    :custom\n    (web-mode-markup-indent-offset 2)\n    (web-mode-code-indent-offset 2)))\n\n;; ============================================================\n;; YAML Configuration\n;; ============================================================\n;; Optional LSP: npm install -g yaml-language-server\n\n;; Use tree-sitter mode if grammar available, otherwise yaml-mode\n(if (my/treesit-available-p 'yaml)\n    (progn\n      (add-to-list 'auto-mode-alist '(\"\\\\.ya?ml\\\\'\" . yaml-ts-mode))\n      (add-to-list 'auto-mode-alist '(\"\\\\.eyaml\\\\'\" . yaml-ts-mode))\n      (add-hook 'yaml-ts-mode-hook\n                (lambda ()\n                  (setq-local indent-tabs-mode nil)\n                  (setq-local tab-width 2)\n                  (when (executable-find \"yaml-language-server\")\n                    (eglot-ensure)))))\n  ;; Fallback to yaml-mode package\n  (use-package yaml-mode\n    :mode ((\"\\\\.ya?ml\\\\'\" . yaml-mode)\n           (\"\\\\.eyaml\\\\'\" . yaml-mode))\n    :hook ((yaml-mode . (lambda ()\n                          (setq-local indent-tabs-mode nil)\n                          (setq-local tab-width 2)\n                          (when (executable-find \"yaml-language-server\")\n                            (eglot-ensure)))))))\n\n;; ============================================================\n;; Java Configuration\n;; ============================================================\n;; Uses java-ts-mode if grammar available (built-in Emacs 29+)\n;; Requires: Eclipse JDTLS for LSP\n;;   macOS: brew install jdtls\n;;   or download from: https://download.eclipse.org/jdtls/\n;;\n;; Note: JDTLS needs a workspace directory for each project\n\n;; Use tree-sitter mode if grammar is available\n(when (my/treesit-available-p 'java)\n  (add-to-list 'major-mode-remap-alist '(java-mode . java-ts-mode)))\n\n;; Configure Eglot for Java (JDTLS)\n(with-eval-after-load 'eglot\n  (add-to-list 'eglot-server-programs\n               '((java-mode java-ts-mode) . (\"jdtls\"))))\n\n(add-hook 'java-mode-hook 'eglot-ensure)\n(add-hook 'java-ts-mode-hook 'eglot-ensure)\n\n;; Java indentation\n(add-hook 'java-mode-hook\n          (lambda ()\n            (setq-local c-basic-offset 4)\n            (setq-local tab-width 4)\n            (setq-local indent-tabs-mode nil)))\n(add-hook 'java-ts-mode-hook\n          (lambda ()\n            (setq-local c-basic-offset 4)\n            (setq-local tab-width 4)\n            (setq-local indent-tabs-mode nil)))\n\n;; ============================================================\n;; Kotlin Configuration\n;; ============================================================\n;; Uses kotlin-mode package (no built-in kotlin-ts-mode in Emacs yet)\n;; Tree-sitter grammar available at: https://github.com/fwcd/tree-sitter-kotlin\n;; Requires: kotlin-language-server for LSP\n;;   Install: brew install kotlin-language-server\n;;        or: https://github.com/fwcd/kotlin-language-server\n\n;; Configure Eglot for Kotlin\n(with-eval-after-load 'eglot\n  (add-to-list 'eglot-server-programs\n               '(kotlin-mode . (\"kotlin-language-server\"))))\n\n;; Use kotlin-mode package\n(use-package kotlin-mode\n  :ensure t\n  :mode ((\"\\\\.kt\\\\'\" . kotlin-mode)\n         (\"\\\\.kts\\\\'\" . kotlin-mode))\n  :hook ((kotlin-mode . eglot-ensure)\n         (kotlin-mode . (lambda ()\n                          (setq-local tab-width 4)\n                          (setq-local indent-tabs-mode nil)))))\n\n;; ============================================================\n;; Gradle / Groovy Configuration\n;; ============================================================\n;; Uses groovy-mode package (no built-in groovy-ts-mode in Emacs yet)\n;; Tree-sitter grammar available at: https://github.com/murtaza64/tree-sitter-groovy\n;;\n;; Gradle build files come in two flavors:\n;; - .gradle files: Groovy DSL (use groovy-mode)\n;; - .gradle.kts files: Kotlin DSL (use kotlin-mode)\n;;\n;; Optional LSP: gradle-language-server (experimental)\n;;   Install: npm install -g gradle-language-server\n\n;; Groovy mode for .gradle and .groovy files\n(use-package groovy-mode\n  :ensure t\n  :mode ((\"\\\\.gradle\\\\'\" . groovy-mode)\n         (\"\\\\.groovy\\\\'\" . groovy-mode))\n  :config\n  (setq groovy-indent-offset 4))\n\n;; For .gradle.kts files, use Kotlin mode (already configured above)\n;; The \"\\\\.kts\\\\'\" pattern in kotlin configuration handles build.gradle.kts\n\n;; ============================================================\n;; Markdown Configuration\n;; ============================================================\n;; Optional: brew install pandoc (for preview/export)\n\n(use-package markdown-mode\n  :mode ((\"README\\\\.md\\\\'\" . gfm-mode)\n         (\"\\\\.md\\\\'\" . markdown-mode)\n         (\"\\\\.markdown\\\\'\" . markdown-mode))\n  :config\n  ;; Use pandoc for markdown processing if available\n  (when (executable-find \"pandoc\")\n    (setq markdown-command\n          (if (executable-find \"mermaid-filter\")\n              \"pandoc --filter mermaid-filter\"\n            \"pandoc\")))\n  ;; Open live preview window on the right side\n  (defun my/markdown-live-preview-window-right (file)\n    \"Open markdown live preview in a window on the right side.\"\n    (eww-open-file file)\n    (let ((buf (if (bound-and-true-p eww-auto-rename-buffer)\n                   (cl-loop for b in (buffer-list)\n                            when (string-match-p \"eww\\\\*\\\\'\" (buffer-name b))\n                            return b)\n                 (get-buffer \"*eww*\"))))\n      (pop-to-buffer buf '((display-buffer-in-direction)\n                           (direction . right)\n                           (window-width . 0.5)))\n      buf))\n  (setq markdown-live-preview-window-function #'my/markdown-live-preview-window-right)\n  :custom\n  (markdown-enable-math t)\n  (markdown-fontify-code-blocks-natively t)\n  ;; Delete exported HTML files after live preview\n  (markdown-live-preview-delete-export 'delete-on-export))\n\n;; grip-mode - GitHub-flavored Markdown preview\n;; Uses go-grip for local rendering (no GitHub API needed)\n;; Requires: go install github.com/chrishrb/go-grip@latest\n(use-package grip-mode\n  :ensure t\n  :after markdown-mode\n  :bind (:map markdown-mode-command-map\n         (\"g\" . grip-mode))\n  :custom\n  (grip-command 'go-grip)           ; Use go-grip (no GitHub API)\n  (grip-preview-use-webkit nil))    ; Use external browser\n\n;; ============================================================\n;; Terminal Emulators\n;; ============================================================\n;; vterm - Full-featured terminal emulator (requires libvterm)\n;; Requires: brew install libvterm\n(use-package vterm\n  :ensure t\n  :demand t  ; Load eagerly so it's available for claude-code\n  :custom\n  ;; Large scrollback buffer for Claude Code history (default is 1000)\n  (vterm-max-scrollback 100000)\n  :config\n  ;; Disable modes that interfere with terminal input\n  (defun my/vterm-mode-setup ()\n    \"Setup vterm buffer for proper terminal input.\"\n    (setq-local global-hl-line-mode nil)\n    (setq-local line-spacing nil)\n    ;; Disable modes that intercept keyboard input\n    (smartparens-mode -1)\n    (company-mode -1)\n    (yas-minor-mode -1)\n    ;; Ensure vterm handles all input\n    (setq-local scroll-margin 0)\n    ;; Fix border overflow and alignment (UI rendering issues)\n    (when (fboundp 'set-window-fringes)\n      (set-window-fringes (selected-window) 0 0))  ; Remove fringes (GUI only)\n    (setq-local truncate-lines t)  ; Let vterm/Claude Code handle wrapping\n    (when (bound-and-true-p display-line-numbers-mode)\n      (display-line-numbers-mode -1)))  ; Disable line numbers\n  (add-hook 'vterm-mode-hook #'my/vterm-mode-setup)\n\n  ;; Prevent vterm windows from getting too narrow (for Claude Code display)\n  (defvar my/vterm-min-width 80\n    \"Minimum width for vterm windows.\")\n\n  (defun my/vterm-enforce-min-width ()\n    \"Enlarge vterm window if it's too narrow.\"\n    (when (and (eq major-mode 'vterm-mode)\n               (< (window-width) my/vterm-min-width)\n               (window-resizable nil (- my/vterm-min-width (window-width)) t))\n      (enlarge-window-horizontally (- my/vterm-min-width (window-width)))))\n\n  (add-hook 'window-configuration-change-hook #'my/vterm-enforce-min-width)\n\n  ;; Mouse wheel scrolling - enters copy mode to scroll through full history\n  (defun my/vterm-scroll-up ()\n    \"Scroll up in vterm, entering copy mode to access full scrollback.\"\n    (interactive)\n    (unless vterm-copy-mode\n      (vterm-copy-mode 1))\n    (scroll-down-command 3))\n  (defun my/vterm-scroll-down ()\n    \"Scroll down in vterm. Exit copy mode when reaching the bottom.\"\n    (interactive)\n    (if vterm-copy-mode\n        (progn\n          (scroll-up-command 3)\n          ;; Exit copy mode if we're at the bottom (end of buffer visible)\n          (when (pos-visible-in-window-p (point-max))\n            (vterm-copy-mode -1)))\n      (scroll-up-command 3)))\n  (define-key vterm-mode-map (kbd \"<mouse-4>\") #'my/vterm-scroll-up)\n  (define-key vterm-mode-map (kbd \"<mouse-5>\") #'my/vterm-scroll-down)\n  (define-key vterm-mode-map (kbd \"<wheel-up>\") #'my/vterm-scroll-up)\n  (define-key vterm-mode-map (kbd \"<wheel-down>\") #'my/vterm-scroll-down)\n  ;; Keybindings to send Escape to terminal (for Claude Code cancel)\n  (define-key vterm-mode-map (kbd \"C-c C-e\") #'vterm-send-escape)\n  (define-key vterm-mode-map (kbd \"C-c <escape>\") #'vterm-send-escape)\n\n  ;; Copy mode with mouse support\n  ;; Click to enter copy mode and set mark, drag to select, release to copy\n  (defun my/vterm-mouse-select-start (event)\n    \"Start mouse selection in vterm - enters copy mode and sets mark.\"\n    (interactive \"e\")\n    (unless vterm-copy-mode\n      (vterm-copy-mode 1))\n    (mouse-set-point event)\n    (push-mark (point) t t))\n\n  (defun my/vterm-mouse-select-end (event)\n    \"End mouse selection in vterm - copies region to clipboard.\"\n    (interactive \"e\")\n    (when vterm-copy-mode\n      (mouse-set-point event)\n      (when (use-region-p)\n        (kill-ring-save (region-beginning) (region-end))\n        (message \"Copied to clipboard\"))))\n\n  ;; Mouse drag selection that copies to kill-ring\n  (defun my/vterm-mouse-drag-copy (start-event)\n    \"Select region with mouse drag and copy to kill-ring.\"\n    (interactive \"e\")\n    (unless vterm-copy-mode\n      (vterm-copy-mode 1))\n    (mouse-drag-region start-event)\n    (when (use-region-p)\n      (kill-ring-save (region-beginning) (region-end))\n      (message \"Copied to clipboard\")))\n\n  ;; Mouse bindings for copy mode - DISABLED for testing\n  ;; (define-key vterm-mode-map (kbd \"<down-mouse-1>\") #'my/vterm-mouse-drag-copy)\n\n  ;; Paste from kill-ring into vterm\n  (define-key vterm-mode-map (kbd \"C-y\") #'vterm-yank)\n  (define-key vterm-mode-map (kbd \"M-y\") #'vterm-yank-pop)\n\n  ;; Copy mode keybindings\n  ;; C-c C-t: enter copy mode (default vterm binding)\n  ;; Select with mouse or keyboard, then:\n  (define-key vterm-copy-mode-map (kbd \"M-w\") #'vterm-copy-mode-done)  ; Copy and exit\n  (define-key vterm-copy-mode-map (kbd \"M-c\") #'vterm-copy-mode-done)  ; Cmd+c (mac-command = meta)\n  (define-key vterm-copy-mode-map (kbd \"C-c C-c\") #'vterm-copy-mode-done)\n  (define-key vterm-copy-mode-map (kbd \"q\") #'vterm-copy-mode)  ; Exit without copying\n  (define-key vterm-copy-mode-map (kbd \"<return>\") #'vterm-copy-mode-done))\n\n;; eat - Emulate A Terminal (pure elisp, no external dependencies)\n(use-package eat\n  :commands eat)\n\n;; ============================================================\n;; Claude Code Integration\n;; ============================================================\n;; Requires: brew install --cask claude-code (already installed)\n;;           brew install libvterm (already installed)\n\n;; transient - Required dependency for claude-code.el (menu system)\n(use-package transient\n  :ensure t)\n\n;; inheritenv - Required dependency for claude-code.el (environment handling)\n(use-package inheritenv\n  :vc (:url \"https://github.com/purcell/inheritenv\" :rev :newest))\n\n(use-package claude-code\n  :vc (:url \"https://github.com/stevemolitor/claude-code.el\" :rev :newest)\n  :demand t  ; Load immediately, don't defer\n  :after vterm  ; Ensure vterm is loaded first\n  :init\n  ;; Set these BEFORE package loads (defcustom defaults are read at load time)\n  (setq claude-code-terminal-backend 'vterm)   ; Use vterm for best TUI experience\n  (setq claude-code-program \"claude\")       ; CLI program name\n  (require 'vterm)  ; Ensure vterm is available\n  :config\n  (claude-code-mode)  ; Enable global minor mode for IDE integration\n  ;; Set up keybindings explicitly (more reliable than :bind-keymap with :vc)\n  (global-set-key (kbd \"C-c c\") claude-code-command-map))\n\n(custom-set-variables\n ;; custom-set-variables was added by Custom.\n ;; If you edit it by hand, you could mess it up, so be careful.\n ;; Your init file should contain only one such instance.\n ;; If there is more than one, they won't work right.\n '(company-show-quick-access t nil nil \"Customized with use-package company\")\n '(package-selected-packages nil))\n(custom-set-faces\n ;; custom-set-faces was added by Custom.\n ;; If you edit it by hand, you could mess it up, so be careful.\n ;; Your init file should contain only one such instance.\n ;; If there is more than one, they won't work right.\n )\n\n;;; init.el ends here\n","structuredPatch":[{"oldStart":207,"oldLines":9,"newStart":207,"newLines":18,"lines":["               (abbreviate-file-name default-directory))","             (buffer-name))))"," ","-;; GUI Emacs: Set frame title","-(setq frame-title-format '(:eval (my/get-frame-title)))","+;; GUI Emacs: Set frame title via idle timer to avoid calling project-current on every redraw","+(defvar my/frame-title-cached \"\"","+  \"Cached frame title string, updated by idle timer.\")"," ","+(defun my/update-frame-title-cache ()","+  \"Update cached frame title and apply it.\"","+  (setq my/frame-title-cached (my/get-frame-title))","+  (modify-frame-parameters nil `((title . ,my/frame-title-cached))))","+","+(setq frame-title-format '(:eval my/frame-title-cached))","+(run-with-idle-timer 1 t #'my/update-frame-title-cache)","+"," ;; Terminal Emacs: Send escape sequence to set terminal window title"," (defun my/set-terminal-title ()","   \"Set terminal window title to project name or directory.\""]}],"userModified":false,"replaceAll":false},"sourceToolAssistantUUID":"b4edf650-9be5-4546-a6c4-8d90b3561588"}
{"parentUuid":"b73c2ceb-1861-42d4-894f-cccd567bb8d7","isSidechain":false,"userType":"external","cwd":"/Users/naokisega/src/github.com/nsega/.emacs.d","sessionId":"3662272f-90eb-4f6d-acc3-1b561237eac1","version":"2.1.49","gitBranch":"feature/update-gitignore","slug":"clever-shimmying-tiger","message":{"model":"claude-sonnet-4-6","id":"msg_01B7WKKJaBsTxPaWwS2eJ8bR","type":"message","role":"assistant","content":[{"type":"text","text":"Also worth addressing: `my/vterm-enforce-min-width` is on `window-configuration-change-hook`, which also fires frequently:"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":520,"cache_read_input_tokens":53556,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":520},"output_tokens":1,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYMpaRmpH8J9vHyANxKGi","type":"assistant","uuid":"649401bb-330f-4bc5-b8f1-2d2115b310a9","timestamp":"2026-02-21T20:10:01.919Z"}
{"parentUuid":"649401bb-330f-4bc5-b8f1-2d2115b310a9","isSidechain":false,"userType":"external","cwd":"/Users/naokisega/src/github.com/nsega/.emacs.d","sessionId":"3662272f-90eb-4f6d-acc3-1b561237eac1","version":"2.1.49","gitBranch":"feature/update-gitignore","slug":"clever-shimmying-tiger","message":{"model":"claude-sonnet-4-6","id":"msg_01B7WKKJaBsTxPaWwS2eJ8bR","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01C6Knir7ETtxBULFAyCJZNY","name":"Edit","input":{"replace_all":false,"file_path":"/Users/naokisega/src/github.com/nsega/.emacs.d/init.el","old_string":"  (add-hook 'window-configuration-change-hook #'my/vterm-enforce-min-width)","new_string":"  (add-hook 'window-size-change-functions (lambda (_frame) (my/vterm-enforce-min-width)))"},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":520,"cache_read_input_tokens":53556,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":520},"output_tokens":1,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYMpaRmpH8J9vHyANxKGi","type":"assistant","uuid":"fe0a1ee5-6384-4d7e-b8cd-9a53287b875f","timestamp":"2026-02-21T20:10:03.442Z"}
{"parentUuid":"fe0a1ee5-6384-4d7e-b8cd-9a53287b875f","isSidechain":false,"userType":"external","cwd":"/Users/naokisega/src/github.com/nsega/.emacs.d","sessionId":"3662272f-90eb-4f6d-acc3-1b561237eac1","version":"2.1.49","gitBranch":"feature/update-gitignore","slug":"clever-shimmying-tiger","type":"progress","data":{"type":"hook_progress","hookEvent":"PostToolUse","hookName":"PostToolUse:Edit","command":"callback"},"parentToolUseID":"toolu_01C6Knir7ETtxBULFAyCJZNY","toolUseID":"toolu_01C6Knir7ETtxBULFAyCJZNY","timestamp":"2026-02-21T20:10:06.490Z","uuid":"6389d23a-fcca-4ab3-b041-3aef3992fb00"}
{"parentUuid":"fe0a1ee5-6384-4d7e-b8cd-9a53287b875f","isSidechain":false,"userType":"external","cwd":"/Users/naokisega/src/github.com/nsega/.emacs.d","sessionId":"3662272f-90eb-4f6d-acc3-1b561237eac1","version":"2.1.49","gitBranch":"feature/update-gitignore","slug":"clever-shimmying-tiger","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01C6Knir7ETtxBULFAyCJZNY","type":"tool_result","content":"The file /Users/naokisega/src/github.com/nsega/.emacs.d/init.el has been updated successfully."}]},"uuid":"9cb5ddcd-f7e1-4854-a7e2-ab02d3647363","timestamp":"2026-02-21T20:10:06.488Z","toolUseResult":{"filePath":"/Users/naokisega/src/github.com/nsega/.emacs.d/init.el","oldString":"  (add-hook 'window-configuration-change-hook #'my/vterm-enforce-min-width)","newString":"  (add-hook 'window-size-change-functions (lambda (_frame) (my/vterm-enforce-min-width)))","originalFile":";;; init.el --- Modern Emacs Configuration -*- lexical-binding: t; -*-\n\n;; Author: Naoki Sega\n;; Maintainer: Naoki Sega\n;; URL: https://github.com/nsega/.emacs.d\n;; Keywords: convenience\n\n;;; Commentary:\n\n;; Modern Emacs configuration using use-package for declarative package management.\n;; Migrated from traditional setup to use modern best practices for Emacs 30+.\n;;\n;; Key Features:\n;; - Vertico ecosystem for lightweight, fast completion (replaces Helm)\n;; - Eglot LSP for intelligent code navigation (Python, Go, TypeScript)\n;; - Tree-sitter modes for Python, Go, YAML (accurate syntax highlighting)\n;; - Company-mode for auto-completion\n;; - Modern advice-add instead of deprecated defadvice\n;; - Single, well-organized init.el (no separate custom/*.el files)\n;; - early-init.el for faster startup and no UI flickering\n;; - no-littering for clean .emacs.d directory\n;;\n;; Package Management:\n;; - Uses use-package for all package configuration\n;; - Lazy loading where appropriate for fast startup\n;; - Self-documenting package declarations\n;;\n;; Completion Framework:\n;; - vertico: Vertical completion UI\n;; - consult: Enhanced completing-read commands\n;; - marginalia: Rich annotations in minibuffer\n;; - embark: Contextual actions on completion candidates\n;; - orderless: Flexible matching style\n;;\n;; Code Intelligence:\n;; - Eglot: Built-in LSP client (Emacs 29+)\n;; - Company: Auto-completion framework\n;; - dumb-jump: Fallback navigation for non-LSP files\n;;\n;; For more information, see: https://github.com/nsega/.emacs.d\n\n;;; Code:\n\n;; ============================================================\n;; Package Management\n;; ============================================================\n(require 'package)\n(add-to-list 'package-archives\n             '(\"melpa\" . \"https://melpa.org/packages/\") t)\n(package-initialize)\n\n;; ============================================================\n;; Bootstrap use-package\n;; ============================================================\n(unless (package-installed-p 'use-package)\n  (package-refresh-contents)\n  (package-install 'use-package))\n\n(eval-when-compile (require 'use-package))\n(setq use-package-always-ensure t)\n(setq use-package-compute-statistics t)  ; For performance monitoring via M-x use-package-report\n\n;; ============================================================\n;; Directory Organization - no-littering\n;; ============================================================\n;; Keep .emacs.d clean by redirecting package files to var/ and etc/\n(use-package no-littering\n  :demand t  ; Load early to affect all subsequent packages\n  :config\n  ;; Put auto-save files in var directory\n  (setq auto-save-file-name-transforms\n        `((\".*\" ,(no-littering-expand-var-file-name \"auto-save/\") t)))\n  ;; Put native-comp cache in var directory (only if native-comp is available)\n  (when (and (fboundp 'startup-redirect-eln-cache)\n             (boundp 'native-comp-eln-load-path))\n    (startup-redirect-eln-cache\n     (convert-standard-filename\n      (expand-file-name \"var/eln-cache/\" user-emacs-directory)))))\n\n;; Pre-configure claude-code to use vterm (must be set before package loads)\n(setq claude-code-terminal-backend 'vterm)\n\n;; ============================================================\n;; Basic Settings\n;; ============================================================\n;; NOTE: gc-cons-threshold is set in early-init.el for faster startup\n;; and automatically reset after Emacs finishes loading\n(setq inhibit-startup-message t)\n\n;; Suppress byte-compile warnings from packages\n(setq byte-compile-warnings '(not obsolete))\n(setq warning-suppress-log-types '((comp) (bytecomp)))\n(setq native-comp-async-report-warnings-errors 'silent)\n\n;; PATH setup is handled by exec-path-from-shell (see below)\n;; This ensures Emacs inherits PATH from your shell\n(setq exec-path (cons \"/opt/homebrew/bin\" exec-path))\n(setq exec-path (cons \"/usr/local/bin\" exec-path))\n\n(defalias 'yes-or-no-p 'y-or-n-p)\n\n;; ============================================================\n;; macOS Clipboard Integration\n;; ============================================================\n;; Sync kill ring with macOS system clipboard via pbcopy/pbpaste\n(when (eq system-type 'darwin)\n  (setq interprogram-cut-function\n        (lambda (text &optional _)\n          (let ((process-connection-type nil))\n            (let ((proc (start-process \"pbcopy\" nil \"pbcopy\")))\n              (process-send-string proc text)\n              (process-send-eof proc)))))\n  (setq interprogram-paste-function\n        (lambda ()\n          (let ((clipboard (shell-command-to-string \"pbpaste\")))\n            (unless (string= clipboard (car kill-ring))\n              clipboard)))))\n\n;; ============================================================\n;; macOS Native Scrolling\n;; ============================================================\n;; Enable pixel-precise scrolling for smooth trackpad experience\n;; Makes Emacs feel like a native macOS application (Emacs 29+)\n(when (fboundp 'pixel-scroll-precision-mode)\n  (pixel-scroll-precision-mode 1))\n\n;; ============================================================\n;; Mouse Support (Terminal and GUI)\n;; ============================================================\n;; Enable mouse in terminal emulators (Ghostty, iTerm2, etc.)\n;; Safe to enable always - only activates in terminal frames\n(xterm-mouse-mode 1)\n\n;; Auto-copy mouse selection to clipboard (like typical terminal behavior)\n(setq mouse-drag-copy-region t)\n\n;; Mouse wheel scrolling (works in both terminal and GUI)\n(global-set-key [mouse-4] 'scroll-down-command)\n(global-set-key [mouse-5] 'scroll-up-command)\n\n;; Drag mode-line to resize windows vertically (click and drag the status bar)\n;; Drag vertical border to resize windows horizontally\n(global-set-key [mode-line mouse-1] 'mouse-drag-mode-line)\n(global-set-key [vertical-line mouse-1] 'mouse-drag-vertical-line)\n\n;; Scroll through buffer history with mouse wheel on mode-line\n(global-set-key [mode-line mouse-4] 'previous-buffer)\n(global-set-key [mode-line mouse-5] 'next-buffer)\n(global-set-key [mode-line wheel-up] 'previous-buffer)\n(global-set-key [mode-line wheel-down] 'next-buffer)\n\n;; Or use Ctrl+wheel anywhere to switch buffers\n(global-set-key [C-mouse-4] 'previous-buffer)\n(global-set-key [C-mouse-5] 'next-buffer)\n(global-set-key [C-wheel-up] 'previous-buffer)\n(global-set-key [C-wheel-down] 'next-buffer)\n\n;; Window layout undo/redo\n;; C-c <left> to undo, C-c <right> to redo window configuration\n;; Note: May conflict with org-mode/markdown-mode C-c bindings in those buffers\n(winner-mode 1)\n\n;; Allow resizing side windows (help, compilation, etc.) via mouse drag\n(setq window-resize-pixelwise t)  ; Precise pixel resizing for smoother drag\n(setq window-sides-slots '(1 1 1 1))  ; Allow side windows on all sides\n;; Don't preserve side window sizes - allow free resizing\n(setq window-sides-vertical nil)  ; Side windows on left/right don't span full height\n(add-to-list 'window-persistent-parameters '(window-side . writable))\n\n;; GUI-only: window dividers for easier grabbing\n(when (display-graphic-p)\n  (setq window-divider-default-places t)\n  (setq window-divider-default-right-width 6)  ; Wider for easier grabbing\n  (setq window-divider-default-bottom-width 6)\n  (window-divider-mode 1)\n  (global-set-key [right-divider mouse-1] 'mouse-drag-vertical-line)\n  (global-set-key [bottom-divider mouse-1] 'mouse-drag-mode-line))\n\n;; ============================================================\n;; Terminal Vertical Split Display Fix\n;; ============================================================\n;; Prevent text overflow between vertically split windows in terminal\n(unless (display-graphic-p)\n  ;; Force line truncation in split windows to prevent overflow\n  (setq truncate-partial-width-windows t)\n  (setq-default truncate-lines t)  ; Truncate all lines in terminal\n  ;; Use ASCII vertical bar for window border (Unicode can cause width issues)\n  (set-display-table-slot standard-display-table 'vertical-border ?|)\n  ;; Ensure no margins\n  (setq-default left-margin-width 0)\n  (setq-default right-margin-width 0)\n  ;; Disable word wrap that can cause overflow\n  (setq-default word-wrap nil)\n  (global-visual-line-mode -1))\n\n;; ============================================================\n;; Frame/Terminal Title - Show project name in window list\n;; ============================================================\n;; This makes it easy to identify Emacs instances in Ghostty/terminal window lists\n\n(defun my/get-frame-title ()\n  \"Return a title string showing project and current buffer.\"\n  (let ((project (project-current)))\n    (format \"emacs [%s] - %s\"\n            (if project\n                (project-name project)\n              (abbreviate-file-name default-directory))\n            (buffer-name))))\n\n;; GUI Emacs: Set frame title via idle timer to avoid calling project-current on every redraw\n(defvar my/frame-title-cached \"\"\n  \"Cached frame title string, updated by idle timer.\")\n\n(defun my/update-frame-title-cache ()\n  \"Update cached frame title and apply it.\"\n  (setq my/frame-title-cached (my/get-frame-title))\n  (modify-frame-parameters nil `((title . ,my/frame-title-cached))))\n\n(setq frame-title-format '(:eval my/frame-title-cached))\n(run-with-idle-timer 1 t #'my/update-frame-title-cache)\n\n;; Terminal Emacs: Send escape sequence to set terminal window title\n(defun my/set-terminal-title ()\n  \"Set terminal window title to project name or directory.\"\n  (when (and (not (display-graphic-p))\n             (getenv \"TERM\"))\n    (send-string-to-terminal\n     (format \"\\033]0;%s\\007\" (my/get-frame-title)))))\n\n;; Update terminal title on relevant events\n;; Use idle timer instead of buffer-list-update-hook (which fires on every buffer access)\n(unless (display-graphic-p)\n  (run-with-idle-timer 1 t #'my/set-terminal-title)\n  (add-hook 'emacs-startup-hook #'my/set-terminal-title))\n\n(defconst demo-packages\n  '(anzu\n    company\n    ;; duplicate-thing  ; removed - no longer available on MELPA\n    ;; Completion framework - Vertico ecosystem (replaces Helm)\n    vertico\n    orderless\n    marginalia\n    consult\n    embark\n    embark-consult\n    migemo\n    ;; function-args\n    clean-aindent-mode\n    comment-dwim-2\n    dtrt-indent\n    ws-butler\n    iedit\n    yasnippet\n    smartparens\n    volatile-highlights\n    undo-tree\n    zygospore\n    ;; Modern language modes\n    exec-path-from-shell  ; Better PATH handling on macOS\n    go-mode               ; Go support (fallback if tree-sitter grammar unavailable)\n    yaml-mode             ; YAML support (fallback if tree-sitter grammar unavailable)\n    typescript-mode       ; TypeScript support (fallback if tree-sitter grammar unavailable)\n    web-mode              ; TSX/JSX support (fallback if tree-sitter grammar unavailable)\n    markdown-mode         ; Markdown support\n    ;; JVM languages\n    kotlin-mode           ; Kotlin support (fallback if tree-sitter grammar unavailable)\n    groovy-mode           ; Groovy/Gradle support\n    ;; Navigation fallback\n    dumb-jump             ; Jump to definition without tags/LSP\n    ;; Terminal\n    vterm                 ; Terminal emulator for Claude Code\n    eat                   ; Emulate A Terminal (another terminal emulator)\n    ))\n\n(defun install-packages ()\n  \"Install all required packages.\"\n  (interactive)\n  (unless package-archive-contents\n    (package-refresh-contents))\n  (dolist (package demo-packages)\n    (unless (package-installed-p package)\n      (package-install package))))\n\n(install-packages)\n\n;; ============================================================\n;; Navigation Enhancements\n;; ============================================================\n;; M-. (xref-find-definitions) and M-? (xref-find-references) are\n;; built-in bindings. Eglot automatically registers as xref backend.\n\n;; ============================================================\n;; dumb-jump - Fallback navigation when no tags/LSP available\n;; ============================================================\n(use-package dumb-jump\n  :config\n  (add-hook 'xref-backend-functions #'dumb-jump-xref-activate)\n  :custom\n  (dumb-jump-prefer-searcher 'rg)  ; Use ripgrep if available\n  (dumb-jump-force-searcher nil))\n\n;; ============================================================\n;; Completion - Company Mode\n;; ============================================================\n(use-package company\n  :hook (after-init . global-company-mode)\n  :config\n  (delete 'company-semantic company-backends)\n  ;; Add tab completion for C/C++ modes\n  (add-hook 'c-mode-hook\n            (lambda ()\n              (local-set-key (kbd \"<tab>\") 'company-complete)))\n  (add-hook 'c++-mode-hook\n            (lambda ()\n              (local-set-key (kbd \"<tab>\") 'company-complete)))\n  :custom\n  (company-idle-delay 0.1)\n  (company-minimum-prefix-length 2)\n  (company-show-numbers t))\n\n(use-package company-c-headers\n  :after company\n  :config\n  (add-to-list 'company-backends 'company-c-headers))\n\n;; hs-minor-mode for folding source code\n(add-hook 'c-mode-common-hook 'hs-minor-mode)\n\n;; Available C style:\n;; “gnu”: The default style for GNU projects\n;; “k&r”: What Kernighan and Ritchie, the authors of C used in their book\n;; “bsd”: What BSD developers use, aka “Allman style” after Eric Allman.\n;; “whitesmith”: Popularized by the examples that came with Whitesmiths C, an early commercial C compiler.\n;; “stroustrup”: What Stroustrup, the author of C++ used in his book\n;; “ellemtel”: Popular C++ coding standards as defined by “Programming in C++, Rules and Recommendations,” Erik Nyquist and Mats Henricson, Ellemtel\n;; “linux”: What the Linux developers use for kernel development\n;; “python”: What Python developers use for extension modules\n;; “java”: The default style for java-mode (see below)\n;; “user”: When you want to define your own style\n(setq\n c-default-style \"linux\" ;; set style to \"linux\"\n )\n\n(global-set-key (kbd \"RET\") 'newline-and-indent)  ; automatically indent when press RET\n\n;; activate whitespace-mode to view all whitespace characters\n(global-set-key (kbd \"C-c w\") 'whitespace-mode)\n\n;; show unncessary whitespace that can mess up your diff\n(add-hook 'prog-mode-hook (lambda () (interactive) (setq show-trailing-whitespace 1)))\n\n;; use space to indent by default\n(setq-default indent-tabs-mode nil)\n\n;; set appearance of a tab that is represented by 4 spaces\n(setq-default tab-width 4)\n\n;; Compilation\n(global-set-key (kbd \"<f5>\") (lambda ()\n                               (interactive)\n                               (setq-local compilation-read-command nil)\n                               (call-interactively 'compile)))\n\n;; setup GDB\n(setq\n ;; use gdb-many-windows by default\n gdb-many-windows t\n\n ;; Non-nil means display source file containing the main routine at startup\n gdb-show-main t\n )\n\n;; ============================================================\n;; Completion Framework - Vertico Ecosystem\n;; ============================================================\n\n;; vertico - Vertical completion UI\n(use-package vertico\n  :init\n  (vertico-mode)\n  :custom\n  (vertico-cycle t)\n  :bind (:map vertico-map\n              (\"C-j\" . vertico-next)\n              (\"C-k\" . vertico-previous)))\n\n;; orderless - Flexible completion matching\n(use-package orderless\n  :custom\n  (completion-styles '(orderless basic))\n  (completion-category-defaults nil)\n  (completion-category-overrides '((file (styles partial-completion)))))\n\n;; marginalia - Rich annotations in minibuffer\n(use-package marginalia\n  :init\n  (marginalia-mode))\n\n;; consult - Consulting completing-read\n(use-package consult\n  :bind ((\"C-x b\" . consult-buffer)\n         (\"M-g i\" . consult-imenu)\n         (\"M-s l\" . consult-line)\n         (\"M-s g\" . consult-grep)\n         (\"M-s r\" . consult-ripgrep)\n         (\"M-y\" . consult-yank-pop)\n         ;; Alternative bindings for terminal (M-s often conflicts)\n         (\"C-c s l\" . consult-line)       ; Alternative to M-s l\n         (\"C-c s g\" . consult-grep)       ; Alternative to M-s g\n         (\"C-c s r\" . consult-ripgrep)    ; Alternative to M-s r\n         (\"C-c s i\" . consult-imenu)      ; Alternative to M-g i\n         :map minibuffer-local-map\n         (\"M-p\" . consult-history)))\n\n;; embark - Contextual actions\n(use-package embark\n  :bind ((\"C-.\" . embark-act)\n         (\"C-c e b\" . embark-bindings)))  ; C-h B conflicts with C-h as backspace\n\n;; embark-consult - Integration between embark and consult\n(use-package embark-consult\n  :after (embark consult))\n\n;; ============================================================\n;; Editing Enhancements (use-package)\n;; ============================================================\n\n;; Package: clean-aindent-mode - Clean auto-indent and backspace behavior\n(use-package clean-aindent-mode\n  :hook (prog-mode . clean-aindent-mode))\n\n;; Package: dtrt-indent - Detect indent style automatically\n(use-package dtrt-indent\n  :config\n  (dtrt-indent-mode 1)\n  (setq dtrt-indent-verbosity 0))\n\n;; Package: ws-butler - Trim whitespace only on edited lines\n(use-package ws-butler\n  :hook ((prog-mode . ws-butler-mode)\n         (text-mode . ws-butler-mode)\n         (fundamental-mode . ws-butler-mode)))\n\n;; Package: yasnippet - Template system\n(use-package yasnippet\n  :config\n  (yas-global-mode 1)\n  ;; Don't activate in terminal mode\n  (add-hook 'term-mode-hook (lambda() (setq yas-dont-activate t)))\n  :custom\n  (yas-verbosity 1)\n  (yas-wrap-around-region t)\n  (yas-prompt-functions '(yas/ido-prompt yas/completing-prompt)))\n\n;; Package: smartparens - Parenthesis management\n(use-package smartparens\n  :config\n  (require 'smartparens-config)\n  (setq sp-base-key-bindings 'paredit)\n  (setq sp-autoskip-closing-pair 'always)\n  (setq sp-hybrid-kill-entire-symbol nil)\n  (sp-use-paredit-bindings)\n  (show-smartparens-global-mode +1)\n  (smartparens-global-mode 1))\n\n;; ============================================================\n;; Project Management - Built-in project.el (Emacs 28+)\n;; ============================================================\n;; project.el is built-in and integrates natively with Eglot, xref, and Consult.\n;; Default prefix: C-x p\n\n(setq project-switch-commands\n      '((project-find-file \"Find file\" ?f)\n        (project-find-regexp \"Find regexp\" ?g)\n        (project-find-dir \"Find directory\" ?d)\n        (project-eshell \"Eshell\" ?e)))\n\n;; ============================================================\n;; Dired Configuration\n;; ============================================================\n;; Auto-revert Dired buffer when switching to it (picks up filesystem changes)\n(setq dired-auto-revert-buffer t)\n\n;; Package: zygospore - Reversible C-x 1 (delete-other-windows)\n(use-package zygospore\n  :bind ((\"C-x 1\" . zygospore-toggle-delete-other-windows)))\n\n;; Package: anzu - Show match count in mode-line while searching\n(use-package anzu\n  :config\n  (global-anzu-mode)\n  :bind ((\"M-%\" . anzu-query-replace)\n         (\"C-M-%\" . anzu-query-replace-regexp)))\n\n;; Package: volatile-highlights - Highlight changes from yanking, undo, etc.\n(use-package volatile-highlights\n  :config\n  (volatile-highlights-mode t))\n\n;; Package: undo-tree - Visualize undo history as a tree\n(use-package undo-tree\n  :config\n  (global-undo-tree-mode))\n\n;; Package: comment-dwim-2 - Smarter comment/uncomment\n(use-package comment-dwim-2\n  :bind ((\"M-;\" . comment-dwim-2)))\n\n;; Package: iedit - Edit multiple occurrences simultaneously\n(use-package iedit\n  :custom\n  (iedit-toggle-key-default nil)\n  :bind ((\"C-;\" . iedit-mode)))\n\n;; ============================================================\n;; Custom Editing Behaviors (modernized from setup-editing.el)\n;; ============================================================\n\n;; Enhanced kill/copy/yank behaviors using modern advice-add\n\n;; 1. Copy line when no region is active (M-w)\n(defun my/slick-copy-advice (orig-fun &rest args)\n  \"Copy line when no region is active.\"\n  (interactive\n   (if mark-active\n       (list (region-beginning) (region-end))\n     (message \"Copied line\")\n     (list (line-beginning-position)\n           (line-beginning-position 2))))\n  (apply orig-fun args))\n\n(advice-add 'kill-ring-save :around #'my/slick-copy-advice)\n\n;; 2. Cut line when no region is active (C-w)\n(defun my/slick-cut-advice (orig-fun &rest args)\n  \"Cut line when no region is active.\"\n  (interactive\n   (if mark-active\n       (list (region-beginning) (region-end))\n     (list (line-beginning-position)\n           (line-beginning-position 2))))\n  (apply orig-fun args))\n\n(advice-add 'kill-region :around #'my/slick-cut-advice)\n\n;; 3. Clean whitespace before killing line (C-k)\n(defun my/kill-line-whitespace-advice (&rest _args)\n  \"Clean whitespace before killing line in programming modes.\"\n  (when (member major-mode\n                '(emacs-lisp-mode scheme-mode lisp-mode\n                  c-mode c++-mode objc-mode\n                  latex-mode plain-tex-mode))\n    (when (and (eolp) (not (bolp)))\n      (forward-char 1)\n      (just-one-space 0)\n      (backward-char 1))))\n\n(advice-add 'kill-line :before #'my/kill-line-whitespace-advice)\n\n;; 4. Auto-indent yanked text in programming modes (C-y, M-y)\n(defvar yank-indent-modes\n  '(LaTeX-mode TeX-mode)\n  \"Modes in which to indent regions that are yanked (or yank-popped).\nOnly modes that don't derive from `prog-mode' should be listed here.\")\n\n(defvar yank-indent-blacklisted-modes\n  '(python-mode slim-mode haml-mode)\n  \"Modes for which auto-indenting is suppressed.\")\n\n(defvar yank-advised-indent-threshold 1000\n  \"Threshold (# chars) over which indentation does not automatically occur.\")\n\n(defun yank-advised-indent-function (beg end)\n  \"Do indentation, as long as the region isn't too large.\"\n  (if (<= (- end beg) yank-advised-indent-threshold)\n      (indent-region beg end nil)))\n\n(defun my/yank-indent-advice (orig-fun &rest args)\n  \"Auto-indent yanked text in programming modes.\"\n  (let ((result (apply orig-fun args)))\n    (when (and (not (car args))\n               (not (member major-mode yank-indent-blacklisted-modes))\n               (or (derived-mode-p 'prog-mode)\n                   (member major-mode yank-indent-modes)))\n      (let ((transient-mark-mode nil))\n        (yank-advised-indent-function (region-beginning) (region-end))))\n    result))\n\n(advice-add 'yank :around #'my/yank-indent-advice)\n(advice-add 'yank-pop :around #'my/yank-indent-advice)\n\n;; Other useful editing functions from setup-editing.el\n\n;; Smart move to beginning of line (C-a)\n(defun prelude-move-beginning-of-line (arg)\n  \"Move point back to indentation of beginning of line.\n\nMove point to the first non-whitespace character on this line.\nIf point is already there, move to the beginning of the line.\nEffectively toggle between the first non-whitespace character and\nthe beginning of the line.\n\nIf ARG is not nil or 1, move forward ARG - 1 lines first. If\npoint reaches the beginning or end of the buffer, stop there.\"\n  (interactive \"^p\")\n  (setq arg (or arg 1))\n\n  ;; Move lines first\n  (when (/= arg 1)\n    (let ((line-move-visual nil))\n      (forward-line (1- arg))))\n\n  (let ((orig-point (point)))\n    (back-to-indentation)\n    (when (= orig-point (point))\n      (move-beginning-of-line 1))))\n\n(global-set-key (kbd \"C-a\") 'prelude-move-beginning-of-line)\n\n;; Smart open line (M-o)\n(defun prelude-smart-open-line (arg)\n  \"Insert an empty line after the current line.\nPosition the cursor at its beginning, according to the current mode.\nWith a prefix ARG open line above the current line.\"\n  (interactive \"P\")\n  (if arg\n      (prelude-smart-open-line-above)\n    (progn\n      (move-end-of-line nil)\n      (newline-and-indent))))\n\n(defun prelude-smart-open-line-above ()\n  \"Insert an empty line above the current line.\nPosition the cursor at it's beginning, according to the current mode.\"\n  (interactive)\n  (move-beginning-of-line nil)\n  (newline-and-indent)\n  (forward-line -1)\n  (indent-according-to-mode))\n\n(global-set-key (kbd \"M-o\") 'prelude-smart-open-line)\n\n;; Indent buffer or region (C-c i)\n(defun indent-buffer ()\n  \"Indent the currently visited buffer.\"\n  (interactive)\n  (indent-region (point-min) (point-max)))\n\n(defcustom prelude-indent-sensitive-modes\n  '(coffee-mode python-mode slim-mode haml-mode yaml-mode)\n  \"Modes for which auto-indenting is suppressed.\"\n  :type 'list)\n\n(defun indent-region-or-buffer ()\n  \"Indent a region if selected, otherwise the whole buffer.\"\n  (interactive)\n  (unless (member major-mode prelude-indent-sensitive-modes)\n    (save-excursion\n      (if (region-active-p)\n          (progn\n            (indent-region (region-beginning) (region-end))\n            (message \"Indented selected region.\"))\n        (progn\n          (indent-buffer)\n          (message \"Indented buffer.\")))\n      (whitespace-cleanup))))\n\n(global-set-key (kbd \"C-c i\") 'indent-region-or-buffer)\n\n;; ============================================================\n;; Speedbar\n(setq speedbar-show-unknown-files t)\n\n;; NOTE: Removed old macOS Mavericks workaround that forced home directory\n;; This was causing issues with `emacs .` not respecting current directory\n;; If you need to start in home directory, use: emacs ~\n;;\n;; Old code (commented out):\n;; ;;　Changing the home directory as the initial dir(for Mervelicks)\n;; (setq default-directory \"~/\")\n;; (setq command-line-default-directory \"~/\")\n;;\n;; ;; Changing the default directory as of '〜/' for Mavericks\n;; (defun cd-to-homedir-all-buffers ()\n;;   \"Change every current directory of all buffers to the home directory.\"\n;;   (mapc\n;;    (lambda (buf) (set-buffer buf) (cd (expand-file-name \"~\"))) (buffer-list)))\n;; (add-hook 'after-init-hook 'cd-to-homedir-all-buffers)\n\n;; Japanese Configuration (UTF-8)\n(set-language-environment \"Japanese\")\n(set-terminal-coding-system 'utf-8)\n(set-keyboard-coding-system 'utf-8)\n(set-buffer-file-coding-system 'utf-8)\n(setq buffer-file-coding-system 'utf-8)\n(setq slime-net-coding-system 'utf-8-unix)\n\n;; key bindings\n(windmove-default-keybindings 'meta)\n(setq mac-option-modifier 'meta)\n(setq mac-command-modifier 'meta)\n(global-set-key [kp-delete] 'delete-char) ;; sets fn-delete to be right-delete\n\n;; Enabling Font Lock mode (e.g. bold display)\n(global-font-lock-mode t)\n\n;; Enabling automcatically the temporarily mode\n(setq-default transient-mark-mode t)\n\n;; Changing C-x C-u to be worked nothing (undo / typo countermeasure)\n(global-unset-key \"\\C-x\\C-u\")\n\n;; High lighting the pared parenethesis\n(show-paren-mode 1)\n\n(setq next-line-add-newlines nil)\n\n;; C-x l/ run goto-line\n(define-key ctl-x-map \"l\" 'goto-line)\n;; alternate of '¥', entering '/'\n(define-key global-map [?¥] [?\\\\])\n\n(display-time)\n\n;; display the column number\n(column-number-mode 1)\n\n;; NOTE: menu-bar, tool-bar, and scroll-bars are disabled in early-init.el\n;; to prevent UI flickering during startup\n\n;; Make C-h act as backspace\n(define-key global-map \"\\C-h\" 'delete-backward-char)\n(define-key global-map \"\\C-x\\C-h\" 'help-command)\n;; Also bind in key-translation-map to override help-map\n(define-key key-translation-map (kbd \"C-h\") (kbd \"<DEL>\"))\n;; Override in isearch-mode\n(define-key isearch-mode-map \"\\C-h\" 'isearch-delete-char)\n(define-key global-map \"\\C-o\" 'dabbrev-expand)\n(setq dabbrev-case-fold-search nil)\n\n;;; Don't create the backup file\n(setq backup-inhibited t)\n\n;;; Deleting the save files when it was exited.\n(setq delete-auto-save-files t)\n\n;; Configuration for Japanese and English\n;; http://www.alles.or.jp/~torutk/oojava/meadow/Meadow210Install.html\n(defun my/dabbrev-expand-japanese-advice (orig-fun &rest args)\n  \"Modify `dabbrev-abbrev-char-regexp' dynamically for Japanese words.\"\n  (if (bobp)\n      (apply orig-fun args)\n    (let ((dabbrev-abbrev-char-regexp\n           (let ((c (char-category-set (char-before))))\n             (cond\n              ((aref c ?a) \"[-_A-Za-z0-9]\") ; ASCII\n              ((aref c ?j) ; Japanese\n               (cond\n                ((aref c ?K) \"\\\\cK\") ; katakana\n                ((aref c ?A) \"\\\\cA\") ; 2byte alphanumeric\n                ((aref c ?H) \"\\\\cH\") ; hiragana\n                ((aref c ?C) \"\\\\cC\") ; kanji\n                (t \"\\\\cj\")))\n              ((aref c ?k) \"\\\\ck\") ; hankaku-kana\n              ((aref c ?r) \"\\\\cr\") ; Japanese roman ?\n              (t dabbrev-abbrev-char-regexp)))))\n      (apply orig-fun args))))\n\n(advice-add 'dabbrev-expand :around #'my/dabbrev-expand-japanese-advice)\n\n;; Configuration Backspace\n(delete-selection-mode 1)\n\n;; The local variables list in .emacs と言われるのを抑止\n(add-to-list 'ignored-local-variables 'syntax)\n\n;; http://0xcc.net/blog/archives/000041.html\n(set-default-coding-systems 'utf-8)\n\n;; ============================================================\n;; Theme and Colors\n;; ============================================================\n;; modus-vivendi - High contrast dark theme (built-in since Emacs 28)\n;; Part of the modus-themes package by Protesilaos Stavrou\n(load-theme 'modus-vivendi t)\n\n;; Font configuration\n(when window-system\n  (set-frame-font \"Monaco-12\" nil t)\n  (set-frame-parameter nil 'alpha 100))\n\n(setq default-frame-alist\n  (append\n   '((font . \"Monaco-12\") ;; Default Fontset\n  (width . 140) (height . 50) ;; Window Size\n  )\n  default-frame-alist))\n\n;; ============================================================\n;; migemo - Japanese incremental search with Romanization\n;; ============================================================\n;; Requires: brew install cmigemo\n(use-package migemo\n  :if (executable-find \"cmigemo\")\n  :custom\n  (migemo-command \"cmigemo\")\n  (migemo-options '(\"-q\" \"--emacs\"))\n  (migemo-dictionary \"/opt/homebrew/share/migemo/utf-8/migemo-dict\")\n  (migemo-user-dictionary nil)\n  (migemo-regex-dictionary nil)\n  (migemo-coding-system 'utf-8-unix)\n  :config\n  (migemo-init))\n\n;; ============================================================\n;; exec-path-from-shell - Better PATH handling on macOS\n;; ============================================================\n(use-package exec-path-from-shell\n  :if (memq window-system '(mac ns x))\n  :config\n  (exec-path-from-shell-initialize)\n  ;; Copy additional environment variables for development tools\n  (exec-path-from-shell-copy-envs '(\"GOPATH\" \"GOROOT\" \"PYENV_ROOT\" \"VOLTA_HOME\"))\n  ;; Add Volta bin directory to exec-path for npm global packages\n  (when-let ((volta-home (getenv \"VOLTA_HOME\")))\n    (add-to-list 'exec-path (expand-file-name \"bin\" volta-home)))\n  ;; Add pyenv shims to exec-path for pip global packages\n  (let ((pyenv-root (or (getenv \"PYENV_ROOT\")\n                        (expand-file-name \"~/.pyenv\"))))\n    (when (file-directory-p pyenv-root)\n      (add-to-list 'exec-path (expand-file-name \"shims\" pyenv-root)))))\n\n;; ============================================================\n;; Eglot - Built-in LSP client (Emacs 29+)\n;; ============================================================\n(require 'eglot)\n\n;; Don't log every event (improves performance)\n(setq eglot-events-buffer-size 0)\n\n;; Shutdown server when last managed buffer is killed\n(setq eglot-autoshutdown t)\n\n;; ============================================================\n;; Tree-sitter Configuration\n;; ============================================================\n;; Tree-sitter provides accurate syntax highlighting via grammar libraries.\n;; Install grammars with: M-x treesit-install-language-grammar\n;;\n;; Grammar sources for common languages:\n(setq treesit-language-source-alist\n      '((python \"https://github.com/tree-sitter/tree-sitter-python\")\n        (go \"https://github.com/tree-sitter/tree-sitter-go\")\n        (gomod \"https://github.com/camdencheek/tree-sitter-go-mod\")\n        (yaml \"https://github.com/ikatyang/tree-sitter-yaml\")\n        ;; C/C++\n        (c \"https://github.com/tree-sitter/tree-sitter-c\")\n        (cpp \"https://github.com/tree-sitter/tree-sitter-cpp\")\n        ;; JavaScript/TypeScript\n        (javascript \"https://github.com/tree-sitter/tree-sitter-javascript\")\n        (typescript \"https://github.com/tree-sitter/tree-sitter-typescript\" \"master\" \"typescript/src\")\n        (tsx \"https://github.com/tree-sitter/tree-sitter-typescript\" \"master\" \"tsx/src\")\n        ;; JVM languages\n        (java \"https://github.com/tree-sitter/tree-sitter-java\")\n        (kotlin \"https://github.com/fwcd/tree-sitter-kotlin\")\n        (groovy \"https://github.com/murtaza64/tree-sitter-groovy\")))\n\n;; Helper function to check if tree-sitter grammar is actually usable\n(defun my/treesit-available-p (lang)\n  \"Check if tree-sitter grammar for LANG is actually usable.\nUses treesit-ready-p which verifies the grammar can be loaded.\"\n  (and (fboundp 'treesit-ready-p)\n       (treesit-ready-p lang t)))  ; t = quiet, don't signal error\n\n;; ============================================================\n;; Python Configuration\n;; ============================================================\n;; Uses python-ts-mode if grammar available, otherwise python-mode\n;; LSP servers (install one): pip install python-lsp-server\n;;                        or: pip install basedpyright\n;;                        or: pip install ruff\n\n;; Use tree-sitter mode if grammar is available\n(when (my/treesit-available-p 'python)\n  (add-to-list 'major-mode-remap-alist '(python-mode . python-ts-mode)))\n\n(add-hook 'python-mode-hook 'eglot-ensure)\n(add-hook 'python-ts-mode-hook 'eglot-ensure)\n\n;; Python indentation\n(setq python-indent-offset 4)\n\n;; ============================================================\n;; Go Configuration\n;; ============================================================\n;; Requires: go install golang.org/x/tools/gopls@latest\n\n;; Help project.el find Go project roots (look for go.mod)\n(defun project-find-go-module (dir)\n  \"Find Go module root for DIR by locating go.mod.\"\n  (when-let ((root (locate-dominating-file dir \"go.mod\")))\n    (cons 'go-module root)))\n\n(cl-defmethod project-root ((project (head go-module)))\n  \"Return root directory of Go PROJECT.\"\n  (cdr project))\n\n;; Add Go module detection to project-find-functions\n(add-hook 'project-find-functions #'project-find-go-module)\n\n;; Use tree-sitter mode if grammar is available, otherwise use go-mode\n(if (my/treesit-available-p 'go)\n    (progn\n      (add-to-list 'auto-mode-alist '(\"\\\\.go\\\\'\" . go-ts-mode))\n      (when (my/treesit-available-p 'gomod)\n        (add-to-list 'auto-mode-alist '(\"go\\\\.mod\\\\'\" . go-mod-ts-mode)))\n      (add-hook 'go-ts-mode-hook\n                (lambda ()\n                  (eglot-ensure)\n                  (setq-local indent-tabs-mode t)\n                  (setq-local tab-width 4)\n                  (add-hook 'before-save-hook\n                            (lambda ()\n                              (when (derived-mode-p 'go-ts-mode)\n                                (eglot-format-buffer)))\n                            nil t))))\n  ;; Fallback to go-mode package\n  (use-package go-mode\n    :hook ((go-mode . eglot-ensure)\n           (go-mode . (lambda ()\n                        (setq-local indent-tabs-mode t)\n                        (setq-local tab-width 4)))\n           (go-mode . (lambda ()\n                        (add-hook 'before-save-hook\n                                  (lambda ()\n                                    (when (derived-mode-p 'go-mode)\n                                      (eglot-format-buffer)))\n                                  nil t))))))\n\n;; Gopls configuration\n(setq-default eglot-workspace-configuration\n              '(:gopls (:staticcheck t :usePlaceholders t)))\n\n;; ============================================================\n;; C/C++ Configuration\n;; ============================================================\n;; Uses c-ts-mode and c++-ts-mode if grammars available (built-in Emacs 29+)\n;; LSP: clangd (usually comes with Xcode or LLVM)\n;;   Install: xcode-select --install (macOS)\n;;        or: brew install llvm\n\n;; Use tree-sitter modes if grammars are available\n(when (my/treesit-available-p 'c)\n  (add-to-list 'major-mode-remap-alist '(c-mode . c-ts-mode)))\n\n(when (my/treesit-available-p 'cpp)\n  (add-to-list 'major-mode-remap-alist '(c++-mode . c++-ts-mode))\n  (add-to-list 'auto-mode-alist '(\"\\\\.cpp\\\\'\" . c++-ts-mode))\n  (add-to-list 'auto-mode-alist '(\"\\\\.hpp\\\\'\" . c++-ts-mode))\n  (add-to-list 'auto-mode-alist '(\"\\\\.cc\\\\'\" . c++-ts-mode))\n  (add-to-list 'auto-mode-alist '(\"\\\\.hh\\\\'\" . c++-ts-mode)))\n\n;; Enable Eglot for C/C++ (clangd)\n(add-hook 'c-mode-hook 'eglot-ensure)\n(add-hook 'c-ts-mode-hook 'eglot-ensure)\n(add-hook 'c++-mode-hook 'eglot-ensure)\n(add-hook 'c++-ts-mode-hook 'eglot-ensure)\n\n;; ============================================================\n;; JavaScript / Node.js Configuration\n;; ============================================================\n;; Uses js-ts-mode if grammar available (built-in Emacs 29+)\n;; Requires: npm install -g typescript-language-server typescript\n;; (typescript-language-server also handles JavaScript)\n\n;; Use tree-sitter mode if grammar is available\n(when (my/treesit-available-p 'javascript)\n  (add-to-list 'major-mode-remap-alist '(javascript-mode . js-ts-mode))\n  (add-to-list 'auto-mode-alist '(\"\\\\.js\\\\'\" . js-ts-mode))\n  (add-to-list 'auto-mode-alist '(\"\\\\.mjs\\\\'\" . js-ts-mode))\n  (add-to-list 'auto-mode-alist '(\"\\\\.cjs\\\\'\" . js-ts-mode)))\n\n(add-hook 'js-mode-hook 'eglot-ensure)\n(add-hook 'js-ts-mode-hook 'eglot-ensure)\n\n;; JavaScript indentation\n(setq js-indent-level 2)\n\n;; ============================================================\n;; TypeScript Configuration\n;; ============================================================\n;; Uses typescript-ts-mode if grammar available, otherwise typescript-mode\n;; Requires: npm install -g typescript-language-server typescript\n\n;; TypeScript indentation\n(setq typescript-ts-mode-indent-offset 2)\n\n;; Use tree-sitter mode if grammar available, otherwise typescript-mode package\n(if (my/treesit-available-p 'typescript)\n    (progn\n      (add-to-list 'auto-mode-alist '(\"\\\\.ts\\\\'\" . typescript-ts-mode))\n      (add-hook 'typescript-ts-mode-hook 'eglot-ensure))\n  ;; Fallback to typescript-mode package\n  (use-package typescript-mode\n    :mode \"\\\\.ts\\\\'\"\n    :hook (typescript-mode . eglot-ensure)\n    :custom\n    (typescript-indent-level 2)))\n\n;; TSX - tree-sitter mode if available, otherwise web-mode as fallback\n(if (my/treesit-available-p 'tsx)\n    (progn\n      (add-to-list 'auto-mode-alist '(\"\\\\.tsx\\\\'\" . tsx-ts-mode))\n      (add-hook 'tsx-ts-mode-hook 'eglot-ensure))\n  ;; Fallback to web-mode for TSX\n  (use-package web-mode\n    :mode \"\\\\.tsx\\\\'\"\n    :hook (web-mode . eglot-ensure)\n    :custom\n    (web-mode-markup-indent-offset 2)\n    (web-mode-code-indent-offset 2)))\n\n;; ============================================================\n;; YAML Configuration\n;; ============================================================\n;; Optional LSP: npm install -g yaml-language-server\n\n;; Use tree-sitter mode if grammar available, otherwise yaml-mode\n(if (my/treesit-available-p 'yaml)\n    (progn\n      (add-to-list 'auto-mode-alist '(\"\\\\.ya?ml\\\\'\" . yaml-ts-mode))\n      (add-to-list 'auto-mode-alist '(\"\\\\.eyaml\\\\'\" . yaml-ts-mode))\n      (add-hook 'yaml-ts-mode-hook\n                (lambda ()\n                  (setq-local indent-tabs-mode nil)\n                  (setq-local tab-width 2)\n                  (when (executable-find \"yaml-language-server\")\n                    (eglot-ensure)))))\n  ;; Fallback to yaml-mode package\n  (use-package yaml-mode\n    :mode ((\"\\\\.ya?ml\\\\'\" . yaml-mode)\n           (\"\\\\.eyaml\\\\'\" . yaml-mode))\n    :hook ((yaml-mode . (lambda ()\n                          (setq-local indent-tabs-mode nil)\n                          (setq-local tab-width 2)\n                          (when (executable-find \"yaml-language-server\")\n                            (eglot-ensure)))))))\n\n;; ============================================================\n;; Java Configuration\n;; ============================================================\n;; Uses java-ts-mode if grammar available (built-in Emacs 29+)\n;; Requires: Eclipse JDTLS for LSP\n;;   macOS: brew install jdtls\n;;   or download from: https://download.eclipse.org/jdtls/\n;;\n;; Note: JDTLS needs a workspace directory for each project\n\n;; Use tree-sitter mode if grammar is available\n(when (my/treesit-available-p 'java)\n  (add-to-list 'major-mode-remap-alist '(java-mode . java-ts-mode)))\n\n;; Configure Eglot for Java (JDTLS)\n(with-eval-after-load 'eglot\n  (add-to-list 'eglot-server-programs\n               '((java-mode java-ts-mode) . (\"jdtls\"))))\n\n(add-hook 'java-mode-hook 'eglot-ensure)\n(add-hook 'java-ts-mode-hook 'eglot-ensure)\n\n;; Java indentation\n(add-hook 'java-mode-hook\n          (lambda ()\n            (setq-local c-basic-offset 4)\n            (setq-local tab-width 4)\n            (setq-local indent-tabs-mode nil)))\n(add-hook 'java-ts-mode-hook\n          (lambda ()\n            (setq-local c-basic-offset 4)\n            (setq-local tab-width 4)\n            (setq-local indent-tabs-mode nil)))\n\n;; ============================================================\n;; Kotlin Configuration\n;; ============================================================\n;; Uses kotlin-mode package (no built-in kotlin-ts-mode in Emacs yet)\n;; Tree-sitter grammar available at: https://github.com/fwcd/tree-sitter-kotlin\n;; Requires: kotlin-language-server for LSP\n;;   Install: brew install kotlin-language-server\n;;        or: https://github.com/fwcd/kotlin-language-server\n\n;; Configure Eglot for Kotlin\n(with-eval-after-load 'eglot\n  (add-to-list 'eglot-server-programs\n               '(kotlin-mode . (\"kotlin-language-server\"))))\n\n;; Use kotlin-mode package\n(use-package kotlin-mode\n  :ensure t\n  :mode ((\"\\\\.kt\\\\'\" . kotlin-mode)\n         (\"\\\\.kts\\\\'\" . kotlin-mode))\n  :hook ((kotlin-mode . eglot-ensure)\n         (kotlin-mode . (lambda ()\n                          (setq-local tab-width 4)\n                          (setq-local indent-tabs-mode nil)))))\n\n;; ============================================================\n;; Gradle / Groovy Configuration\n;; ============================================================\n;; Uses groovy-mode package (no built-in groovy-ts-mode in Emacs yet)\n;; Tree-sitter grammar available at: https://github.com/murtaza64/tree-sitter-groovy\n;;\n;; Gradle build files come in two flavors:\n;; - .gradle files: Groovy DSL (use groovy-mode)\n;; - .gradle.kts files: Kotlin DSL (use kotlin-mode)\n;;\n;; Optional LSP: gradle-language-server (experimental)\n;;   Install: npm install -g gradle-language-server\n\n;; Groovy mode for .gradle and .groovy files\n(use-package groovy-mode\n  :ensure t\n  :mode ((\"\\\\.gradle\\\\'\" . groovy-mode)\n         (\"\\\\.groovy\\\\'\" . groovy-mode))\n  :config\n  (setq groovy-indent-offset 4))\n\n;; For .gradle.kts files, use Kotlin mode (already configured above)\n;; The \"\\\\.kts\\\\'\" pattern in kotlin configuration handles build.gradle.kts\n\n;; ============================================================\n;; Markdown Configuration\n;; ============================================================\n;; Optional: brew install pandoc (for preview/export)\n\n(use-package markdown-mode\n  :mode ((\"README\\\\.md\\\\'\" . gfm-mode)\n         (\"\\\\.md\\\\'\" . markdown-mode)\n         (\"\\\\.markdown\\\\'\" . markdown-mode))\n  :config\n  ;; Use pandoc for markdown processing if available\n  (when (executable-find \"pandoc\")\n    (setq markdown-command\n          (if (executable-find \"mermaid-filter\")\n              \"pandoc --filter mermaid-filter\"\n            \"pandoc\")))\n  ;; Open live preview window on the right side\n  (defun my/markdown-live-preview-window-right (file)\n    \"Open markdown live preview in a window on the right side.\"\n    (eww-open-file file)\n    (let ((buf (if (bound-and-true-p eww-auto-rename-buffer)\n                   (cl-loop for b in (buffer-list)\n                            when (string-match-p \"eww\\\\*\\\\'\" (buffer-name b))\n                            return b)\n                 (get-buffer \"*eww*\"))))\n      (pop-to-buffer buf '((display-buffer-in-direction)\n                           (direction . right)\n                           (window-width . 0.5)))\n      buf))\n  (setq markdown-live-preview-window-function #'my/markdown-live-preview-window-right)\n  :custom\n  (markdown-enable-math t)\n  (markdown-fontify-code-blocks-natively t)\n  ;; Delete exported HTML files after live preview\n  (markdown-live-preview-delete-export 'delete-on-export))\n\n;; grip-mode - GitHub-flavored Markdown preview\n;; Uses go-grip for local rendering (no GitHub API needed)\n;; Requires: go install github.com/chrishrb/go-grip@latest\n(use-package grip-mode\n  :ensure t\n  :after markdown-mode\n  :bind (:map markdown-mode-command-map\n         (\"g\" . grip-mode))\n  :custom\n  (grip-command 'go-grip)           ; Use go-grip (no GitHub API)\n  (grip-preview-use-webkit nil))    ; Use external browser\n\n;; ============================================================\n;; Terminal Emulators\n;; ============================================================\n;; vterm - Full-featured terminal emulator (requires libvterm)\n;; Requires: brew install libvterm\n(use-package vterm\n  :ensure t\n  :demand t  ; Load eagerly so it's available for claude-code\n  :custom\n  ;; Large scrollback buffer for Claude Code history (default is 1000)\n  (vterm-max-scrollback 100000)\n  :config\n  ;; Disable modes that interfere with terminal input\n  (defun my/vterm-mode-setup ()\n    \"Setup vterm buffer for proper terminal input.\"\n    (setq-local global-hl-line-mode nil)\n    (setq-local line-spacing nil)\n    ;; Disable modes that intercept keyboard input\n    (smartparens-mode -1)\n    (company-mode -1)\n    (yas-minor-mode -1)\n    ;; Ensure vterm handles all input\n    (setq-local scroll-margin 0)\n    ;; Fix border overflow and alignment (UI rendering issues)\n    (when (fboundp 'set-window-fringes)\n      (set-window-fringes (selected-window) 0 0))  ; Remove fringes (GUI only)\n    (setq-local truncate-lines t)  ; Let vterm/Claude Code handle wrapping\n    (when (bound-and-true-p display-line-numbers-mode)\n      (display-line-numbers-mode -1)))  ; Disable line numbers\n  (add-hook 'vterm-mode-hook #'my/vterm-mode-setup)\n\n  ;; Prevent vterm windows from getting too narrow (for Claude Code display)\n  (defvar my/vterm-min-width 80\n    \"Minimum width for vterm windows.\")\n\n  (defun my/vterm-enforce-min-width ()\n    \"Enlarge vterm window if it's too narrow.\"\n    (when (and (eq major-mode 'vterm-mode)\n               (< (window-width) my/vterm-min-width)\n               (window-resizable nil (- my/vterm-min-width (window-width)) t))\n      (enlarge-window-horizontally (- my/vterm-min-width (window-width)))))\n\n  (add-hook 'window-configuration-change-hook #'my/vterm-enforce-min-width)\n\n  ;; Mouse wheel scrolling - enters copy mode to scroll through full history\n  (defun my/vterm-scroll-up ()\n    \"Scroll up in vterm, entering copy mode to access full scrollback.\"\n    (interactive)\n    (unless vterm-copy-mode\n      (vterm-copy-mode 1))\n    (scroll-down-command 3))\n  (defun my/vterm-scroll-down ()\n    \"Scroll down in vterm. Exit copy mode when reaching the bottom.\"\n    (interactive)\n    (if vterm-copy-mode\n        (progn\n          (scroll-up-command 3)\n          ;; Exit copy mode if we're at the bottom (end of buffer visible)\n          (when (pos-visible-in-window-p (point-max))\n            (vterm-copy-mode -1)))\n      (scroll-up-command 3)))\n  (define-key vterm-mode-map (kbd \"<mouse-4>\") #'my/vterm-scroll-up)\n  (define-key vterm-mode-map (kbd \"<mouse-5>\") #'my/vterm-scroll-down)\n  (define-key vterm-mode-map (kbd \"<wheel-up>\") #'my/vterm-scroll-up)\n  (define-key vterm-mode-map (kbd \"<wheel-down>\") #'my/vterm-scroll-down)\n  ;; Keybindings to send Escape to terminal (for Claude Code cancel)\n  (define-key vterm-mode-map (kbd \"C-c C-e\") #'vterm-send-escape)\n  (define-key vterm-mode-map (kbd \"C-c <escape>\") #'vterm-send-escape)\n\n  ;; Copy mode with mouse support\n  ;; Click to enter copy mode and set mark, drag to select, release to copy\n  (defun my/vterm-mouse-select-start (event)\n    \"Start mouse selection in vterm - enters copy mode and sets mark.\"\n    (interactive \"e\")\n    (unless vterm-copy-mode\n      (vterm-copy-mode 1))\n    (mouse-set-point event)\n    (push-mark (point) t t))\n\n  (defun my/vterm-mouse-select-end (event)\n    \"End mouse selection in vterm - copies region to clipboard.\"\n    (interactive \"e\")\n    (when vterm-copy-mode\n      (mouse-set-point event)\n      (when (use-region-p)\n        (kill-ring-save (region-beginning) (region-end))\n        (message \"Copied to clipboard\"))))\n\n  ;; Mouse drag selection that copies to kill-ring\n  (defun my/vterm-mouse-drag-copy (start-event)\n    \"Select region with mouse drag and copy to kill-ring.\"\n    (interactive \"e\")\n    (unless vterm-copy-mode\n      (vterm-copy-mode 1))\n    (mouse-drag-region start-event)\n    (when (use-region-p)\n      (kill-ring-save (region-beginning) (region-end))\n      (message \"Copied to clipboard\")))\n\n  ;; Mouse bindings for copy mode - DISABLED for testing\n  ;; (define-key vterm-mode-map (kbd \"<down-mouse-1>\") #'my/vterm-mouse-drag-copy)\n\n  ;; Paste from kill-ring into vterm\n  (define-key vterm-mode-map (kbd \"C-y\") #'vterm-yank)\n  (define-key vterm-mode-map (kbd \"M-y\") #'vterm-yank-pop)\n\n  ;; Copy mode keybindings\n  ;; C-c C-t: enter copy mode (default vterm binding)\n  ;; Select with mouse or keyboard, then:\n  (define-key vterm-copy-mode-map (kbd \"M-w\") #'vterm-copy-mode-done)  ; Copy and exit\n  (define-key vterm-copy-mode-map (kbd \"M-c\") #'vterm-copy-mode-done)  ; Cmd+c (mac-command = meta)\n  (define-key vterm-copy-mode-map (kbd \"C-c C-c\") #'vterm-copy-mode-done)\n  (define-key vterm-copy-mode-map (kbd \"q\") #'vterm-copy-mode)  ; Exit without copying\n  (define-key vterm-copy-mode-map (kbd \"<return>\") #'vterm-copy-mode-done))\n\n;; eat - Emulate A Terminal (pure elisp, no external dependencies)\n(use-package eat\n  :commands eat)\n\n;; ============================================================\n;; Claude Code Integration\n;; ============================================================\n;; Requires: brew install --cask claude-code (already installed)\n;;           brew install libvterm (already installed)\n\n;; transient - Required dependency for claude-code.el (menu system)\n(use-package transient\n  :ensure t)\n\n;; inheritenv - Required dependency for claude-code.el (environment handling)\n(use-package inheritenv\n  :vc (:url \"https://github.com/purcell/inheritenv\" :rev :newest))\n\n(use-package claude-code\n  :vc (:url \"https://github.com/stevemolitor/claude-code.el\" :rev :newest)\n  :demand t  ; Load immediately, don't defer\n  :after vterm  ; Ensure vterm is loaded first\n  :init\n  ;; Set these BEFORE package loads (defcustom defaults are read at load time)\n  (setq claude-code-terminal-backend 'vterm)   ; Use vterm for best TUI experience\n  (setq claude-code-program \"claude\")       ; CLI program name\n  (require 'vterm)  ; Ensure vterm is available\n  :config\n  (claude-code-mode)  ; Enable global minor mode for IDE integration\n  ;; Set up keybindings explicitly (more reliable than :bind-keymap with :vc)\n  (global-set-key (kbd \"C-c c\") claude-code-command-map))\n\n(custom-set-variables\n ;; custom-set-variables was added by Custom.\n ;; If you edit it by hand, you could mess it up, so be careful.\n ;; Your init file should contain only one such instance.\n ;; If there is more than one, they won't work right.\n '(company-show-quick-access t nil nil \"Customized with use-package company\")\n '(package-selected-packages nil))\n(custom-set-faces\n ;; custom-set-faces was added by Custom.\n ;; If you edit it by hand, you could mess it up, so be careful.\n ;; Your init file should contain only one such instance.\n ;; If there is more than one, they won't work right.\n )\n\n;;; init.el ends here\n","structuredPatch":[{"oldStart":1219,"oldLines":7,"newStart":1219,"newLines":7,"lines":["                (window-resizable nil (- my/vterm-min-width (window-width)) t))","       (enlarge-window-horizontally (- my/vterm-min-width (window-width)))))"," ","-  (add-hook 'window-configuration-change-hook #'my/vterm-enforce-min-width)","+  (add-hook 'window-size-change-functions (lambda (_frame) (my/vterm-enforce-min-width)))"," ","   ;; Mouse wheel scrolling - enters copy mode to scroll through full history","   (defun my/vterm-scroll-up ()"]}],"userModified":false,"replaceAll":false},"sourceToolAssistantUUID":"fe0a1ee5-6384-4d7e-b8cd-9a53287b875f"}
{"parentUuid":"9cb5ddcd-f7e1-4854-a7e2-ab02d3647363","isSidechain":false,"userType":"external","cwd":"/Users/naokisega/src/github.com/nsega/.emacs.d","sessionId":"3662272f-90eb-4f6d-acc3-1b561237eac1","version":"2.1.49","gitBranch":"feature/update-gitignore","slug":"clever-shimmying-tiger","message":{"model":"claude-sonnet-4-6","id":"msg_01CzbuBEESoyymB2D1nrWvhz","type":"message","role":"assistant","content":[{"type":"text","text":"`window-size-change-functions` only fires when a window is actually resized, unlike `window-configuration-change-hook` which fires on nearly any layout change.\n\n**Summary of changes made:**\n\n| Issue | Before | After |\n|---|---|---|\n| Terminal title | `buffer-list-update-hook` (fires constantly) | `run-with-idle-timer 1` (at most once/sec when idle) |\n| Frame title (GUI) | `(:eval ...)` on every redraw | Cached, updated by idle timer |\n| vterm width | `window-configuration-change-hook` | `window-size-change-functions` |\n\nTo diagnose what's still consuming CPU after restarting Emacs, you can use:\n```\nM-x profiler-start RET cpu RET\n;; reproduce the high-CPU situation for a few seconds\nM-x profiler-report\n```"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":265,"cache_read_input_tokens":54076,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":265},"output_tokens":1,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYMpazhy5SQ52PyNiNwiN","type":"assistant","uuid":"dfa8cf70-237b-4d5e-a644-372f2ddaec09","timestamp":"2026-02-21T20:10:11.281Z"}
{"parentUuid":"dfa8cf70-237b-4d5e-a644-372f2ddaec09","isSidechain":false,"userType":"external","cwd":"/Users/naokisega/src/github.com/nsega/.emacs.d","sessionId":"3662272f-90eb-4f6d-acc3-1b561237eac1","version":"2.1.49","gitBranch":"feature/update-gitignore","slug":"clever-shimmying-tiger","type":"progress","data":{"type":"hook_progress","hookEvent":"Stop","hookName":"Stop","command":"entire hooks claude-code stop"},"parentToolUseID":"ac856ee6-c9d8-4969-b2fc-8d82c617c314","toolUseID":"ac856ee6-c9d8-4969-b2fc-8d82c617c314","timestamp":"2026-02-21T20:10:11.306Z","uuid":"c13cc4d5-166a-4a39-bc73-87ba3e5a05f8"}
